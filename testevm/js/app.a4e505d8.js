(function(){var e={3962:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONNECT_METHOD_FETCHMSG=t.CONNECT_METHOD_RECEIVE=t.CONNECT_METHOD_UNSUB=t.CONNECT_METHOD_SUB=t.CONNECT_METHOD_PUBLISH=t.CONNECT_METHOD_LOGIN=t.CONNECT_METHOD_PUSH=void 0,t.CONNECT_METHOD_PUSH="push",t.CONNECT_METHOD_LOGIN="login",t.CONNECT_METHOD_PUBLISH="publish",t.CONNECT_METHOD_SUB="subscribe",t.CONNECT_METHOD_UNSUB="unsubscribe",t.CONNECT_METHOD_RECEIVE="receive",t.CONNECT_METHOD_FETCHMSG="fetchMessages"},2516:function(e,t,n){"use strict";n(4603),n(7566),n(8721);var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e["default"]=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return i(t,e),t},s=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OKXWalletConnector=void 0;const a=n(9795),l=n(2581),d=n(8384),u=r(n(9323)),h=c(n(49)),g=(0,d.resolveWebSocketImplementation)();class f{constructor(e){if(this.events=new h.default,this.state=a.ConnectorState.InitState,!(0,d.checkWSUrl)(e))throw new Error(`CONNECTOR: invalid url ${e}`);this.url=e,this.heartbeatTimer=null}get connecting(){return this.state==a.ConnectorState.Connecting}onPayload(e){if("undefined"!==typeof e.data){if(u.logDebug("get received data"),u.logDebug(e),"string"===typeof e.data){let t=e.data;if("pong"===t)return void u.logDebug(`CONNECT: receive pong ${Date.now().toString()}`)}this.events.emit("payload",e.data)}}onClose(e){this.socket=void 0,this.events.emit("close",e)}onError(e,t){const n={id:e,msg:t.toString()};this.events.emit("payload",n)}onopen(e){e.onmessage=e=>this.onPayload(e),e.onclose=e=>this.onClose(e),this.socket=e,this.state=a.ConnectorState.Connected,this.events.emit("open")}emitError(e){this.events.emit("fail",e)}heartbeat(){return s(this,void 0,void 0,(function*(){if(this.heartbeatTimer&&clearTimeout(this.heartbeatTimer),this.state==a.ConnectorState.Connected||this.state==a.ConnectorState.OnError){if(this.socket){if(this.socket.readyState===WebSocket.OPEN)u.logDebug(`send ping heart beat: ${Date.now().toString()}, ${this.socket}`),this.socket.send("ping"),this.heartbeatTimer=setTimeout(this.heartbeat.bind(this),5e3);else if(u.logDebug("socket not ready"),this.state==a.ConnectorState.Connected||this.state==a.ConnectorState.OnError){u.logDebug("socket reconnect by heartbeat");try{yield this.registOpen()}catch(e){u.logError("regist open failed"),this.heartbeatTimer=setTimeout(this.heartbeat.bind(this),5e3)}}}else if(u.logDebug("socket not exist"),this.state==a.ConnectorState.Connected||this.state==a.ConnectorState.OnError){u.logDebug("socket reconnect by heartbeat");try{yield this.registOpen()}catch(e){u.logError("regist open failed"),this.heartbeatTimer=setTimeout(this.heartbeat.bind(this),5e3)}}}else u.logDebug("heart beat close")}))}registOpen(e=this.url){if(!(0,d.checkWSUrl)(e))throw new Error(`CONNECTOR: invalid url ${e}`);if(this.connecting)return new Promise(((e,t)=>{this.events.once("fail",(e=>{t(e)})),this.events.once("open",(()=>{if("undefined"==typeof this.socket)return t(new Error("Connect lost"));e(this.socket)}))}));this.url=e,this.state=a.ConnectorState.Connecting;new URLSearchParams(e).get("origin");return new Promise(((t,n)=>{const o=new g(e,[]);(0,d.hasBuiltInWebSocket)()?o.onerror=e=>{const t=e;this.state=a.ConnectorState.OnError,this.emitError(t.error),n(new Error(t.message))}:o.on("error",(e=>{this.state=a.ConnectorState.OnError,this.emitError(e),n(new Error("socketError"))})),o.onopen=()=>{u.logDebug("socket opened"),this.onopen(o),this.heartbeat(),t(o)}}))}onVisibleChanged(){return s(this,void 0,void 0,(function*(){if("visible"!==document.visibilityState||(u.logDebug(`get changed ${this.state}, ${this.socket}`),this.state!=a.ConnectorState.Connected||"undefined"!==typeof this.socket));else{u.logDebug("CONNECTION need reopen");try{yield this.registOpen()}catch(e){u.logError("regist open failed")}}}))}connect(){return s(this,void 0,void 0,(function*(){yield this.registOpen(this.url),document.removeEventListener("visibilitychange",this.onVisibleChanged.bind(this)),document.addEventListener("visibilitychange",this.onVisibleChanged.bind(this))}))}disconnect(){return s(this,void 0,void 0,(function*(){return this.state=a.ConnectorState.Disconnected,new Promise((e=>{"undefined"!==typeof this.socket?(this.socket.onclose=t=>{this.onClose(t),e()},this.socket.close(),this.heartbeatTimer&&clearTimeout(this.heartbeatTimer)):e()}))}))}currentStatus(){return{state:this.state,url:this.url}}addListener(e,t,n,o){this.listenPayloadHandler&&this.events.removeListener("payload",this.listenPayloadHandler),this.listenPayloadHandler=i=>{var r;u.logDebug(`<<< get payload ${i}`);let s=(0,l.safeJsonParse)(i);if(s.params&&s.params.data){let c=null===(r=s.params.data)||void 0===r?void 0:r.message;if(c)try{let i=t(c);void 0===i?(u.logDebug("CONNECT: decrypt undefined"),o(e,"Decrypt undefined")):n(e,i)}catch(i){u.logDebug(`CONNECT: decrypt failed: ${i}`),o(e,i.message)}}},this.events.on("payload",this.listenPayloadHandler),this.failHandler&&this.events.removeListener("fail",this.failHandler),this.failHandler=t=>{t?(u.logDebug(`CONNECT failed: ${t}`),o(e,t.message)):o(e,"Unkonow error")},this.events.on("fail",this.failHandler)}addPackageParse(e){this.payloadHandler&&this.events.removeListener("payload",this.payloadHandler),this.payloadHandler=t=>s(this,void 0,void 0,(function*(){u.logDebug(`CONNECTION @[${(new Date).toUTCString()}] <<<< received e:${t}`);let n=(0,l.safeJsonParse)(t);yield e(n)})),this.events.on("payload",this.payloadHandler)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}send(e,t){return s(this,void 0,void 0,(function*(){"undefined"===typeof this.socket&&(u.logDebug(`>>> send payload undefined ${t}`),yield e());try{u.logDebug(`CONNECTION @[${(new Date).toUTCString()}]>>> send payload ${(0,l.safeJsonStringify)(t)}`),this.socket&&this.socket.send((0,l.safeJsonStringify)(t))}catch(n){this.onError(t.id,n)}}))}getMsgPayloadFromHistory(e){return s(this,void 0,void 0,(function*(){if("undefined"===typeof e)return;let t={params:{data:e}},n=(0,l.safeJsonStringify)(e);u.logDebug("get received data from history"),u.logDebug(n),n=(0,l.safeJsonStringify)(t),this.events.emit("payload",n)}))}onOpen(e){this.openHandler&&this.events.removeListener("open",this.openHandler),this.openHandler=()=>s(this,void 0,void 0,(function*(){u.logDebug(`CONNECTION @[${(new Date).toUTCString()}] >>> ws opened: `),yield e()})),this.events.on("open",this.openHandler)}}t.OKXWalletConnector=f},7829:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e["default"]=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return i(t,e),t},s=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectionManager=void 0;const a=n(2516),l=n(3962),d=n(4942),u=n(5534),h=n(9795),g=n(8391),f=n(8384),p=n(3372),v=n(5767),_=n(5058),O=r(n(9323)),E=n(9323),C=c(n(49));class y{constructor(){this.events=new C.default,this.connectStorage=new g.Storage(d.OKXCONNECTOR_CACHE_KEY),this.crypto=new p.SessionCrypto,this.jwtKeyPair=this.getCachedJWTKeyPair(),this.saveJWTKeyPair(this.jwtKeyPair),this.connector=new a.OKXWalletConnector(h.OKXCONNECTOR_WS_URL),this.packageId=Date.now(),this.connectedWalletPK="",this.currentTopic="",O.logDebug(`this.connectedWalletPK  constructor   ${this.connectedWalletPK}`)}refreshPackageId(){this.packageId=Date.now()}saveCryptoKeyPair(e){let t=(0,_.safeJsonStringify)(e);this.connectStorage.encryptStoreMsg(t,d.OKXCONNECTOR_CRYPTO_KEY)}getCachedCryptoKeyPair(){const e=this.connectStorage.getAndDecrypt(d.OKXCONNECTOR_CRYPTO_KEY),t=e;if("string"==typeof t){O.logDebug("get cached crypto key:"),O.logDebug(t);let e=(0,_.safeJsonParse)(t);return e}return this.connectStorage.clearCache(),null}saveJWTKeyPair(e){var t={publicKey:(0,f.toHexString)(e.publicKey),secretKey:(0,f.toHexString)(e.secretKey)};O.logDebug("save jwt kp");let n=(0,_.safeJsonStringify)(t);O.logDebug(n),this.connectStorage.encryptStoreMsg(n,d.OKXCONNECTOR_JWT_KEY)}getCachedJWTKeyPair(){const e=this.connectStorage.getAndDecrypt(d.OKXCONNECTOR_JWT_KEY),t=e;if("string"==typeof t){O.logDebug("get cached jwt kp:"),O.logDebug(t);let e=(0,_.safeJsonParse)(t);O.logDebug("save jwt kp"),O.logDebug(e);var n={publicKey:(0,f.hexToByteArray)(e.publicKey),secretKey:(0,f.hexToByteArray)(e.secretKey)};return n}return(0,v.generateKeyPair)()}isWalletPKReady(){return O.logDebug(`isWalletPKReady  ===> ${this.connectedWalletPK}`),this.connectedWalletPK.length>0}makeJWT(e){return s(this,void 0,void 0,(function*(){return yield(0,v.signJWT)(e,u.OKXCONNECTOR_JWT_SIDE,u.OKXCONNECTOR_JWT_TTL,this.jwtKeyPair)}))}parsePackage(e){return s(this,arguments,void 0,(function*(e,t=!1){var n,o,i;if(this.events.emit(e.id,e),!t){yield this.sendACK(e.id,!0);let t=null===(n=this.connectStorage.getItem(d.OKXCONNECTOR_TOKEN_CACHE))||void 0===n?void 0:n.content;if(t){let n=e;(null===(i=null===(o=n.params)||void 0===o?void 0:o.data)||void 0===i?void 0:i.messageId)&&(this.refreshPackageId(),yield this.sendReceive(this.packageId.toString(),e.id,t))}}}))}restoreConnect(e){return s(this,void 0,void 0,(function*(){if(O.logDebug(`connectionManager  restoreConenct   ${e}`),"string"!==typeof e||0===e.length)throw new Error("CONNECTION: invalid topic");O.logDebug("connectionManager  restoreConenct   disconnect"),yield this.disconnect(!0),this.connectStorage.saveContent(e,d.OKXCONNECTOR_TOKEN_CACHE),O.logDebug("connectionManager  restoreConenct   conect"),yield this.connect(!0)}))}getConnectInfo(){var e=(0,f.generateTopic)();O.logDebug(`generate topic token: ${e}`),this.currentTopic=e;const t={channelId:e,clientId:this.crypto.stringifyKeypair().publicKey};return t}connect(){return s(this,arguments,void 0,(function*(e=!1){this.timeLog=(new Date).getTime(),(0,E.logDebug)("ConnectTime---enter->",this.timeLog);let t=this.connectStorage.getItem(d.OKXCONNECTOR_TOKEN_CACHE);var n=this.currentTopic;if(O.logDebug(`generate topic token: ${n}`),e){"undefined"!==typeof t&&null!==t&&(O.logDebug(`read last connect id: ${t}`),n=t.content);var o=this.connectStorage.getItem(d.OKXCONNECTOR_CRYPTO_SENDER_PK_CACHE);o&&(this.connectedWalletPK=o.content);const e=this.getCachedCryptoKeyPair();this.crypto=new p.SessionCrypto(e)}O.logDebug(`use crypto client id: ${this.crypto.stringifyKeypair().publicKey}`),this.connectStorage.saveContent(n,d.OKXCONNECTOR_TOKEN_CACHE);var i=yield this.makeJWT(n);return O.logDebug(`generate jwt token: ${i}`),this.connectStorage.saveContent(i,"jwt"),new Promise(((e,t)=>{this.connector.onOpen((()=>s(this,void 0,void 0,(function*(){O.logDebug("1. connector on open");const o=(new Date).getTime();(0,E.logDebug)("ConnectTime---open->",o-this.timeLog),this.events.once(this.packageId.toString(),(o=>s(this,void 0,void 0,(function*(){if(o&&o.error){O.logError("failed when login"),yield this.connector.disconnect();var i=new Error;i.message=o.error.message,i.name=o.error.code.toString(),t(i)}this.refreshPackageId(),this.events.once(this.packageId.toString(),(o=>s(this,void 0,void 0,(function*(){if(o&&o.error){O.logError("failed when subscribe"),yield this.connector.disconnect();var i=new Error;i.message=o.error.message,i.name=o.error.code.toString(),t(i)}this.refreshPackageId(),O.logDebug(`4. subscribe callback then send fetch: ${this.packageId}`);const r=(new Date).getTime();(0,E.logDebug)("ConnectTime--subscribe callback->",r-this.timeLog),yield this.sendFetchAndConsumeMessages(this.packageId.toString(),n),e()})))),O.logDebug(`3. login callback then send subscribe: ${this.packageId}`);const r=(new Date).getTime();(0,E.logDebug)("ConnectTime---login callback->",r-this.timeLog),yield this.connector.send((()=>s(this,void 0,void 0,(function*(){O.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}))),{id:this.packageId.toString(),jsonrpc:h.CONNECT_JSONRPC_VER,method:l.CONNECT_METHOD_SUB,params:{topic:n}})})))),O.logDebug("2. login called"),yield this.connector.send((()=>s(this,void 0,void 0,(function*(){O.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}))),{id:this.packageId.toString(),jsonrpc:h.CONNECT_JSONRPC_VER,method:l.CONNECT_METHOD_LOGIN,params:{token:i}}),this.connector.addPackageParse((e=>{var t;if(O.logDebug("connect: parse package"),O.logDebug(e),!("params"in e)||!("data"in e["params"]))return void this.parsePackage(e,!0);let n=null===(t=e.params.data)||void 0===t?void 0:t.message;if("undefined"!==typeof n){n=n.replace(/'/g,'"');let e=(0,_.safeJsonParse)(n);"string"!==typeof e&&"clientId"in e&&e.clientId&&e.clientId.length>0&&(this.connectedWalletPK=e.clientId,O.logDebug(`this.connectedWalletPK  addPackageParse   ${this.connectedWalletPK}`),this.connectStorage.saveContent(this.connectedWalletPK,d.OKXCONNECTOR_CRYPTO_SENDER_PK_CACHE),this.saveCryptoKeyPair(this.crypto.stringifyKeypair()))}this.parsePackage(e,e.method===l.CONNECT_METHOD_RECEIVE)}))})))),this.connector.connect()}))}))}disconnect(){return s(this,arguments,void 0,(function*(e=!1){yield this.connector.disconnect(),this.connectStorage.clearCache(d.OKXCONNECTOR_TOKEN_CACHE),e||(this.connectStorage.clearCache(d.OKXCONNECTOR_CRYPTO_SENDER_PK_CACHE),this.connectedWalletPK="")}))}addListener(e,t,n){this.connector.addListener((0,_.safeJsonStringify)(e),(e=>{if(e=e.replace(/'/g,'"'),O.logDebug(`addListener ===> ${e}`),"undefined"!==typeof e){var t=(0,_.safeJsonParse)(e),n=t.message;t.clientId&&t.clientId.length>0&&(this.connectedWalletPK=t.clientId,this.connectStorage.saveContent(this.connectedWalletPK,d.OKXCONNECTOR_CRYPTO_SENDER_PK_CACHE),O.logDebug(`this.connectedWalletPK  addListener   ${this.connectedWalletPK}`),this.saveCryptoKeyPair(this.crypto.stringifyKeypair()));var o=this.crypto.decrypt(n,this.connectedWalletPK);return O.logDebug(`addListener ===> ${o}`),o}}),t,n)}send(e){return s(this,void 0,void 0,(function*(){if(O.logDebug(`message send =====> ${e}`),!this.isWalletPKReady())throw new Error("connection not finish");let t=this.crypto.encrypt(e,this.connectedWalletPK),n=this.connectStorage.getItem(d.OKXCONNECTOR_TOKEN_CACHE);this.refreshPackageId();const o={id:this.packageId.toString(),method:l.CONNECT_METHOD_PUBLISH,jsonrpc:h.CONNECT_JSONRPC_VER,params:{message:{topic:null===n||void 0===n?void 0:n.content,message:t,ttl:h.OKXCONNECTOR_MESSAGE_TTL}}};return this.events.once(this.packageId.toString(),(e=>s(this,void 0,void 0,(function*(){e&&e.error?O.logError(`@${(new Date).toUTCString()} >>> failed when send msg`):e&&!e.error&&O.logDebug(`CONNECTION @[${(new Date).toUTCString()}] >>> send msg with id ${this.packageId} successed`)})))),yield this.connector.send((()=>s(this,void 0,void 0,(function*(){O.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}))),o),this.packageId}))}sendACK(e,t){return s(this,arguments,void 0,(function*(e,t,n=void 0){if(!0===t){const t={id:e,jsonrpc:h.CONNECT_JSONRPC_VER,result:!0};yield this.connector.send((()=>s(this,void 0,void 0,(function*(){O.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}))),t)}else if(n){const t={id:e,jsonrpc:h.CONNECT_JSONRPC_VER,error:{code:n.code,message:n.message}};yield this.connector.send((()=>s(this,void 0,void 0,(function*(){O.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}))),t)}}))}sendReceive(e,t,n){return s(this,void 0,void 0,(function*(){const o={id:e,jsonrpc:h.CONNECT_JSONRPC_VER,method:l.CONNECT_METHOD_RECEIVE,params:{data:{messageId:t,topic:n}}};yield this.connector.send((()=>s(this,void 0,void 0,(function*(){O.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}))),o)}))}sendFetchAndConsumeMessages(e,t){return s(this,void 0,void 0,(function*(){this.events.once(e,(e=>s(this,void 0,void 0,(function*(){var n,o;if(e.result){var i=e.result.hasMore,r=e.result.data;if(r)for(let e=0;e<r.length;e++){let n=r[e];if(n&&n.topic==t){let e=n.messageId;yield this.connector.getMsgPayloadFromHistory(n),this.refreshPackageId(),yield this.sendReceive(this.packageId.toString(),e,t)}}i&&(this.refreshPackageId(),yield this.sendFetchAndConsumeMessages(this.packageId.toString(),t))}else O.logDebug(`CONNECT: get error rsp ${null===(n=e.error)||void 0===n?void 0:n.code} : ${null===(o=e.error)||void 0===o?void 0:o.message}`)})))),O.logDebug("5. send fetch more");const n=(new Date).getTime();(0,E.logDebug)("ConnectTime---5->",n-this.timeLog);const o={id:e,jsonrpc:h.CONNECT_JSONRPC_VER,method:l.CONNECT_METHOD_FETCHMSG,params:{data:{topic:t}}};yield this.connector.send((()=>s(this,void 0,void 0,(function*(){O.logDebug("CONNECT: reconnect before send"),yield this.connector.connect()}))),o)}))}cleanCache(){return s(this,void 0,void 0,(function*(){this.connectStorage.clearCache()}))}saveSessionContent(e,t){t||this.connectStorage.clearCache(d.OKXCONNECTOR_SESSION_PREFIX_KEY+e);let n=(0,_.safeJsonStringify)(t);this.connectStorage.encryptStoreMsg(n,d.OKXCONNECTOR_SESSION_PREFIX_KEY+e)}getSessionContent(e){let t=this.connectStorage.getAndDecrypt(d.OKXCONNECTOR_SESSION_PREFIX_KEY+e);if(t){let e=(0,_.safeJsonParse)(t);return e}}}t.ConnectionManager=y},9795:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectorState=t.CONNECT_JSONRPC_VER=t.OKXCONNECTOR_MESSAGE_TTL=t.OKXCONNECTOR_WS_URL=t.EVENT_EMITTER_MAX_LISTENERS=void 0,t.EVENT_EMITTER_MAX_LISTENERS=10,t.OKXCONNECTOR_WS_URL="wss://wsdex.okx.com/ws/v1/wallet-connect-relay",t.OKXCONNECTOR_MESSAGE_TTL=3e5,t.CONNECT_JSONRPC_VER="2.0",t.ConnectorState={InitState:0,Connecting:1,Connected:2,Disconnected:3,OnError:4}},5062:function(e,t,n){"use strict";n(4114),n(4979);var o=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Engine=void 0;const i=n(6229),r=n(5058),s=n(9323),c=n(852),a=n(2581),l=n(2581),d=n(8097);class u{constructor(e){this.pendingRequests=new Map,this.disconnectListener=[],this.connectionManager=e,this.connectionManager.addListener("sdk_response",((e,t)=>{var n=(0,r.safeJsonParse)(t);(0,s.logDebug)(`Engine ==>> addListener ==> success ==> ${n}`),this.handleResponse(e,n)}),(function(){}))}addDisconnectListener(e){this.disconnectListener.push(e)}disconnect(){(0,s.logDebug)("Engine ==>> disconnect"),this.pendingRequests.clear()}getRequestId(){const e=Date.now().toString();return(0,s.logDebug)("Engine ==>> getRequestId ==>",e),e}bindRequestForPromise(e,t){this.pendingRequests.set(e,t)}send(e,t,n){return o(this,void 0,void 0,(function*(){const o=this.getRequestId();let c=yield(0,i.callForSuccess)((()=>this.connectionManager.send(JSON.stringify(Object.assign(Object.assign({},e),{requestId:o})))),n);this.connectionManager.events.once(c.toString(),(e=>{var n;(0,s.logDebug)(`Engine ==> send => onAck => ${(0,r.safeJsonStringify)(e)}`),e&&e.result&&(null===(n=t.onAck)||void 0===n||n.call(t))})),t.resolve&&this.bindRequestForPromise(o,t.resolve)}))}handleResponse(e,t){if((0,s.logDebug)(`Engine ==>> handleResponse_1  ======>response: ${(0,r.safeJsonStringify)(t)}`,e),"requestId"in t){(0,s.logDebug)("Engine ==>> handleResponse_2  ===> in response");let e=t.requestId;const n=this.pendingRequests.get(e);n?((0,s.logDebug)("Engine ==>> handleResponse_3  ===> find resolve:",n),n(t),this.pendingRequests.delete(e)):((0,s.logDebug)("Engine ==>> handleResponse_3  ===> not find resolve:"),"disconnect"===t.method&&(this.disconnectListener.forEach((e=>e())),this.disconnectListener=[],this.disconnect()))}}restoreconnect(e,t){return o(this,void 0,void 0,(function*(){var n;yield null===(n=this.connectionManager)||void 0===n?void 0:n.restoreConnect(e.topic),t(e)}))}conect(e,t,n){return o(this,void 0,void 0,(function*(){var o,i,r;const d=this.connectionManager.getConnectInfo(),u=this.getRequestId();let h=null!==(o=t.openUniversalUrl)&&void 0!==o&&o;const g={protocolVer:Number(c.tonConnectSdkVersion),topic:d.channelId,clientId:d.clientId,requestId:u,dAppInfo:t.dappInfo,requests:e,redirect:null!==(i=null===t||void 0===t?void 0:t.redirect)&&void 0!==i?i:"none"},f=JSON.stringify(g),p=(new TextEncoder).encode(f),v=btoa(String.fromCharCode(...p)),_=`${c.standardDeeplink}?param=${v}`;(0,s.logDebug)("bridge-provider ==>> connect_2 ==>>fullUrl:",_);const O=(0,l.isIos)();return O&&h&&(0,a.openOKXDeeplinkWithFallback)(_),yield null===(r=this.connectionManager)||void 0===r?void 0:r.disconnect(!1),this.bindRequestForPromise(u,(e=>{let o=this.onConnect(e,t,d.channelId);n(o,e)})),yield this.connectionManager.connect(),!O&&h&&(0,a.openOKXDeeplinkWithFallback)(_),{connectInfo:d,deeplinkUrl:(0,a.getUniversalLink)(_)}}))}onConnect(e,t,n){if("connect"==e.method){let o=(0,d.buildNameSpacesByConnectResponse)(e);if(o){let e={topic:n,sessionConfig:t,namespaces:o};return e}}return null}}t.Engine=u},8530:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Storage=t.Engine=t.ConnectionManager=t.OKXWalletConnector=void 0;var o=n(2516);Object.defineProperty(t,"OKXWalletConnector",{enumerable:!0,get:function(){return o.OKXWalletConnector}});var i=n(7829);Object.defineProperty(t,"ConnectionManager",{enumerable:!0,get:function(){return i.ConnectionManager}});var r=n(5062);Object.defineProperty(t,"Engine",{enumerable:!0,get:function(){return r.Engine}});var s=n(8391);Object.defineProperty(t,"Storage",{enumerable:!0,get:function(){return s.Storage}})},5767:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e["default"]=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return i(t,e),t},s=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MULTICODEC_ED25519_LENGTH=t.MULTICODEC_ED25519_HEADER=t.MULTICODEC_ED25519_BASE=t.MULTICODEC_ED25519_ENCODING=t.DID_METHOD=t.DID_PREFIX=t.DID_DELIMITER=t.KEY_PAIR_SEED_LENGTH=t.DATA_ENCODING=t.JSON_ENCODING=t.JWT_ENCODING=t.JWT_DELIMITER=t.JWT_IRIDIUM_TYP=t.JWT_IRIDIUM_ALG=t.JWTHeaderType=void 0,t.generateKeyPair=p,t.decodeJSON=v,t.encodeJSON=_,t.encodeIss=O,t.decodeIss=E,t.encodeSig=C,t.decodeSig=y,t.encodeData=b,t.decodeData=m,t.encodeJWT=R,t.decodeJWT=N,t.signJWT=S,t.verifyJWT=T;const a=r(n(8091)),l=n(9867),d=n(4972),u=n(5058),h=n(8384),g=c(n(998)),f=r(n(9323));function p(){return g.default.sign.keyPair()}function v(e){return(0,u.safeJsonParse)((0,l.toString)((0,d.fromString)(e,t.JWT_ENCODING),t.JSON_ENCODING))}function _(e){return(0,l.toString)((0,d.fromString)((0,u.safeJsonStringify)(e),t.JSON_ENCODING),t.JWT_ENCODING)}function O(e){f.logDebug(`publicKey: ${(0,h.toHexString)(e)}`);var n=(0,l.toString)(e,t.MULTICODEC_ED25519_ENCODING);return[t.DID_PREFIX,t.DID_METHOD,n].join(t.DID_DELIMITER)}function E(e){const[n,o,i]=e.split(t.DID_DELIMITER);if(n!==t.DID_PREFIX||o!==t.DID_METHOD)throw new Error('Issuer must be a DID with method "key"');if(void 0===i)throw new Error("multicodec is undefined");const r=(0,d.fromString)(i,t.MULTICODEC_ED25519_ENCODING);if(void 0===r||r.length!==t.MULTICODEC_ED25519_LENGTH)throw new Error("Issuer must be a public key with length 32 bytes");return r}function C(e){return(0,l.toString)(e,t.JWT_ENCODING)}function y(e){return(0,d.fromString)(e,t.JWT_ENCODING)}function b(e){return(0,d.fromString)([_(e.header),_(e.payload)].join(t.JWT_DELIMITER),t.DATA_ENCODING)}function m(e){var n,o;const i=(0,l.toString)(e,t.DATA_ENCODING).split(t.JWT_DELIMITER),r=v(null!==(n=i[0])&&void 0!==n?n:"{}"),s=v(null!==(o=i[1])&&void 0!==o?o:"{}");return{header:r,payload:s}}function R(e){return[_(e.header),_(e.payload),C(e.signature)].join(t.JWT_DELIMITER)}function N(e){var n,o,i;const r=e.split(t.JWT_DELIMITER),s=v(null!==(n=r[0])&&void 0!==n?n:"{}"),c=v(null!==(o=r[1])&&void 0!==o?o:"{}"),a=y(null!==(i=r[2])&&void 0!==i?i:"{}"),l=(0,d.fromString)(r.slice(0,2).join(t.JWT_DELIMITER),t.DATA_ENCODING);return{header:s,payload:c,signature:a,data:l}}function S(e,n,o,i){return s(this,arguments,void 0,(function*(e,n,o,i,r=Math.floor(Date.now())){const s={alg:t.JWT_IRIDIUM_ALG,typ:t.JWT_IRIDIUM_TYP},c=O(i.publicKey),a=r+o,l="authenticate user",d={iss:c,sub:e,aud:n,act:l,iat:r,exp:a},u=b({header:s,payload:d});f.logDebug(`get sec kp: ${i.secretKey} {${i.secretKey.length}}`);const h=g.default.sign.detached(u,i.secretKey);return R({header:s,payload:d,signature:h})}))}function T(e){return s(this,void 0,void 0,(function*(){const{header:n,payload:o,data:i,signature:r}=N(e);if(n.alg!==t.JWT_IRIDIUM_ALG||n.typ!==t.JWT_IRIDIUM_TYP)throw new Error("JWT must use EdDSA algorithm");const s=E(o.iss);return a.verify(s,i,r)}))}t.JWTHeaderType="dapp",t.JWT_IRIDIUM_ALG="EdDSA",t.JWT_IRIDIUM_TYP="JWT",t.JWT_DELIMITER=".",t.JWT_ENCODING="base64url",t.JSON_ENCODING="utf8",t.DATA_ENCODING="utf8",t.KEY_PAIR_SEED_LENGTH=32,t.DID_DELIMITER=":",t.DID_PREFIX="did",t.DID_METHOD="key",t.MULTICODEC_ED25519_ENCODING="base58btc",t.MULTICODEC_ED25519_BASE="z",t.MULTICODEC_ED25519_HEADER="K36",t.MULTICODEC_ED25519_LENGTH=32},5534:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OKXCONNECTOR_JWT_TTL=t.OKXCONNECTOR_JWT_SIDE=void 0,t.OKXCONNECTOR_JWT_SIDE="wallet",t.OKXCONNECTOR_JWT_TTL=864e5},8097:function(e,t,n){"use strict";function o(e){let t=i(e);return t}function i(e){let t={};console.log("buildRequestAccountNameSpacesByConnectResponse >>",JSON.stringify(e));const n=e.payload.responses.find((e=>"requestAccounts"===e.name));return n.accounts.forEach((e=>{var n=[],o=[];e.addresses.forEach((e=>{var t=e.split(":");3==t.length&&(n.push(`${t[0]}:${t[1]}`),o.push(e))})),t[e.namespace]={chains:n,accounts:o,methods:e.methods}})),t}function r(e){const t=e.payload.responses.find((e=>"ton_addr"===e.name)),n=e.payload.responses.find((e=>"ton_proof"===e.name));if(t)return{NameSpaceKeyTON:{chains:[t.network],accounts:[],methods:e.payload.wallet.features.ton,payload:{tonAccount:{address:t.address,chain:t.network,walletStateInit:t.walletStateInit,publicKey:t.publicKey},tonProof:n}}}}n(4114),Object.defineProperty(t,"__esModule",{value:!0}),t.buildNameSpacesByConnectResponse=o,t.buildRequestAccountNameSpacesByConnectResponse=i,t.buildTonNameSpaceByConnectResponse=r},8391:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e["default"]=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return i(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Storage=void 0;const c=n(4942),a=s(n(998)),l=n(8384),d=n(2581),u=r(n(9323)),h=n(2581),g=n(4473);class f{constructor(e){const t=(0,l.resolveLocalStorage)();this.storeKey="",this.cipherIV="",this.subKey=e,u.logDebug("--------get current local storage --------"),u.logDebug(t);const n=t.getItem(f.cacheKey+e);if("undefined"===typeof n||null===n)return u.logDebug("with no cache"),void(this.cache={});if(u.logDebug(n),(null===n||void 0===n?void 0:n.length)>0){var o=(0,d.safeJsonParse)(n);this.cache=o}u.logDebug(`get cache obj: ${this.cache}`),"undefined"!==typeof this.cache&&null!=this.cache||(this.cache={})}saveContent(e,t,n="-"){let o={id:n,timestamp:Date.now().toString(),content:e};this.saveItem(o,t)}saveItem(e,t){let n=f.cacheKey+this.subKey;const o=(0,l.resolveLocalStorage)();u.logDebug(this.cache),u.logDebug(`get cache obj: ${this.cache}, ${t}, ${e}`),this.cache[t]=e;let i=(0,d.safeJsonStringify)(this.cache);u.logDebug(`STORAGE: ${t} @ ${this.cache}`),o.setItem(n,i)}getItem(e){return u.logDebug(`STORAGE >> getItem: ${e} @ ${this.cache}`),this.cache[e]}getCachedPBKDF2InfoKey(){var e,t,n,o;const i=32,r=24;if(this.storeKey.length>0&&(null===(e=this.cipherIV)||void 0===e?void 0:e.length)>0)return{pw:this.storeKey,iv:this.cipherIV};let s=null===(t=this.getItem(c.OKXCONNECTOR_STORAGER_CRYPTO_SALT))||void 0===t?void 0:t.content;s||(s=(0,l.toHexString)(a.default.randomBytes(r)),this.saveContent(s,c.OKXCONNECTOR_STORAGER_CRYPTO_SALT));let d=null===(n=this.getItem(c.OKXCONNECTOR_STORAGE_CRYPTO_PASSWORD))||void 0===n?void 0:n.content;d||(d=(0,l.toHexString)(a.default.randomBytes(i)),this.saveContent(d,c.OKXCONNECTOR_STORAGE_CRYPTO_PASSWORD));let u=null===(o=this.getItem(c.OKXCONNECTOR_STORAGE_CRYPTO_CIPHERIV))||void 0===o?void 0:o.content;if(!u){let e=a.default.randomBytes(16);u=(0,l.toHexString)(e),this.saveContent(u,c.OKXCONNECTOR_STORAGE_CRYPTO_CIPHERIV)}return this.cipherIV=u,this.storeKey=(0,g.PBKDF2)(d,s,{iterations:10}).toString(),{pw:this.storeKey,iv:this.cipherIV}}encryptStoreMsg(e,t){(0,h.logDebug)(`encryptStoreMsg  encryptStoreMsg start ${Date.now()}`);let n=this.getCachedPBKDF2InfoKey();(0,h.logDebug)(`encryptStoreMsg  encryptStoreMsg mid ${Date.now()}`);var o=g.AES.encrypt(e,n.pw).toString();this.saveContent(o,t),(0,h.logDebug)(`encryptStoreMsg  encryptStoreMsg end ${Date.now()}`)}getAndDecrypt(e){(0,h.logDebug)(`encryptStoreMsg  getAndDecrypt start ${Date.now()}`);let t=this.getItem(e);if(t&&t.content){let e=this.getCachedPBKDF2InfoKey();(0,h.logDebug)(`encryptStoreMsg  getAndDecrypt mid ${Date.now()}`);let n=g.AES.decrypt(t.content,e.pw).toString(g.enc.Utf8);return(0,h.logDebug)(`encryptStoreMsg  getAndDecrypt end ${Date.now()}`),n}return null}clearCache(e=void 0){if(void 0===e){this.cache={};let e=f.cacheKey+this.subKey;localStorage.setItem(e,"")}else{let t=f.cacheKey+this.subKey;const n=(0,l.resolveLocalStorage)();u.logDebug(this.cache),this.cache[e]=null;let o=(0,d.safeJsonStringify)(this.cache);u.logDebug(`STORAGE: clean key ${e} @ ${this.cache}`),n.setItem(t,o)}}}t.Storage=f,f.cacheKey="OKXStorageKey"},4942:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OKXCONNECTOR_STORAGE_CIPHER_METHOD=t.OKXCONNECTOR_STORAGE_CRYPTO_CIPHERIV=t.OKXCONNECTOR_STORAGER_CRYPTO_SALT=t.OKXCONNECTOR_STORAGE_CRYPTO_PASSWORD=t.OKXCONNECTOR_TON_KEY=t.OKXCONNECTOR_CRYPTO_SENDER_PK_CACHE=t.OKXCONNECTOR_TOKEN_CACHE=t.OKXCONNECTOR_JWT_KEY=t.OKXCONNECTOR_SESSION_PREFIX_KEY=t.OKXCONNECTOR_CRYPTO_KEY=t.OKXCONNECTOR_CACHE_KEY=void 0,t.OKXCONNECTOR_CACHE_KEY="ck",t.OKXCONNECTOR_CRYPTO_KEY="cck_k",t.OKXCONNECTOR_SESSION_PREFIX_KEY="cspk_",t.OKXCONNECTOR_JWT_KEY="cjk_k",t.OKXCONNECTOR_TOKEN_CACHE="ct",t.OKXCONNECTOR_CRYPTO_SENDER_PK_CACHE="csp",t.OKXCONNECTOR_TON_KEY="OKXStorage_ctc",t.OKXCONNECTOR_STORAGE_CRYPTO_PASSWORD="scp",t.OKXCONNECTOR_STORAGER_CRYPTO_SALT="scs",t.OKXCONNECTOR_STORAGE_CRYPTO_CIPHERIV="scpc",t.OKXCONNECTOR_STORAGE_CIPHER_METHOD="aes-256-cbc"},3372:function(e,t,n){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SessionCrypto=void 0;const i=o(n(998)),r=n(8384);class s{constructor(e=void 0){this.nonceLength=24,this.sessionKeyPair=e?this.createKeypairFromString(e):this.createKeypair()}createKeypair(){return i.default.box.keyPair()}createKeypairFromString(e){return{publicKey:(0,r.hexToByteArray)(e.publicKey),secretKey:(0,r.hexToByteArray)(e.secretKey)}}createNonce(){return i.default.randomBytes(this.nonceLength)}get keyPair(){return this.sessionKeyPair}encrypt(e,t){const n=(new TextEncoder).encode(e),o=this.createNonce(),s=i.default.box(n,o,(0,r.hexToByteArray)(t),this.keyPair.secretKey);var c=(0,r.toHexString)((0,r.concatUint8Arrays)(o,s)),a=(new TextEncoder).encode(c);return(0,r.base64encode)(a,!1)}decrypt(e,t){let n=(0,r.base64decode)(e,!0),o=n.toUint8Array();const[s,c]=(0,r.splitToUint8Arrays)(o,this.nonceLength),a=i.default.box.open(c,s,(0,r.hexToByteArray)(t),this.keyPair.secretKey);if(!a)throw new Error(`Decryption error: \n message: ${e.toString()} \n sender pubkey: ${t.toString()} \n keypair pubkey: ${this.keyPair.publicKey.toString()} \n keypair secretkey: ${this.keyPair.secretKey.toString()}`);return(new TextDecoder).decode(a)}stringifyKeypair(){return{publicKey:(0,r.toHexString)(this.keyPair.publicKey),secretKey:(0,r.toHexString)(this.keyPair.secretKey)}}}t.SessionCrypto=s},523:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.Storage=t.Engine=t.ConnectionManager=t.OKXWalletConnector=void 0;var r=n(8530);Object.defineProperty(t,"OKXWalletConnector",{enumerable:!0,get:function(){return r.OKXWalletConnector}}),Object.defineProperty(t,"ConnectionManager",{enumerable:!0,get:function(){return r.ConnectionManager}}),Object.defineProperty(t,"Engine",{enumerable:!0,get:function(){return r.Engine}}),Object.defineProperty(t,"Storage",{enumerable:!0,get:function(){return r.Storage}}),i(n(852),t),i(n(2581),t)},2664:function(e,t,n){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.IEngine=t.ISignClient=t.ISignClientEvents=t.IEngineEvents=void 0;const i=o(n(49));class r extends i.default{constructor(){super()}}t.IEngineEvents=r;class s extends i.default{constructor(){super()}}t.ISignClientEvents=s;class c{constructor(e){this.data=e}}t.ISignClient=c;class a{constructor(e){this.client=e}}t.IEngine=a},5653:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.ISignClientEvents=t.IEngine=t.IEngineEvents=t.ISignClient=void 0;var r=n(2664);Object.defineProperty(t,"ISignClient",{enumerable:!0,get:function(){return r.ISignClient}}),Object.defineProperty(t,"IEngineEvents",{enumerable:!0,get:function(){return r.IEngineEvents}}),Object.defineProperty(t,"IEngine",{enumerable:!0,get:function(){return r.IEngine}}),Object.defineProperty(t,"ISignClientEvents",{enumerable:!0,get:function(){return r.ISignClientEvents}}),i(n(4856),t)},2541:function(e,t,n){"use strict";function o(e){return"object"===typeof e&&"id"in e&&"jsonrpc"in e&&"2.0"===e.jsonrpc}function i(e){return o(e)&&"method"in e}function r(e){return o(e)&&(s(e)||c(e))}function s(e){return"result"in e}function c(e){return"error"in e}n(6573),n(8100),n(7936),n(7467),n(4732),n(9577),Object.defineProperty(t,"__esModule",{value:!0}),t.isJsonRpcPayload=o,t.isJsonRpcRequest=i,t.isJsonRpcResponse=r,t.isJsonRpcResult=s,t.isJsonRpcError=c,t.payloadId=h,t.getBigIntRpcId=g,t.formatJsonRpcRequest=f,t.formatJsonRpcResult=p,t.formatJsonRpcError=v,t.isReservedErrorCode=_,t.getError=O,t.getErrorByCode=E,t.formatErrorMessage=C,t.isHttpUrl=m,t.isWsUrl=R,t.parseConnectionError=N;const a=n(4028);class l{constructor(e){this.i=1;const t=8===e?new Uint8Array(1):16===e?new Uint16Array(1):new Uint32Array(1);this.initialValue=crypto.getRandomValues(t)[0]}getNextValue(){return this.initialValue+this.i++}}const d=new l(8),u=new l(16);function h(){const e=1e3*Date.now(),t=d.getNextValue();return e+t}function g(){const e=BigInt(Date.now())*BigInt(1e6),t=BigInt(u.getNextValue());return e+t}function f(e,t,n){return{id:n||h(),jsonrpc:"2.0",method:e,params:t}}function p(e,t){return{id:e,jsonrpc:"2.0",result:t}}function v(e,t,n){return{id:e,jsonrpc:"2.0",error:C(t,n)}}function _(e){return a.RESERVED_ERROR_CODES.includes(e)}function O(e){return Object.keys(a.STANDARD_ERROR_MAP).includes(e)?a.STANDARD_ERROR_MAP[e]:a.STANDARD_ERROR_MAP[a.DEFAULT_ERROR]}function E(e){const t=Object.values(a.STANDARD_ERROR_MAP).find((t=>t.code===e));return t||a.STANDARD_ERROR_MAP[a.DEFAULT_ERROR]}function C(e,t){return"undefined"===typeof e?O(a.INTERNAL_ERROR):("string"===typeof e&&(e=Object.assign(Object.assign({},O(a.SERVER_ERROR)),{message:e})),"undefined"!==typeof t&&(e.data=t),_(e.code)&&(e=E(e.code)),e)}function y(e){const t=e.match(new RegExp(/^\w+:/,"gi"));if(t&&t.length)return t[0]}function b(e,t){const n=y(e);return"undefined"!==typeof n&&new RegExp(t).test(n)}function m(e){return b(e,"^https?:")}function R(e){return b(e,"^wss?:")}function N(e,t,n){return e.message.includes("getaddrinfo ENOTFOUND")||e.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${n} RPC url at ${t}`):e}},6952:function(e,t){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.CONNECT_ITEM_ERROR_CODES=void 0,function(e){e[e["UNKNOWN_ERROR"]=0]="UNKNOWN_ERROR",e[e["METHOD_NOT_SUPPORTED"]=400]="METHOD_NOT_SUPPORTED"}(n||(t.CONNECT_ITEM_ERROR_CODES=n={}))},5983:function(e,t){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.TONCHAIN=void 0,function(e){e["MAINNET"]="-239"}(n||(t.TONCHAIN=n={}))},4856:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONNECT_ITEM_ERROR_CODES=t.TONCHAIN=void 0;var o=n(5983);Object.defineProperty(t,"TONCHAIN",{enumerable:!0,get:function(){return o.TONCHAIN}});var i=n(6952);Object.defineProperty(t,"CONNECT_ITEM_ERROR_CODES",{enumerable:!0,get:function(){return i.CONNECT_ITEM_ERROR_CODES}})},2329:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tonConnectSdkVersion=t.standardDeeplink=t.standardUniversalLink=void 0,t.standardUniversalLink="https://www.okx.com/download",t.standardDeeplink="okx://web3/wallet/connect",t.tonConnectSdkVersion="1"},3917:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OKX_CONNECT_ERROR_CODES=t.OkxConnectError=void 0;var o=n(4028);Object.defineProperty(t,"OkxConnectError",{enumerable:!0,get:function(){return o.OkxConnectError}}),Object.defineProperty(t,"OKX_CONNECT_ERROR_CODES",{enumerable:!0,get:function(){return o.OKX_CONNECT_ERROR_CODES}})},4028:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_ERROR=t.STANDARD_ERROR_MAP=t.SERVER_ERROR_CODE_RANGE=t.RESERVED_ERROR_CODES=t.SERVER_ERROR=t.INTERNAL_ERROR=t.INVALID_PARAMS=t.METHOD_NOT_FOUND=t.INVALID_REQUEST=t.PARSE_ERROR=t.OKX_CONNECT_ERROR_CODES=t.OkxConnectError=void 0;class n extends Error{constructor(e,t){void 0==t&&(t=o(e)),super(t),this.code=e,this.message=`${n.prefix} ${t?"\n"+t:""}`,Object.setPrototypeOf(this,n.prototype)}}function o(e){return e==i.UNKNOWN_ERROR?"unknown error":e==i.BAD_REQUEST_ERROR?"bad request error":e==i.ALREADY_CONNECTED_ERROR?"already connected error":e==i.NOT_CONNECTED_ERROR?"not connected error":e==i.UNKNOWN_APP_ERROR?"unknown app error":e==i.USER_REJECTS_ERROR?"user rejects error":e==i.METHOD_NOT_SUPPORTED?"method not supported":"unknown error"}var i;t.OkxConnectError=n,n.prefix="[OKX_CONNECT_SDK_ERROR]",function(e){e[e["UNKNOWN_ERROR"]=0]="UNKNOWN_ERROR",e[e["BAD_REQUEST_ERROR"]=1]="BAD_REQUEST_ERROR",e[e["ALREADY_CONNECTED_ERROR"]=11]="ALREADY_CONNECTED_ERROR",e[e["NOT_CONNECTED_ERROR"]=12]="NOT_CONNECTED_ERROR",e[e["UNKNOWN_APP_ERROR"]=100]="UNKNOWN_APP_ERROR",e[e["USER_REJECTS_ERROR"]=300]="USER_REJECTS_ERROR",e[e["METHOD_NOT_SUPPORTED"]=400]="METHOD_NOT_SUPPORTED"}(i||(t.OKX_CONNECT_ERROR_CODES=i={})),t.PARSE_ERROR="PARSE_ERROR",t.INVALID_REQUEST="INVALID_REQUEST",t.METHOD_NOT_FOUND="METHOD_NOT_FOUND",t.INVALID_PARAMS="INVALID_PARAMS",t.INTERNAL_ERROR="INTERNAL_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.RESERVED_ERROR_CODES=[-32700,-32600,-32601,-32602,-32603],t.SERVER_ERROR_CODE_RANGE=[-32e3,-32099],t.STANDARD_ERROR_MAP={[t.PARSE_ERROR]:{code:-32700,message:"Parse error"},[t.INVALID_REQUEST]:{code:-32600,message:"Invalid Request"},[t.METHOD_NOT_FOUND]:{code:-32601,message:"Method not found"},[t.INVALID_PARAMS]:{code:-32602,message:"Invalid params"},[t.INTERNAL_ERROR]:{code:-32603,message:"Internal error"},[t.SERVER_ERROR]:{code:-32e3,message:"Server error"}},t.DEFAULT_ERROR=t.SERVER_ERROR},852:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.tonConnectSdkVersion=t.standardDeeplink=t.standardUniversalLink=t.NameSpaceKeyTON=t.NameSpaceKeySOL=t.NameSpaceKeyEip155=void 0,i(n(3917),t);var r=n(6710);Object.defineProperty(t,"NameSpaceKeyEip155",{enumerable:!0,get:function(){return r.NameSpaceKeyEip155}}),Object.defineProperty(t,"NameSpaceKeySOL",{enumerable:!0,get:function(){return r.NameSpaceKeySOL}}),Object.defineProperty(t,"NameSpaceKeyTON",{enumerable:!0,get:function(){return r.NameSpaceKeyTON}});var s=n(2329);Object.defineProperty(t,"standardUniversalLink",{enumerable:!0,get:function(){return s.standardUniversalLink}}),Object.defineProperty(t,"standardDeeplink",{enumerable:!0,get:function(){return s.standardDeeplink}}),Object.defineProperty(t,"tonConnectSdkVersion",{enumerable:!0,get:function(){return s.tonConnectSdkVersion}}),i(n(5653),t)},6710:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NameSpaceKeyTON=t.NameSpaceKeySOL=t.NameSpaceKeyEip155=void 0,t.NameSpaceKeyEip155="eip155",t.NameSpaceKeySOL="sol",t.NameSpaceKeyTON="ton"},6229:function(e,t){"use strict";var n=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};function o(e,t){return n(this,void 0,void 0,(function*(){var n,o;const r=null!==(n=null===t||void 0===t?void 0:t.attempts)&&void 0!==n?n:3,s=null!==(o=null===t||void 0===t?void 0:t.delayMs)&&void 0!==o?o:800;if("function"!==typeof e)throw new Error("Expected a function, got "+typeof e);let c,a=0;while(a<r)try{return yield e()}catch(l){c=l,a++,a<r&&(yield i(s))}throw c}))}function i(e,t){return n(this,void 0,void 0,(function*(){return new Promise(((n,o)=>{var i,r;if(null===(i=null===t||void 0===t?void 0:t.signal)||void 0===i?void 0:i.aborted)return void o(new Error("Delay aborted"));const s=setTimeout((()=>n()),e);null===(r=null===t||void 0===t?void 0:t.signal)||void 0===r||r.addEventListener("abort",(()=>{clearTimeout(s),o(new Error("Delay aborted"))}))}))}))}Object.defineProperty(t,"__esModule",{value:!0}),t.callForSuccess=o,t.delay=i},2581:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isValidObject=t.isIos=t.base64decode=t.base64encode=t.splitToUint8Arrays=t.concatUint8Arrays=t.toHexString=t.hexToByteArray=t.openOKXDeeplinkWithFallback=t.getUniversalLink=t.safeJsonStringify=t.safeJsonParse=t.logWarning=t.logError=t.logDebug=t.callForSuccess=void 0;var o=n(6229);Object.defineProperty(t,"callForSuccess",{enumerable:!0,get:function(){return o.callForSuccess}});var i=n(9323);Object.defineProperty(t,"logDebug",{enumerable:!0,get:function(){return i.logDebug}}),Object.defineProperty(t,"logError",{enumerable:!0,get:function(){return i.logError}}),Object.defineProperty(t,"logWarning",{enumerable:!0,get:function(){return i.logWarning}});var r=n(5058);Object.defineProperty(t,"safeJsonParse",{enumerable:!0,get:function(){return r.safeJsonParse}}),Object.defineProperty(t,"safeJsonStringify",{enumerable:!0,get:function(){return r.safeJsonStringify}});var s=n(1716);Object.defineProperty(t,"getUniversalLink",{enumerable:!0,get:function(){return s.getUniversalLink}}),Object.defineProperty(t,"openOKXDeeplinkWithFallback",{enumerable:!0,get:function(){return s.openOKXDeeplinkWithFallback}});var c=n(8384);Object.defineProperty(t,"hexToByteArray",{enumerable:!0,get:function(){return c.hexToByteArray}}),Object.defineProperty(t,"toHexString",{enumerable:!0,get:function(){return c.toHexString}}),Object.defineProperty(t,"concatUint8Arrays",{enumerable:!0,get:function(){return c.concatUint8Arrays}}),Object.defineProperty(t,"splitToUint8Arrays",{enumerable:!0,get:function(){return c.splitToUint8Arrays}}),Object.defineProperty(t,"base64encode",{enumerable:!0,get:function(){return c.base64encode}}),Object.defineProperty(t,"base64decode",{enumerable:!0,get:function(){return c.base64decode}}),Object.defineProperty(t,"isIos",{enumerable:!0,get:function(){return c.isIos}}),Object.defineProperty(t,"isValidObject",{enumerable:!0,get:function(){return c.isValidObject}})},9323:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logDebug=o,t.logError=i,t.logWarning=r;const n=!0;function o(...e){if("undefined"!=typeof console)try{n&&console.debug("[OKX_CONNECT_SDK]",...e)}catch(t){}}function i(...e){if("undefined"!=typeof console)try{console.error("[OKX_CONNECT_SDK]",...e)}catch(t){}}function r(...e){if("undefined"!=typeof console)try{console.warn("[OKX_CONNECT_SDK]",...e)}catch(t){}}},5058:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.safeJsonParse=s,t.safeJsonStringify=c;const o=n(9323),i=e=>JSON.stringify(e,((e,t)=>"bigint"===typeof t?t.toString()+"n":t)),r=e=>{const t=/:(\b\d{17,}|\b(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))(?=[,\}\]]|$)/g,n=e.replace(t,(e=>`"${e}n"`));return JSON.parse(n,((e,t)=>{const n="string"===typeof t&&t.match(/^\d+n$/);return n?BigInt(t.substring(0,t.length-1)):t}))};function s(e){if("string"!==typeof e)throw(0,o.logDebug)(e),new Error("Cannot safe json parse value of type "+typeof e);try{return r(e)}catch(t){return console.error("safeJsonParse error:",t),e}}function c(e){return"string"===typeof e?e:i(e)||""}},1716:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removeUrlLastSlash=i,t.addPathToUrl=r,t.getUniversalLink=s,t.openOKXDeeplinkWithFallback=c,t.getWindow=a;const o=n(2329);function i(e){return"/"===e.slice(-1)?e.slice(0,-1):e}function r(e,t){return i(e)+"/"+t}function s(e){const t=encodeURIComponent(e);return`${o.standardUniversalLink}?deeplink=${t}`}function c(e){var t;const n=s(e),i=!!(null===(t=a())||void 0===t?void 0:t.TelegramWebviewProxy),r=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;console.log("openOKXDeeplinkWithFallback fullUrl:",n);let c=!1;const l=1500,d=(Date.now(),o.standardUniversalLink),u=()=>{c||window.open(d,"_blank")};r?i?window.open(n,"_blank"):window.open(n,"_self"):(i?window.open(e):window.location.href=e,setTimeout(u,l),document.addEventListener("visibilitychange",(()=>{"hidden"===document.visibilityState&&(c=!0)})))}function a(){if("undefined"!==typeof window)return window}},8384:function(e,t,n){"use strict";n(6573),n(8100),n(7936),n(7467),n(4732),n(9577);var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.isValidObject=t.RANDOM_LENGTH=t.isBrowser=t.resolveLocalStorage=t.hasLocalStorage=t.hasBuiltInWebSocket=t.resolveWebSocketImplementation=void 0,t.hexToByteArray=h,t.toHexString=g,t.concatUint8Arrays=f,t.splitToUint8Arrays=p,t.base64encode=O,t.base64decode=E,t.checkWSUrl=C,t.hashKey=S,t.generateRandomBytes32=T,t.generateTopic=w,t.isIos=P;const i=o(n(998)),r=o(n(7294)),s=n(4972),c=n(9867),a=n(3351),l=n(5058),d=n(9323),u="base16";function h(e){if(e.length%2!==0)throw new Error(`Cannot convert ${e} to bytesArray`);const t=new Uint8Array(e.length/2);for(let n=0;n<e.length;n+=2)t[n/2]=parseInt(e.slice(n,n+2),16);return t}function g(e){let t="";return e.forEach((e=>{t+=("0"+(255&e).toString(16)).slice(-2)})),t}function f(e,t){const n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}function p(e,t){if(t>=e.length)throw new Error("Index is out of buffer");const n=e.slice(0,t),o=e.slice(t);return[n,o]}function v(e,t){const n=r.default.encodeBase64(e);return t?encodeURIComponent(n):n}function _(e,t){return t&&(e=decodeURIComponent(e)),r.default.decodeBase64(e)}function O(e,t){let n;return e instanceof Uint8Array?n=e:("string"!==typeof e&&(e=(0,l.safeJsonStringify)(e)),n=r.default.decodeUTF8(e)),v(n,t)}function E(e,t){const n=_(e,t);return{toString(){return r.default.encodeUTF8(n)},toObject(){try{return(0,l.safeJsonParse)(r.default.encodeUTF8(n))}catch(e){return null}},toUint8Array(){return n}}}function C(e){const t=e.match(new RegExp(/^\w+:/,"gi"));if(!t||!t.length)return!1;let n=t[0];return void 0!==n&&new RegExp("^wss?:").test(n)}const y=()=>"undefined"!==typeof WebSocket?WebSocket:"undefined"!==typeof n.g&&"undefined"!==typeof n.g.WebSocket?n.g.WebSocket:"undefined"!==typeof window&&"undefined"!==typeof window.WebSocket?window.WebSocket:"undefined"!==typeof self&&"undefined"!==typeof self.WebSocket?self.WebSocket:WebSocket;t.resolveWebSocketImplementation=y;const b=()=>"undefined"!==typeof WebSocket||"undefined"!==typeof n.g&&"undefined"!==typeof n.g.WebSocket||"undefined"!==typeof window&&"undefined"!==typeof window.WebSocket||"undefined"!==typeof self&&"undefined"!==typeof self.WebSocket;t.hasBuiltInWebSocket=b;const m=()=>"undefined"!==typeof n.g&&"undefined"!==typeof n.g.localStorage||"undefined"!==typeof window&&"undefined"!==typeof window.localStorage;t.hasLocalStorage=m;const R=()=>"undefined"!==typeof n.g&&"undefined"!==typeof n.g.localStorage?n.g.localStorage:"undefined"!==typeof window&&"undefined"!==typeof window.localStorage?window.localStorage:localStorage;t.resolveLocalStorage=R;const N=()=>"undefined"!==typeof window;function S(e,t=u){(0,d.logDebug)(`hash key called ${e}`);const n=(0,a.hash)((0,s.fromString)(e,t));return(0,c.toString)(n,t)}function T(){return i.default.randomBytes(t.RANDOM_LENGTH)}function w(){let e=T();return(0,d.logDebug)(`generate topic called ${e}`),S((0,c.toString)(e,u))}t.isBrowser=N,t.RANDOM_LENGTH=32;const D=e=>Object.getPrototypeOf(e)===Object.prototype&&Object.keys(e).length;function P(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream}t.isValidObject=D},9507:function(e,t,n){"use strict";t.EG=t._y=void 0;var o=n(1305);Object.defineProperty(t,"_y",{enumerable:!0,get:function(){return o.OKXTonConnect}});var i=n(7588);Object.defineProperty(t,"EG",{enumerable:!0,get:function(){return i.OKX_TON_CONNECTION_AND_TRANSACTION_EVENT}});var r=n(9325)},9607:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RpcParser=void 0;class n{isError(e){return"error"in e}}t.RpcParser=n},609:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sendTransactionParser=void 0;const o=n(9607);class i extends o.RpcParser{convertToRpcRequest(e){return{method:"ton_sendTransaction",params:e}}convertFromRpcResponse(e){return{boc:e.result.toString()}}}t.sendTransactionParser=new i},3281:function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.BridgeConnectionStorage=void 0;const i=n(523);class r{constructor(e){this.storage=e,this.storeKey="ton_connect_info"}storeConnection(e){return o(this,void 0,void 0,(function*(){return(0,i.logDebug)("BridgeConnectionStorage ==>> storeConnection ==>> connection:",e),this.storage.saveContent(JSON.stringify(e),this.storeKey)}))}removeConnection(){return o(this,void 0,void 0,(function*(){return(0,i.logDebug)("BridgeConnectionStorage ==>> removeConnection"),this.storage.clearCache(this.storeKey)}))}getConnection(){return o(this,void 0,void 0,(function*(){const e=this.storage.getItem(this.storeKey);if((0,i.logDebug)("BridgeConnectionStorage ==>> getConnection ==>>this.storage: ",this.storage),!e||!(null===e||void 0===e?void 0:e.content))return null;try{const t=null===e||void 0===e?void 0:e.content;if(t){let e;return e=JSON.parse(t),(0,i.logDebug)("BridgeConnectionStorage ==>> getConnection ==>>connection: ",e),e}return null}catch(t){return null}}))}getHttpConnection(){return o(this,void 0,void 0,(function*(){const e=yield this.getConnection();if(!e)throw new i.OkxConnectError(i.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"Trying to read HTTP connection source while nothing is stored");return e}))}storeLastWalletEventId(e){return o(this,void 0,void 0,(function*(){const t=yield this.getConnection();if(t&&"connectEvent"in t)return t.lastWalletEventId=e,this.storeConnection(t)}))}getLastWalletEventId(){return o(this,void 0,void 0,(function*(){const e=yield this.getConnection();if(e&&"lastWalletEventId"in e)return e.lastWalletEventId}))}}t.BridgeConnectionStorage=r},854:function(e,t,n){"use strict";n(4114),n(4979);var o=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.BridgeProvider=void 0;const i=n(310),r=n(523),s=n(523),c=n(3281);class a{constructor(e){this.storage=e,this.type="http",this.listeners=[],this.connectManager=new r.ConnectionManager,this.walletConnectionSource={universalLink:r.standardUniversalLink},this.engine=new r.Engine(this.connectManager),this.openUniversalLink=!1,this.connectionStorage=new c.BridgeConnectionStorage(e)}static fromStorage(e){return o(this,void 0,void 0,(function*(){(0,r.logDebug)("bridge-provider ==>> fromStorage ==>>storage:",e);const t=new c.BridgeConnectionStorage(e),n=yield t.getHttpConnection();if((0,i.isPendingConnectionHttp)(n))return null;const o=new a(e);return o.openUniversalLink=n.openUniversalLink,o}))}connect(e,t,n){return o(this,void 0,void 0,(function*(){var o,i,c;(0,r.logDebug)("bridge-provider ==>> connect_1 ==>>message:",e),(0,r.logDebug)("bridge-provider ==>> connect_1 ==>>redirect:",t),(0,r.logDebug)("bridge-provider ==>> connect_1 ==>>openUniversalLink:",n);try{const a=this.connectManager.getConnectInfo(),l=yield this.engine.getRequestId();this.openUniversalLink=n;const d={protocolVer:Number(s.tonConnectSdkVersion),topic:a.channelId,clientId:a.clientId,requestId:l,dAppInfo:e.dappInfo,requests:e.items,redirect:null!==t&&void 0!==t?t:"none"};(0,r.logDebug)("bridge-provider ==>> connect_2 ==>>connectRequest:",d);const u=JSON.stringify(d),h=(new TextEncoder).encode(u),g=btoa(String.fromCharCode(...h)),f=`${r.standardDeeplink}?param=${g}`;(0,r.logDebug)("bridge-provider ==>> connect_2 ==>>fullUrl:",f),yield this.connectionStorage.storeConnection({type:"http",connectionSource:this.walletConnectionSource,channelId:a.channelId,openUniversalLink:n});const p=(0,r.isIos)();return p&&null!==n&&!0===n&&(0,r.openOKXDeeplinkWithFallback)(f),yield null===(o=this.connectManager)||void 0===o?void 0:o.disconnect(!1),null===(i=this.engine)||void 0===i||i.bindRequestForPromise(l,this.connectListener.bind(this)),null===(c=this.engine)||void 0===c||c.addDisconnectListener(this.disconnectListener.bind(this)),yield this.connectManager.connect(),p||null!==n&&!0===n&&(0,r.openOKXDeeplinkWithFallback)(f),(0,r.getUniversalLink)(f)}catch(a){throw console.error("Error connecting:",a),new r.OkxConnectError(r.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"connect error")}}))}listen(e){return this.listeners.push(e),()=>this.listeners=this.listeners.filter((t=>t!==e))}disconnectListener(){return o(this,void 0,void 0,(function*(){(0,r.logDebug)("bridge-provider ==>> disconnectListener");const e={event:"disconnect",requestId:Number(1),payload:{}};this.listeners.forEach((t=>t(e))),yield this.closeConnection()}))}connectListener(e){return o(this,void 0,void 0,(function*(){const t=e;if((0,r.logDebug)("bridge-provider ==>> connectListener_1 ==>>walletMessage:",t),void 0!==t.requestId){const e=yield this.connectionStorage.getLastWalletEventId();if(void 0!==e&&Number(t.requestId)<=e)return void(0,r.logError)(`Received event id (=${t.requestId}) must be greater than stored last wallet event id (=${e}) `)}const n=this.listeners;if("connect"===t.method){const e=t.payload.responses.find((e=>"ton_addr"===e.name)),o=t.payload.responses.find((e=>"ton_proof"===e.name)),i=t.payload.wallet,s={platform:i.platform,appName:i.appName,appVersion:i.appVersion,maxProtocolVersion:i.maxProtocolVersion,features:i.features.ton},c=[];e&&c.push(e),o&&c.push(o);const a=yield this.connectionStorage.getConnection(),l={type:"http",lastWalletEventId:Number(t.requestId),connectEvent:{event:"connect",payload:{items:c,device:s}},connectionSource:this.walletConnectionSource,channelId:null===a||void 0===a?void 0:a.channelId,openUniversalLink:null===a||void 0===a?void 0:a.openUniversalLink};(0,r.logDebug)("bridge-provider ==>> connectListener_2 ==>>storeConnection:",l),yield this.connectionStorage.storeConnection(l);const d={event:"connect",requestId:Number(t.requestId),payload:l.connectEvent.payload};(0,r.logDebug)("bridge-provider ==>> connectListener_3 ==>>listeners.forEach:",d),n.forEach((e=>e(d)))}else if("connect_error"===t.method){yield this.connectionStorage.storeLastWalletEventId(Number(t.requestId));const e={event:"connect_error",requestId:Number(t.requestId),payload:t.payload};(0,r.logDebug)("bridge-provider ==>> connectListener_4 ==>>connect_error:",e),n.forEach((t=>t(e)))}}))}closeConnection(){return o(this,arguments,void 0,(function*(e=!1,t=!1){var n,o;(0,r.logDebug)("bridge-provider ==>> closeConnection ==>>fromRestore:",e," needOpenUrl:",t),this.listeners=[],t||(yield null===(n=this.connectManager)||void 0===n?void 0:n.disconnect(e)),e||(null===(o=this.engine)||void 0===o||o.disconnect(),yield this.connectionStorage.removeConnection())}))}restoreConnection(){return o(this,void 0,void 0,(function*(){var e;(0,r.logDebug)("bridge-provider ==>> restoreConnection_1");const t=yield this.connectionStorage.getHttpConnection();if(t&&!(0,i.isPendingConnectionHttp)(t))if((0,r.logDebug)("bridge-provider ==>> restoreConnection_2 ==>>storedConnection.channelId:",t.channelId),t.channelId)try{const n={event:"connect",requestId:Number(0),payload:t.connectEvent.payload};this.listeners.forEach((e=>e(n)));const o=t.channelId;(0,r.logDebug)("bridge-provider ==>> restoreConnection_3 ==>>this.connectManager.restoreConnect:",o),null===(e=this.engine)||void 0===e||e.addDisconnectListener(this.disconnectListener.bind(this)),yield this.connectManager.restoreConnect(o)}catch(n){(0,r.logDebug)("bridge-provider ==>> restoreConnection_4 ==>>closeConnection_1"),yield this.closeConnection()}else(0,r.logDebug)("bridge-provider ==>> restoreConnection_4 ==>>closeConnection_2"),yield this.closeConnection()}))}openOKXWallet(){(0,r.logDebug)("bridge-provider ==>> openOKXWallet",this.openUniversalLink),this.openUniversalLink&&(0,r.openOKXDeeplinkWithFallback)(r.standardDeeplink)}disconnect(){return o(this,void 0,void 0,(function*(){return(0,r.logDebug)("bridge-provider ==>> disconnect_1"),new Promise((e=>o(this,void 0,void 0,(function*(){let t=!1;const n=()=>{t||(t=!0,this.closeConnection().then(e))};try{yield this.sendRequest({method:"disconnect"},{onRequestSent:n,attempts:1})}catch(o){t||this.closeConnection().then(e)}finally{n()}}))))}))}sendRequest(e,t){return(0,r.logDebug)("bridge-provider ==>> sendRequest"),new Promise(((n,i)=>o(this,void 0,void 0,(function*(){var o;try{yield null===(o=this.engine)||void 0===o?void 0:o.send(e,{resolve:function(e){n(e)},onAck:function(){var e;null===(e=null===t||void 0===t?void 0:t.onRequestSent)||void 0===e||e.call(t)}},{attempts:null===t||void 0===t?void 0:t.attempts})}catch(r){i(r)}}))))}}t.BridgeProvider=a},310:function(e,t){"use strict";function n(e){return!("connectEvent"in e)}Object.defineProperty(t,"__esModule",{value:!0}),t.isPendingConnectionHttp=n},1305:function(e,t,n){"use strict";n(4114);var o=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))},i=this&&this.__rest||function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(n[o[i]]=e[o[i]])}return n};Object.defineProperty(t,"__esModule",{value:!0}),t.OKXTonConnect=void 0;const r=n(854),s=n(523),c=n(1213),a=n(8183),l=n(609),d=n(3281),u=n(7028),h=n(523);class g{constructor(e){if(this._wallet=null,this.provider=null,this.statusChangeSubscriptions=[],this.statusChangeErrorSubscriptions=[],this.storage=new s.Storage(u.OKXCONNECTOR_TON_KEY),!e.metaData)throw new s.OkxConnectError(s.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"dapp metaData can not be null");this.dappSettings={metaData:Object.assign(Object.assign({},e.metaData),{url:window.location.hostname})},this.tracker=new a.TonConnectTracker({tonConnectSdkVersion:h.tonConnectSdkVersion}),this.bridgeConnectionStorage=new d.BridgeConnectionStorage(this.storage)}get connected(){return null!==this._wallet}get account(){var e;return(null===(e=this._wallet)||void 0===e?void 0:e.account)||null}get wallet(){return this._wallet}set wallet(e){this._wallet=e,this.statusChangeSubscriptions.forEach((e=>e(this._wallet)))}connect(e){return o(this,void 0,void 0,(function*(){var t;if((0,s.logDebug)("ton-Connect ==>> connect_1 >> request:",e),this.connected)throw new s.OkxConnectError(s.OKX_CONNECT_ERROR_CODES.ALREADY_CONNECTED_ERROR,"Connected Wallet");return yield null===(t=this.provider)||void 0===t?void 0:t.closeConnection(!1,!0),this.provider=new r.BridgeProvider(this.storage),this.provider.listen(this.walletEventsListener.bind(this)),this.tracker.trackConnectionStarted(),yield this.provider.connect(this.createConnectRequest(e),null===e||void 0===e?void 0:e.redirect,null===e||void 0===e?void 0:e.openUniversalLink)}))}walletEventsListener(e){switch((0,s.logDebug)("ton-Connect ==>> walletEventsListener_1 >> e:",e),e.event){case"connect":this.onWalletConnected(e.payload);break;case"connect_error":this.onWalletConnectError(e.payload);break;case"disconnect":this.onWalletDisconnected("wallet")}}onWalletConnected(e){(0,s.logDebug)("ton-Connect ==>> onWalletConnected_1 >> connectEvent:",e);const t=e.items.find((e=>"ton_addr"===e.name)),n=e.items.find((e=>"ton_proof"===e.name));if(!t)throw new s.OkxConnectError(s.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"ton_addr connection item was not found");const o={device:e.device,provider:this.provider.type,account:{address:t.address,chain:t.network,walletStateInit:t.walletStateInit,publicKey:t.publicKey}};n&&(o.connectItems={tonProof:n}),this.wallet=o,(0,s.logDebug)("ton-Connect ==>> onWalletConnected_2 >> wallet:",o),this.tracker.trackConnectionCompleted(o)}onWalletConnectError(e){var t;(0,s.logDebug)("ton-Connect ==>> onWalletConnectError_1 >> connectEventError:",e);const n=new s.OkxConnectError(e.code,e.message);(0,s.logDebug)("ton-Connect ==>> onWalletConnectError_1 >> error:",n),this.statusChangeErrorSubscriptions.forEach((e=>e(n))),this.tracker.trackConnectionError(null!==(t=e.message)&&void 0!==t?t:"",e.code)}onWalletDisconnected(e){this.tracker.trackDisconnection(this.wallet,e),this.wallet=null}disconnect(){return o(this,void 0,void 0,(function*(){var e;if((0,s.logDebug)("ton-Connect ==>> disconnect_1"),!this.connected)throw new s.OkxConnectError(s.OKX_CONNECT_ERROR_CODES.NOT_CONNECTED_ERROR,"wallet is not connected");(0,s.logDebug)("ton-Connect ==>> disconnect_222"),this.onWalletDisconnected("dapp"),yield null===(e=this.provider)||void 0===e?void 0:e.disconnect()}))}onStatusChange(e,t){return this.statusChangeSubscriptions.push(e),t&&this.statusChangeErrorSubscriptions.push(t),()=>{this.statusChangeSubscriptions=this.statusChangeSubscriptions.filter((t=>t!==e)),t&&(this.statusChangeErrorSubscriptions=this.statusChangeErrorSubscriptions.filter((e=>e!==t)))}}restoreConnection(){return o(this,void 0,void 0,(function*(){var e;(0,s.logDebug)("ton-Connect ==>> restoreConnection_1"),this.tracker.trackConnectionRestoringStarted();let t=null;try{t=yield r.BridgeProvider.fromStorage(this.storage)}catch(n){return this.tracker.trackConnectionRestoringError("Provider is not restored"),yield this.bridgeConnectionStorage.removeConnection(),null===t||void 0===t||t.closeConnection(),void(t=null)}if(!t)return(0,s.logError)("Provider is not restored"),void this.tracker.trackConnectionRestoringError("Provider is not restored");(0,s.logDebug)("ton-Connect ==>> restoreConnection_2 ==>> Provider is restored "),null===(e=this.provider)||void 0===e||e.closeConnection(!0,!1),this.provider=t,t.listen(this.walletEventsListener.bind(this)),yield this.provider.restoreConnection(),this.connected?this.tracker.trackConnectionRestoringCompleted(this.wallet):this.tracker.trackConnectionRestoringError("Connection restoring failed")}))}sendTransaction(e,t){return o(this,void 0,void 0,(function*(){var n;(0,s.logDebug)("ton-Connect ==>> sendTransaction_1",e),this.checkConnection(),(0,c.checkSendTransactionSupport)(this.wallet.device.features,{requiredMessagesNumber:e.messages.length}),this.tracker.trackTransactionSentForSignature(this.wallet,e),(0,s.logDebug)("ton-Connect ==>> sendTransaction_2 ==>> check params");const{validUntil:o}=e,r=i(e,["validUntil"]),a=e.from||this.account.address;let d=this.account.chain;(0,s.logDebug)("ton-Connect ==>> sendTransaction_2 ==>> await sendRequest",d),(0,s.isIos)()&&(null===(n=this.provider)||void 0===n||n.openOKXWallet());const u=yield this.provider.sendRequest(l.sendTransactionParser.convertToRpcRequest(Object.assign(Object.assign({},r),{valid_until:o,from:a,network:d})),{onRequestSent:()=>{var e,n;(0,s.isIos)()||null===(e=this.provider)||void 0===e||e.openOKXWallet(),null===(n=null===t||void 0===t?void 0:t.onRequestSent)||void 0===n||n.call(t)}});if((0,s.logDebug)("ton-Connect ==>> sendTransaction_3 ==>>sendRequest response:",u),l.sendTransactionParser.isError(u))throw this.tracker.trackTransactionSigningFailed(this.wallet,e,u.error.message,u.error.code),new s.OkxConnectError(u.error.code,u.error.message);const h=l.sendTransactionParser.convertFromRpcResponse(u);return this.tracker.trackTransactionSigned(this.wallet,e,h),h}))}checkConnection(){if((0,s.logDebug)("ton-Connect ==>> checkConnection"),!this.connected)throw new s.OkxConnectError(s.OKX_CONNECT_ERROR_CODES.NOT_CONNECTED_ERROR,"Wallet not connected")}createConnectRequest(e){(0,s.logDebug)("ton-Connect ==>> createConnectRequest");const t=[{name:"ton_addr"}];return(null===e||void 0===e?void 0:e.tonProof)&&t.push({name:"ton_proof",payload:e.tonProof}),{dappInfo:this.dappSettings.metaData,items:t}}static getWallets(){return this.walletsList}}t.OKXTonConnect=g,g.walletsList=[{appName:"okxTonWallet",name:"OKX Wallet",imageUrl:"https://static.okx.com/cdn/assets/imgs/247/58E63FEA47A2B7D7.png",aboutUrl:"https://www.okx.com/web3",universalLink:"https://www.okx.com/download",deepLink:"",platforms:["ios","android"]}]},3267:function(e,t){"use strict";var n=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserEventDispatcher=void 0;class o{constructor(){this.window=window}dispatchEvent(e,t){return n(this,void 0,void 0,(function*(){var n;const o=new CustomEvent(e,{detail:t});null===(n=this.window)||void 0===n||n.dispatchEvent(o)}))}addEventListener(e,t,o){return n(this,void 0,void 0,(function*(){var n;return null===(n=this.window)||void 0===n||n.addEventListener(e,t,o),()=>{var n;return null===(n=this.window)||void 0===n?void 0:n.removeEventListener(e,t)}}))}}t.BrowserEventDispatcher=o},7588:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserEventDispatcher=t.createVersionInfo=t.createTransactionSigningFailedEvent=t.createTransactionSignedEvent=t.createTransactionSentForSignatureEvent=t.createDisconnectionEvent=t.createConnectionStartedEvent=t.createConnectionRestoringStartedEvent=t.createConnectionRestoringErrorEvent=t.createConnectionRestoringCompletedEvent=t.createConnectionErrorEvent=t.createConnectionCompletedEvent=t.createResponseVersionEvent=t.createRequestVersionEvent=t.OKX_TON_CONNECTION_AND_TRANSACTION_EVENT=void 0;var o=n(924);Object.defineProperty(t,"OKX_TON_CONNECTION_AND_TRANSACTION_EVENT",{enumerable:!0,get:function(){return o.OKX_TON_CONNECTION_AND_TRANSACTION_EVENT}});var i=n(8593);Object.defineProperty(t,"createRequestVersionEvent",{enumerable:!0,get:function(){return i.createRequestVersionEvent}}),Object.defineProperty(t,"createResponseVersionEvent",{enumerable:!0,get:function(){return i.createResponseVersionEvent}}),Object.defineProperty(t,"createConnectionCompletedEvent",{enumerable:!0,get:function(){return i.createConnectionCompletedEvent}}),Object.defineProperty(t,"createConnectionErrorEvent",{enumerable:!0,get:function(){return i.createConnectionErrorEvent}}),Object.defineProperty(t,"createConnectionRestoringCompletedEvent",{enumerable:!0,get:function(){return i.createConnectionRestoringCompletedEvent}}),Object.defineProperty(t,"createConnectionRestoringErrorEvent",{enumerable:!0,get:function(){return i.createConnectionRestoringErrorEvent}}),Object.defineProperty(t,"createConnectionRestoringStartedEvent",{enumerable:!0,get:function(){return i.createConnectionRestoringStartedEvent}}),Object.defineProperty(t,"createConnectionStartedEvent",{enumerable:!0,get:function(){return i.createConnectionStartedEvent}}),Object.defineProperty(t,"createDisconnectionEvent",{enumerable:!0,get:function(){return i.createDisconnectionEvent}}),Object.defineProperty(t,"createTransactionSentForSignatureEvent",{enumerable:!0,get:function(){return i.createTransactionSentForSignatureEvent}}),Object.defineProperty(t,"createTransactionSignedEvent",{enumerable:!0,get:function(){return i.createTransactionSignedEvent}}),Object.defineProperty(t,"createTransactionSigningFailedEvent",{enumerable:!0,get:function(){return i.createTransactionSigningFailedEvent}}),Object.defineProperty(t,"createVersionInfo",{enumerable:!0,get:function(){return i.createVersionInfo}});var r=n(3267);Object.defineProperty(t,"BrowserEventDispatcher",{enumerable:!0,get:function(){return r.BrowserEventDispatcher}})},8183:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TonConnectTracker=void 0;const o=n(8593),i=n(3267);class r{get version(){return(0,o.createVersionInfo)({ton_connect_sdk_lib:this.tonConnectSdkVersion,ton_connect_ui_lib:this.tonConnectSdkVersion})}constructor(e){this.eventPrefix="ton-connect-",this.eventDispatcher=new i.BrowserEventDispatcher,this.tonConnectSdkVersion=e.tonConnectSdkVersion}dispatchUserActionEvent(e){try{this.eventDispatcher.dispatchEvent(`${this.eventPrefix}${e.type}`,e).catch()}catch(t){}}trackConnectionStarted(...e){try{const t=(0,o.createConnectionStartedEvent)(this.version,...e);this.dispatchUserActionEvent(t)}catch(t){}}trackConnectionDeepLink(...e){try{const t=(0,o.createConnectionDeepLinkEvent)(...e);this.dispatchUserActionEvent(t)}catch(t){}}trackConnectionCompleted(...e){try{const t=(0,o.createConnectionCompletedEvent)(this.version,...e);this.dispatchUserActionEvent(t)}catch(t){}}trackConnectionError(...e){try{const t=(0,o.createConnectionErrorEvent)(this.version,...e);this.dispatchUserActionEvent(t)}catch(t){}}trackConnectionRestoringStarted(...e){try{const t=(0,o.createConnectionRestoringStartedEvent)(this.version,...e);this.dispatchUserActionEvent(t)}catch(t){}}trackConnectionRestoringCompleted(...e){try{const t=(0,o.createConnectionRestoringCompletedEvent)(this.version,...e);this.dispatchUserActionEvent(t)}catch(t){}}trackConnectionRestoringError(...e){try{const t=(0,o.createConnectionRestoringErrorEvent)(this.version,...e);this.dispatchUserActionEvent(t)}catch(t){}}trackDisconnection(...e){try{const t=(0,o.createDisconnectionEvent)(this.version,...e);this.dispatchUserActionEvent(t)}catch(t){}}trackTransactionSentForSignature(...e){try{const t=(0,o.createTransactionSentForSignatureEvent)(this.version,...e);this.dispatchUserActionEvent(t)}catch(t){}}trackTransactionSigned(...e){try{const t=(0,o.createTransactionSignedEvent)(this.version,...e);this.dispatchUserActionEvent(t)}catch(t){}}trackTransactionSigningFailed(...e){try{const t=(0,o.createTransactionSigningFailedEvent)(this.version,...e);this.dispatchUserActionEvent(t)}catch(t){}}}t.TonConnectTracker=r},924:function(e,t){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.OKX_TON_CONNECTION_AND_TRANSACTION_EVENT=void 0,function(e){e["OKX_TON_CONNECTION_STARTED"]="ton-connect-connection-started",e["OKX_TON_CONNECTION_COMPLETED"]="ton-connect-connection-completed",e["OKX_TON_CONNECTION_ERROR"]="ton-connect-connection-error",e["OKX_TON_CONNECTION_RESTORING_STARTED"]="ton-connect-connection-restoring-started",e["OKX_TON_CONNECTION_RESTORING_COMPLETED"]="ton-connect-connection-restoring-completed",e["OKX_TON_CONNECTION_RESTORING_ERROR"]="ton-connect-connection-restoring-error",e["OKX_TON_DISCONNECTION"]="ton-connect-disconnection",e["OKX_TON_TRANSACTION_SENT_FOR_SIGNATURE"]="ton-connect-transaction-sent-for-signature",e["OKX_TON_TRANSACTION_SIGNED"]="ton-connect-transaction-signed",e["OKX_TON_TRANSACTION_SIGNING_FAILED"]="ton-connect-transaction-signing-failed"}(n||(t.OKX_TON_CONNECTION_AND_TRANSACTION_EVENT=n={}))},8593:function(e,t){"use strict";function n(){return{type:"request-version"}}function o(e){return{type:"response-version",version:e}}function i(e){return{ton_connect_sdk_lib:e.ton_connect_sdk_lib,ton_connect_ui_lib:e.ton_connect_ui_lib}}function r(e,t){var n,o,r,s,c,a,l,d;const u=(null===(n=null===t||void 0===t?void 0:t.connectItems)||void 0===n?void 0:n.tonProof)&&"proof"in t.connectItems.tonProof,h=u?"ton_proof":"ton_addr";return{wallet_address:null!==(r=null===(o=null===t||void 0===t?void 0:t.account)||void 0===o?void 0:o.address)&&void 0!==r?r:null,wallet_type:null!==(s=null===t||void 0===t?void 0:t.device.appName)&&void 0!==s?s:null,wallet_version:null!==(c=null===t||void 0===t?void 0:t.device.appVersion)&&void 0!==c?c:null,auth_type:h,custom_data:Object.assign({chain_id:null!==(l=null===(a=null===t||void 0===t?void 0:t.account)||void 0===a?void 0:a.chain)&&void 0!==l?l:null,provider:null!==(d=null===t||void 0===t?void 0:t.provider)&&void 0!==d?d:null},i(e))}}function s(e){return{type:"connection-started",custom_data:i(e)}}function c(e){return{type:"connection-get-deeplink",deeplinkUrl:e}}function a(e,t){return Object.assign({type:"connection-completed",is_success:!0},r(e,t))}function l(e,t,n){return{type:"connection-error",is_success:!1,error_message:t,error_code:null!==n&&void 0!==n?n:null,custom_data:i(e)}}function d(e){return{type:"connection-restoring-started",custom_data:i(e)}}function u(e,t){return Object.assign({type:"connection-restoring-completed",is_success:!0},r(e,t))}function h(e,t){return{type:"connection-restoring-error",is_success:!1,error_message:t,custom_data:i(e)}}function g(e,t){var n,o,i,r;return{valid_until:null!==(n=String(t.validUntil))&&void 0!==n?n:null,from:null!==(r=null!==(o=t.from)&&void 0!==o?o:null===(i=null===e||void 0===e?void 0:e.account)||void 0===i?void 0:i.address)&&void 0!==r?r:null,messages:t.messages.map((e=>{var t,n;return{address:null!==(t=e.address)&&void 0!==t?t:null,amount:null!==(n=e.amount)&&void 0!==n?n:null}}))}}function f(e,t,n){return Object.assign(Object.assign({type:"transaction-sent-for-signature"},r(e,t)),g(t,n))}function p(e,t,n,o){return Object.assign(Object.assign({type:"transaction-signed",is_success:!0,signed_transaction:o.boc},r(e,t)),g(t,n))}function v(e,t,n,o,i){return Object.assign(Object.assign({type:"transaction-signing-failed",is_success:!1,error_message:o,error_code:null!==i&&void 0!==i?i:null},r(e,t)),g(t,n))}function _(e,t,n){return Object.assign({type:"disconnection",scope:n},r(e,t))}Object.defineProperty(t,"__esModule",{value:!0}),t.createRequestVersionEvent=n,t.createResponseVersionEvent=o,t.createVersionInfo=i,t.createConnectionStartedEvent=s,t.createConnectionDeepLinkEvent=c,t.createConnectionCompletedEvent=a,t.createConnectionErrorEvent=l,t.createConnectionRestoringStartedEvent=d,t.createConnectionRestoringCompletedEvent=u,t.createConnectionRestoringErrorEvent=h,t.createTransactionSentForSignatureEvent=f,t.createTransactionSignedEvent=p,t.createTransactionSigningFailedEvent=v,t.createDisconnectionEvent=_},505:function(e,t,n){"use strict";n(6573),n(8100),n(7936),n(7467),n(4732),n(9577),Object.defineProperty(t,"__esModule",{value:!0}),t.toUserFriendlyAddress=s;const o=n(523),i=81,r=128;function s(e,t=!1){const{wc:n,hex:s}=c(e);let l=i;t&&(l|=r);const d=new Int8Array(34);d[0]=l,d[1]=n,d.set(s,2);const u=new Uint8Array(36);u.set(d),u.set(a(d),34);let h=(0,o.base64encode)(u,!1);return h.replace(/\+/g,"-").replace(/\//g,"_")}function c(e){if(!e.includes(":"))throw new Error(`Wrong address ${e}. Address must include ":".`);const t=e.split(":");if(2!==t.length)throw new Error(`Wrong address ${e}. Address must include ":" only once.`);const n=parseInt(t[0]);if(0!==n&&-1!==n)throw new Error(`Wrong address ${e}. WC must be eq 0 or -1, but ${n} received.`);const o=t[1];if(64!==(null===o||void 0===o?void 0:o.length))throw new Error(`Wrong address ${e}. Hex part must be 64bytes length, but ${null===o||void 0===o?void 0:o.length} received.`);return{wc:n,hex:d(o)}}function a(e){const t=4129;let n=0;const o=new Uint8Array(e.length+2);o.set(e);for(let i of o){let e=128;while(e>0)n<<=1,i&e&&(n+=1),e>>=1,n>65535&&(n&=65535,n^=t)}return new Uint8Array([Math.floor(n/256),n%256])}const l={};for(let u=0;u<=255;u++){let e=u.toString(16);e.length<2&&(e="0"+e),l[e]=u}function d(e){e=e.toLowerCase();const t=e.length;if(t%2!==0)throw new Error("Hex string must have length a multiple of 2: "+e);const n=t/2,o=new Uint8Array(n);for(let i=0;i<n;i++){const t=2*i,n=e.substring(t,t+2);if(!l.hasOwnProperty(n))throw new Error("Invalid hex character: "+n);o[i]=l[n]}return o}},7028:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OKXCONNECTOR_TON_KEY=void 0,t.OKXCONNECTOR_TON_KEY="OKXStorage_ctc"},1213:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.checkSendTransactionSupport=i;const o=n(523);function i(e,t){const n=e.includes("ton_sendTransaction");if(!n)throw new o.OkxConnectError(o.OKX_CONNECT_ERROR_CODES.METHOD_NOT_SUPPORTED,"Wallet doesn't support SendTransaction feature.");if(4<t.requiredMessagesNumber)throw new o.OkxConnectError(o.OKX_CONNECT_ERROR_CODES.METHOD_NOT_SUPPORTED,`Wallet is not able to handle such SendTransaction request. Max support messages number is 4, but ${t.requiredMessagesNumber} is required.`)}},9325:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toUserFriendlyAddress=t.removeUrlLastSlash=t.addPathToUrl=t.isTelegramUrl=t.encodeTelegramUrlParameters=void 0;var o=n(1980);Object.defineProperty(t,"encodeTelegramUrlParameters",{enumerable:!0,get:function(){return o.encodeTelegramUrlParameters}}),Object.defineProperty(t,"isTelegramUrl",{enumerable:!0,get:function(){return o.isTelegramUrl}}),Object.defineProperty(t,"addPathToUrl",{enumerable:!0,get:function(){return o.addPathToUrl}}),Object.defineProperty(t,"removeUrlLastSlash",{enumerable:!0,get:function(){return o.removeUrlLastSlash}});var i=n(505);Object.defineProperty(t,"toUserFriendlyAddress",{enumerable:!0,get:function(){return i.toUserFriendlyAddress}})},1980:function(e,t,n){"use strict";function o(e){return"/"===e.slice(-1)?e.slice(0,-1):e}function i(e,t){return o(e)+"/"+t}function r(e){if(!e)return!1;const t=new URL(e);return"tg:"===t.protocol||"t.me"===t.hostname}function s(e){let t=e;return t=t.replace(/\./g,"%2E"),t=t.replace(/-/g,"%2D"),t=t.replace(/_/g,"%5F"),t=t.replace(/&/g,"-"),t=t.replace(/=/g,"__"),t=t.replace(/%/g,"--"),t}n(4603),n(7566),n(8721),Object.defineProperty(t,"__esModule",{value:!0}),t.removeUrlLastSlash=o,t.addPathToUrl=i,t.isTelegramUrl=r,t.encodeTelegramUrlParameters=s},3325:function(e,t,n){"use strict";n(7642),n(8004),n(3853),n(5876),n(2475),n(5024),n(1698);var o=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OKXUniversalProvider=void 0;const r=n(169),s=i(n(8403)),c=n(4417),a=i(n(1571)),l=n(2776),d=n(523),u=n(3669);class h{static init(e){return o(this,void 0,void 0,(function*(){const t=new h(e);return yield t.initialize(),t}))}constructor(e){this.rpcProviders={},this.events=new a.default,this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.providerOpts={metadata:Object.assign({},e.metadata)}}request(e,t){return o(this,void 0,void 0,(function*(){const[n,o]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");(0,d.logDebug)("UniversalProvider request >>args>>>: ",e);const i=Object.assign(Object.assign({},e),{chainId:`${n}:${o}`});return(0,d.logDebug)("UniversalProvider request >>requestParam>1111>>: ",i),(0,d.logDebug)("UniversalProvider request >>requestParam>>>: ",JSON.stringify(i)),(0,d.logDebug)("UniversalProvider request >>this.rpcProviders11>>>: ",n,this.getProvider(n)),(0,d.logDebug)("UniversalProvider request >>this.rpcProviders11>>>: ",this.rpcProviders),yield this.getProvider(n).request(i)}))}enable(){return o(this,void 0,void 0,(function*(){if(!this.client)throw new Error("Sign Client not initialized");this.session;const e=yield this.requestAccounts();return e}))}disconnect(){return o(this,void 0,void 0,(function*(){if(!this.session)throw new d.OkxConnectError(d.OKX_CONNECT_ERROR_CODES.NOT_CONNECTED_ERROR);return new Promise((e=>o(this,void 0,void 0,(function*(){let t=!1;const n=()=>{t||(t=!0,this.cleanup().then(e),this.client.engine.connectionManager.disconnect())};try{yield this.client.disconnect(),n()}catch(o){t||this.cleanup().then(e)}finally{n()}}))))}))}connect(e){return o(this,void 0,void 0,(function*(){if(!this.client)throw new d.OkxConnectError(d.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"Sign Client not initialized");this.setNamespaces(e);let t=yield this.client.connect(e);if(console.log(`UniversalProvider connect success ====> ${JSON.stringify(t)}`),t)return this.session=t,this.onConnect(),t}))}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}pair(e){return o(this,void 0,void 0,(function*(){this.shouldAbortPairingAttempt=!1;let e=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(e>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached")}while(!this.session);return this.onConnect(),this.session}))}setDefaultChain(e,t){try{if(!this.session)return;const[n,o]=this.validateChain(e),i=this.getProvider(n);i.setDefaultChain(o,t)}catch(n){if(!/Please call connect/.test(n.message))throw n}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}checkStorage(){return o(this,void 0,void 0,(function*(){let e=yield this.getFromStore("connectSession"),t=yield this.getFromStore("namespaces");if(console.log(e),e){let n=e;this.session=n,this.client.session=this.session,t&&(this.namespaces=t),console.log("[evm u-provider] do reconnection",this.session),yield this.client.restoreconnect(n),this.createProviders(),setTimeout((()=>{this.events.emit("reconnect",{session:this.session})}),100)}}))}initialize(){return o(this,void 0,void 0,(function*(){this.client=new l.SignClient(this.providerOpts.metadata),yield this.checkStorage(),this.registerEventListeners()}))}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map((e=>(0,u.parseNamespaceKey)(e))))];(0,r.setGlobal)("client",this.client),(0,r.setGlobal)("events",this.events),e.forEach((e=>{if(!this.session)return;const t=this.session.namespaces,n=t[e];switch((0,d.logDebug)("init eip155 >> ",n),e){case"eip155":const t={namespace:n};this.rpcProviders[e]=new s.default(t);break;case"sol":break;case"ton":break}}))}registerEventListeners(){if("undefined"===typeof this.client)throw new Error("Sign Client is not initialized");this.client.engine.addDisconnectListener((()=>{this.cleanup(),this.client.engine.connectionManager.disconnect(),this.events.emit("disconnect")})),this.on(c.PROVIDER_EVENTS.DEFAULT_CHAIN_CHANGED,(e=>{this.onChainChanged(e,!0)})),this.on(c.PROVIDER_EVENTS.UPDATE_NAMESPACES,(e=>{if(e){const t=Object.keys(e)[0];this.session&&(this.session.namespaces[t]=e[t],this.session&&this.persist("connectSession",this.session))}}))}getProvider(e){return(0,d.logDebug)("current get providers",this.rpcProviders),(0,d.logDebug)("query namespace: ",e),this.rpcProviders[e]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach((e=>{var t;this.getProvider(e).updateNamespace(null===(t=this.session)||void 0===t?void 0:t.namespaces[e])}))}setNamespaces(e){const{namespaces:t,sessionConfig:n}=e;t&&Object.keys(t).length&&(this.namespaces=t),t&&Object.keys(t).length&&(this.optionalNamespaces=t),this.sessionConfig=n,this.client.sessionConfig=n,this.persist("namesSpaces",t),this.persist("sessionConfig",n)}createClient(){return o(this,void 0,void 0,(function*(){}))}validateChain(e){const[t,n]=(null===e||void 0===e?void 0:e.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,n];if(t&&!Object.keys(this.namespaces||{}).map((e=>(0,u.parseNamespaceKey)(e))).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&n)return[t,n];const o=(0,u.parseNamespaceKey)(Object.keys(this.namespaces)[0]),i=this.rpcProviders[o].getDefaultChain();return[o,i]}requestAccounts(){return o(this,void 0,void 0,(function*(){const[e]=this.validateChain();return yield this.getProvider(e).requestAccounts()}))}onChainChanged(e,t=!1){if(!this.namespaces)return;const[n,o]=this.validateChain(e);o&&(t||this.getProvider(n).setDefaultChain(o),this.namespaces[n]?this.namespaces[n].defaultChain=o:this.namespaces[`${n}:${o}`]?this.namespaces[`${n}:${o}`].defaultChain=o:this.namespaces[`${n}:${o}`]={defaultChain:o},this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",o))}onConnect(){this.createProviders(),this.session&&this.persist("connectSession",this.session),this.events.emit("connect",{session:this.session})}cleanup(){return o(this,void 0,void 0,(function*(){this.session=void 0,this.namespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),this.persist("connectSession",void 0)}))}persist(e,t){return console.log("[evm u-provider] persisit data",e,t),this.client.engine.connectionManager.saveSessionContent(e,t)}getFromStore(e){return o(this,void 0,void 0,(function*(){return this.client.engine.connectionManager.getSessionContent(e)}))}}t.OKXUniversalProvider=h,t["default"]=h},2776:function(e,t,n){"use strict";n(4114);var o=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SignClient=void 0;const r=i(n(1571)),s=n(523),c=n(3669);class a extends s.ISignClient{constructor(e){super(e),this.events=new r.default,this.engine=new s.Engine(new s.ConnectionManager),this.connect=e=>o(this,void 0,void 0,(function*(){return new Promise(((t,n)=>{var o=[],i={name:"requestAccounts",requiredNamespaces:(0,c.nameSpaceToConnectWalletNameSpace)(e.namespaces),optionalNamespaces:(0,c.nameSpaceToConnectWalletNameSpace)(e.optionalNamespaces)};o.push(i);try{this.engine.conect(o,{dappInfo:this.metadata,openUniversalUrl:!0},(n=>{n&&(0,c.fillParamsToSession)(n,e.namespaces,e.optionalNamespaces,this.sessionConfig),t(n)}))}catch(r){n(r)}}))})),this.restoreconnect=e=>o(this,void 0,void 0,(function*(){return new Promise(((t,n)=>{this.engine.restoreconnect(e,(e=>{t(e)}))}))})),this.reject=e=>o(this,void 0,void 0,(function*(){})),this.request=e=>o(this,void 0,void 0,(function*(){return(0,s.logDebug)("clint request --params>>>> >",JSON.stringify(e)),new Promise(((t,n)=>o(this,void 0,void 0,(function*(){var o;try{(null===(o=this.sessionConfig)||void 0===o?void 0:o.openUniversalUrl)&&(0,s.isIos)()&&this.openOKXWallet(),yield this.engine.send(e,{resolve:e=>{(0,s.logDebug)("clint request --response >",JSON.stringify(e)),t(e)},onAck:()=>{var e;!(0,s.isIos)()&&(null===(e=this.sessionConfig)||void 0===e?void 0:e.openUniversalUrl)&&this.openOKXWallet()}})}catch(i){n(i)}}))))})),this.disconnect=()=>o(this,void 0,void 0,(function*(){try{return new Promise((e=>{this.engine.send({method:"disconnect"},{onAck:()=>{e()}})}))}catch(e){throw e}})),this.metadata=e}on(e,t){return this.events.on(e,t),this}openOKXWallet(){(0,s.openOKXDeeplinkWithFallback)(s.standardDeeplink)}}t.SignClient=a},3669:function(e,t,n){"use strict";n(4114),Object.defineProperty(t,"__esModule",{value:!0}),t.getAccountsChains=i,t.nameSpaceToConnectWalletNameSpace=r,t.fillParamsToSession=s,t.isCaipNamespace=c,t.parseNamespaceKey=a;const o=n(523);function i(e){const t=[];return e.forEach((e=>{const[n,o]=e.split(":");t.push(`${n}:${o}`)})),t}function r(e){var t=[];return e?(Object.keys(e).forEach((n=>{n!==o.NameSpaceKeyEip155&&n!==o.NameSpaceKeySOL||e[n].chains&&t.push({namespace:n,chains:e[n].chains})})),t):t}function s(e,t,n,o){const i=(e,t)=>{Object.assign(e,t)},r=(e,t)=>{for(const n in t)t.hasOwnProperty(n)&&t[n].rpcMap&&(t[n].rpcMap&&(e[n].rpcMap||(e[n].rpcMap={}),i(e[n].rpcMap,t[n].rpcMap)),t[n].defaultChain&&(e[n].defaultChain=t[n].defaultChain))};t&&r(e.namespaces,t),n&&r(e.namespaces,n),e.sessionConfig=o}function c(e){return e.includes(":")}function a(e){return c(e)?e.split(":")[0]:e}},3548:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PROVIDER_EVENTS=void 0,t.PROVIDER_EVENTS={DEFAULT_CHAIN_CHANGED:"default_chain_changed",UPDATE_NAMESPACES:"update_name_spaces"}},4417:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(9399),t),i(n(3548),t)},9399:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GENERIC_SUBPROVIDER_NAME=t.RPC_URL=t.STORAGE=t.CONTEXT=t.WC_VERSION=t.PROTOCOL=t.RELAY_URL=t.LOGGER=void 0,t.LOGGER="error",t.RELAY_URL="wss://relay.walletconnect.com",t.PROTOCOL="wc",t.WC_VERSION=2,t.CONTEXT="universal_provider",t.STORAGE=`${t.PROTOCOL}@${t.WC_VERSION}:${t.CONTEXT}:`,t.RPC_URL="https://rpc.walletconnect.com/v1/",t.GENERIC_SUBPROVIDER_NAME="generic"},8403:function(e,t,n){"use strict";n(4114),n(7642),n(8004),n(3853),n(5876),n(2475),n(5024),n(1698);var o=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(169),r=n(4417),s=n(523),c=n(9142),a=n(935);class l{constructor(e){this.name="eip155",this.namespace=e.namespace,this.events=(0,i.getGlobal)("events"),this.client=(0,i.getGlobal)("client"),this.chainId=parseInt(this.getDefaultChain()),this.httpProviders=this.createHttpProviders(),(0,s.logDebug)("eip155 constructor --opts.namespace--\x3e",e.namespace)}request(e){return o(this,void 0,void 0,(function*(){switch((0,s.logDebug)("eip155 request --args--\x3e",e),(0,s.logDebug)("eip155 request --args--string>",JSON.stringify(e)),e.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return yield this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_addEthereumChain":return this.addEthereumChain(e);default:break}return this.namespace.methods.includes(e.method)?yield this.client.request(e):((0,s.logDebug)("[RPC] request begin"),yield this.getHttpProvider().request(e))}))}addEthereumChain(e){return o(this,void 0,void 0,(function*(){let t=yield this.client.request(e);try{if("result"in t){let e=t.result;if(e){const t=e.split(":")[0],n=e.split(":")[1],o=t+":"+n;this.namespace;this.namespace.accounts.push(e),this.namespace.chains.push(o),this.events.emit(r.PROVIDER_EVENTS.UPDATE_NAMESPACES,{eip155:this.namespace})}}else new s.OkxConnectError(s.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`the method ${e.method} request error`)}catch(n){throw new s.OkxConnectError(s.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`the method ${e.method} request  error`)}return t}))}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){if(this.chainId=parseInt(e),!this.httpProviders[e]){const n=t||(0,i.getRpcUrl)(`${this.name}:${e}`,this.namespace);n||((0,s.logError)(`No RPC url provided for chainId: ${e}`),this.setHttpProvider(e,n))}this.events.emit(r.PROVIDER_EVENTS.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return(0,s.logDebug)("eip155 getAccounts ",e,this.chainId),e?[...new Set(e.filter((e=>e.split(":")[1]===this.chainId.toString())).map((e=>e.split(":")[2])))]:[]}handleSwitchChain(e){return o(this,void 0,void 0,(function*(){let t=e.params,n="0x0";t&&"chainId"in t&&(n=t.chainId),n=n.startsWith("0x")?n:`0x${n}`,console.log("handleSwitchChain --\x3eargs ",e),console.log("handleSwitchChain --\x3ehexChainId ",n);const o=parseInt(n,16);console.log("handleSwitchChain --\x3eparsedChainId ",o);const i=yield this.client.request({method:"wallet_switchEthereumChain",chainId:e.chainId,params:{chainId:n}});return console.log("handleSwitchChain --\x3ewallet_switchEthereumChain ",i),this.setDefaultChain(`${o}`),i}))}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}createHttpProvider(e,t){const n=t;if(n){const e=new c.JsonRpcProvider(new a.JsonRpcConnection(n,(0,i.getGlobal)("disableProviderPing")));return e}(0,s.logError)(`No RPC url provided for chainId: ${e}`)}createHttpProviders(){const e={};return this.namespace.chains.forEach((t=>{const n=(0,i.getChainId)(t),o=(0,i.getRpcUrl)(t,this.namespace);(0,s.logDebug)("get parsed chain and rpc:",n,o);let r=this.createHttpProvider(n,o);r&&(e[n]=r)})),(0,s.logDebug)("get http providermap:",e),e}setHttpProvider(e,t){const n=this.createHttpProvider(e,t);n&&(this.httpProviders[e]=n)}getHttpProvider(){const e=`${this.chainId}`,t=this.httpProviders[e];if((0,s.logDebug)("[RPC] get http provider:",e,t),"undefined"===typeof t)throw new Error(`JSON-RPC provider for ${e} not found`);return t}}t["default"]=l},935:function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.JsonRpcConnection=void 0;const r=n(1571),s=i(n(4830)),c=n(523),a=n(2541),l={Accept:"application/json","Content-Type":"application/json"},d="POST",u={headers:l,method:d};class h{constructor(e,t=!1){if(this.url=e,this.disableProviderPing=t,this.events=new r.EventEmitter,this.isAvailable=!1,this.registering=!1,!(0,a.isHttpUrl)(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e,this.disableProviderPing=t}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}open(){return o(this,arguments,void 0,(function*(e=this.url){yield this.register(e)}))}close(){return o(this,void 0,void 0,(function*(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}))}send(e){return o(this,void 0,void 0,(function*(){this.isAvailable||(yield this.register());try{const t=(0,c.safeJsonStringify)(e),n=yield(0,s.default)(this.url,Object.assign(Object.assign({},u),{body:t})),o=yield n.json();this.onPayload({data:o})}catch(t){this.onError(e.id,t)}}))}register(){return o(this,arguments,void 0,(function*(e=this.url){if(!(0,a.isHttpUrl)(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering)return new Promise(((e,t)=>{this.events.once("register_error",(e=>{t(e)})),this.events.once("open",(()=>{if("undefined"===typeof this.isAvailable)return t(new Error("HTTP connection is missing or invalid"));e()}))}));this.url=e,this.registering=!0;try{if(!this.disableProviderPing){const t=(0,c.safeJsonStringify)({id:1,jsonrpc:"2.0",method:"test",params:[]});yield(0,s.default)(e,Object.assign(Object.assign({},u),{body:t}))}this.onOpen()}catch(t){const e=this.parseError(t);throw this.events.emit("register_error",e),this.onClose(),e}}))}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if("undefined"===typeof e.data)return;const t="string"===typeof e.data?(0,c.safeJsonParse)(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const n=this.parseError(t),o=n.message||n.toString(),i=(0,a.formatJsonRpcError)(e,o);this.events.emit("payload",i)}parseError(e,t=this.url){return(0,a.parseConnectionError)(e,t,"HTTP")}}t.JsonRpcConnection=h},9142:function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(t){r(t)}}function c(e){try{a(o["throw"](e))}catch(t){r(t)}}function a(e){e.done?n(e.value):i(e.value).then(s,c)}a((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.JsonRpcProvider=void 0;const i=n(1571),r=n(3077),s=n(2541),c=n(523);class a extends r.IJSONRpcProvider{constructor(e){super(e),this.events=new i.EventEmitter,this.connected=!1,this.connecting=!1,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}connect(){return o(this,arguments,void 0,(function*(e=this.connection){yield this.open(e)}))}disconnect(){return o(this,void 0,void 0,(function*(){yield this.close()}))}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}request(e,t){return o(this,void 0,void 0,(function*(){return this.requestStrict((0,s.formatJsonRpcRequest)(e.method,e.params||[],e.id||(0,s.getBigIntRpcId)().toString()),t)}))}requestStrict(e,t){return o(this,void 0,void 0,(function*(){return new Promise(((n,i)=>o(this,void 0,void 0,(function*(){if(!this.connection.connected)try{yield this.open()}catch(o){i(o)}this.events.on(`${e.id}`,(e=>{(0,s.isJsonRpcError)(e)?i(e.error):n(e.result)}));try{(0,c.logDebug)("[RPC] >>> send request",e,t),yield this.connection.send(e,t)}catch(o){i(o)}}))))}))}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),(0,s.isJsonRpcResponse)(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&3e3===e.code&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}open(){return o(this,arguments,void 0,(function*(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),"string"===typeof e&&(yield this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),yield this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}))}close(){return o(this,void 0,void 0,(function*(){yield this.connection.close()}))}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",(e=>this.onPayload(e))),this.connection.on("close",(e=>this.onClose(e))),this.connection.on("error",(e=>this.events.emit("error",e))),this.connection.on("register_error",(e=>this.onClose())),this.hasRegisteredEventListeners=!0)}}t.JsonRpcProvider=a},3077:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(3919),t),i(n(6097),t)},6097:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},3919:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IJSONRpcProvider=t.IJSONRpcConnection=void 0;class n{}t.IJSONRpcConnection=n;class o{constructor(e){}}t.IJSONRpcProvider=o},7501:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setGlobal=t.getGlobal=void 0;const n={},o=e=>n[e];t.getGlobal=o;const i=(e,t)=>{n[e]=t};t.setGlobal=i},169:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(2173),t),i(n(7501),t)},2173:function(e,t,n){"use strict";n(4114),n(7642),n(8004),n(3853),n(5876),n(2475),n(5024),n(1698);var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getRpcUrl=c,t.getChainId=a,t.validateChainApproval=l,t.getChainsFromApprovedSession=d,t.getAccountsFromSession=u,t.mergeRequiredOptionalNamespaces=h,t.normalizeNamespaces=g,t.parseCaip10Account=f,t.convertChainIdToNumber=p,t.parseChainId=_,t.mergeArrays=O;const i=n(523),r=n(3669),s=o(n(8626));function c(e,t,n){var o;const i=_(e);return(null===(o=t.rpcMap)||void 0===o?void 0:o[i.reference])||""}function a(e){return e.includes(":")?e.split(":")[1]:e}function l(e,t){if(!t.includes(e))throw new Error(`Chain '${e}' not approved. Please use one of the following: ${t.toString()}`)}function d(e){return e.map((e=>`${e.split(":")[0]}:${e.split(":")[1]}`))}function u(e,t){const n=Object.keys(t.namespaces).filter((t=>t.includes(e)));if(!n.length)return[];const o=[];return n.forEach((e=>{const n=t.namespaces[e].accounts;o.push(...n)})),o}function h(e={},t={}){const n=g(e),o=g(t);return s.default.merge(n,o)}function g(e){var t,n;const o={};if(!(0,i.isValidObject)(e))return o;for(const[i,s]of Object.entries(e)){const e=(0,r.isCaipNamespace)(i)?[i]:s.chains,c=s.rpcMap||{},a=(0,r.parseNamespaceKey)(i);o[a]=Object.assign(Object.assign(Object.assign({},o[a]),s),{chains:O(e,null===(t=o[a])||void 0===t?void 0:t.chains),rpcMap:Object.assign(Object.assign({},c),null===(n=o[a])||void 0===n?void 0:n.rpcMap)})}return o}function f(e){return e.includes(":")?e.split(":")[2]:e}function p(e){return"number"===typeof e?e:e.includes("0x")?parseInt(e,16):(e=e.includes(":")?e.split(":")[1]:e,isNaN(Number(e))?e:Number(e))}const v=":";function _(e){const[t,n]=e.split(v);return{namespace:t,reference:n}}function O(e=[],t=[]){return[...new Set([...e,...t])]}},504:function(e,t,n){"use strict";var o=n(5130),i=n(6517),r=(n(4188),n(6768)),s=n(4232);const c={id:"app"};function a(e,t,n,i,a,l){const d=(0,r.g2)("el-header"),u=(0,r.g2)("el-col"),h=(0,r.g2)("el-row"),g=(0,r.g2)("el-card"),f=(0,r.g2)("el-input"),p=(0,r.g2)("el-checkbox"),v=(0,r.g2)("el-button"),_=(0,r.g2)("qrcode-vue"),O=(0,r.g2)("el-main"),E=(0,r.g2)("el-container");return(0,r.uX)(),(0,r.CE)("div",c,[(0,r.bF)(E,null,{default:(0,r.k6)((()=>[(0,r.bF)(d,null,{default:(0,r.k6)((()=>t[16]||(t[16]=[(0,r.eW)("OKX Connect")]))),_:1}),(0,r.bF)(O,null,{default:(0,r.k6)((()=>[(0,r.bF)(g,{class:"wallet-info"},{header:(0,r.k6)((()=>t[17]||(t[17]=[(0,r.Lk)("div",null,"钱包信息",-1)]))),default:(0,r.k6)((()=>[(0,r.bF)(h,{class:"info-row"},{default:(0,r.k6)((()=>[(0,r.bF)(u,{span:24},{default:(0,r.k6)((()=>[t[18]||(t[18]=(0,r.Lk)("strong",null,"Wallet Address:",-1)),(0,r.eW)(" "+(0,s.v_)(l.getWalletAddress),1)])),_:1})])),_:1}),(0,r.bF)(h,{class:"info-row"},{default:(0,r.k6)((()=>[(0,r.bF)(u,{span:24},{default:(0,r.k6)((()=>[t[19]||(t[19]=(0,r.Lk)("strong",null,"当前状态 :",-1)),(0,r.eW)(" "+(0,s.v_)(e.currentStatus),1)])),_:1})])),_:1})])),_:1}),(0,r.bF)(g,{class:"wallet-actions"},{header:(0,r.k6)((()=>t[20]||(t[20]=[(0,r.Lk)("div",null,"钱包操作",-1)]))),default:(0,r.k6)((()=>[(0,r.bF)(h,{gutter:12},{default:(0,r.k6)((()=>[(0,r.bF)(u,{span:24},{default:(0,r.k6)((()=>[(0,r.bF)(f,{modelValue:e.testProofPayload,"onUpdate:modelValue":t[0]||(t[0]=t=>e.testProofPayload=t),placeholder:"proofPayload"},null,8,["modelValue"])])),_:1})])),_:1}),(0,r.bF)(h,{class:"info-row"},{default:(0,r.k6)((()=>[(0,r.bF)(u,{span:24},{default:(0,r.k6)((()=>[(0,r.bF)(p,{modelValue:e.isChecked,"onUpdate:modelValue":t[1]||(t[1]=t=>e.isChecked=t),onChange:e.handleChange},{default:(0,r.k6)((()=>t[21]||(t[21]=[(0,r.eW)(" 自动重连")]))),_:1},8,["modelValue","onChange"])])),_:1})])),_:1}),e.showVerifyRow?((0,r.uX)(),(0,r.Wv)(h,{key:0,class:"info-row"},{default:(0,r.k6)((()=>[(0,r.bF)(u,{span:24},{default:(0,r.k6)((()=>[t[22]||(t[22]=(0,r.Lk)("strong",null,"签名验证:",-1)),(0,r.eW)(" "+(0,s.v_)(e.ProofPayloadVerify),1)])),_:1})])),_:1})):(0,r.Q3)("",!0),(0,r.bF)(h,{gutter:12,class:"button-row"},{default:(0,r.k6)((()=>[(0,r.bF)(u,{span:24},{default:(0,r.k6)((()=>[(0,r.bF)(v,{type:"primary",onClick:l.connectBtnClicked,icon:"el-icon-connection"},{default:(0,r.k6)((()=>[(0,r.eW)((0,s.v_)(e.connectStatusStr),1)])),_:1},8,["onClick"])])),_:1})])),_:1}),((0,r.uX)(),(0,r.Wv)(r.Im,{to:"body"},[e.showModal?((0,r.uX)(),(0,r.CE)("div",{key:0,class:"modal-overlay",onClick:t[4]||(t[4]=(...e)=>l.closeModal&&l.closeModal(...e))},[(0,r.Lk)("div",{class:"modal-content",onClick:t[3]||(t[3]=(0,o.D$)((()=>{}),["stop"]))},[(0,r.Lk)("button",{class:"close-button",onClick:t[2]||(t[2]=(...e)=>l.closeModal&&l.closeModal(...e))},"×"),t[23]||(t[23]=(0,r.Lk)("h2",null,"扫描二维码",-1)),(0,r.bF)(_,{value:e.qrValue,size:200,level:"H"},null,8,["value"])])])):(0,r.Q3)("",!0)])),(0,r.bF)(h,{gutter:12,class:"button-row"},{default:(0,r.k6)((()=>[(0,r.bF)(u,{span:24},{default:(0,r.k6)((()=>[(0,r.bF)(v,{type:"warning",onClick:l.resotreConnectAction,icon:"el-icon-refresh-right"},{default:(0,r.k6)((()=>t[24]||(t[24]=[(0,r.eW)("尝试重连")]))),_:1},8,["onClick"])])),_:1})])),_:1}),(0,r.bF)(h,{gutter:12,class:"button-row"},{default:(0,r.k6)((()=>[(0,r.bF)(u,{span:24},{default:(0,r.k6)((()=>[(0,r.bF)(v,{type:"danger",onClick:l.disconnectAction,icon:"el-icon-switch-button",disabled:0==e.walletAddress.length},{default:(0,r.k6)((()=>[(0,r.eW)((0,s.v_)(e.disconnectStatusStr),1)])),_:1},8,["onClick","disabled"])])),_:1})])),_:1})])),_:1}),(0,r.bF)(g,{class:"wallet-actions"},{header:(0,r.k6)((()=>t[25]||(t[25]=[(0,r.Lk)("div",null,"EVM 交易",-1)]))),default:(0,r.k6)((()=>[(0,r.bF)(h,{gutter:12,class:"button-row"},{default:(0,r.k6)((()=>[(0,r.bF)(u,{span:24},{default:(0,r.k6)((()=>[(0,r.bF)(v,{type:"warning",onClick:l.mockeRequestAccounts},{default:(0,r.k6)((()=>t[26]||(t[26]=[(0,r.eW)("eth_requestAccounts")]))),_:1},8,["onClick"])])),_:1})])),_:1}),(0,r.bF)(h,{gutter:12,class:"button-row"},{default:(0,r.k6)((()=>[(0,r.bF)(u,{span:24},{default:(0,r.k6)((()=>[(0,r.bF)(v,{type:"primary",onClick:t[5]||(t[5]=e=>l.eth_chainId())},{default:(0,r.k6)((()=>t[27]||(t[27]=[(0,r.eW)("eth_chainId")]))),_:1})])),_:1})])),_:1}),(0,r.bF)(h,{gutter:12,class:"button-row"},{default:(0,r.k6)((()=>[(0,r.bF)(u,{span:24},{default:(0,r.k6)((()=>[(0,r.bF)(v,{type:"primary",onClick:t[6]||(t[6]=e=>l.wallet_switchEthereumChain())},{default:(0,r.k6)((()=>t[28]||(t[28]=[(0,r.eW)("wallet_switchEthereumChain")]))),_:1})])),_:1})])),_:1}),(0,r.bF)(h,{gutter:12,class:"button-row"},{default:(0,r.k6)((()=>[(0,r.bF)(u,{span:24},{default:(0,r.k6)((()=>[(0,r.bF)(v,{type:"primary",onClick:t[7]||(t[7]=e=>l.wallet_addEthereumChain())},{default:(0,r.k6)((()=>t[29]||(t[29]=[(0,r.eW)("wallet_addEthereumChain")]))),_:1})])),_:1})])),_:1}),(0,r.bF)(h,{gutter:12,class:"button-row"},{default:(0,r.k6)((()=>[(0,r.bF)(u,{span:24},{default:(0,r.k6)((()=>[(0,r.bF)(v,{type:"primary",onClick:t[8]||(t[8]=e=>l.personal_sign())},{default:(0,r.k6)((()=>t[30]||(t[30]=[(0,r.eW)("personal_sign")]))),_:1})])),_:1})])),_:1}),(0,r.bF)(h,{gutter:12,class:"button-row"},{default:(0,r.k6)((()=>[(0,r.bF)(u,{span:24},{default:(0,r.k6)((()=>[(0,r.bF)(v,{type:"primary",onClick:t[9]||(t[9]=e=>l.eth_signTypedData_v4())},{default:(0,r.k6)((()=>t[31]||(t[31]=[(0,r.eW)("eth_signTypedData_v4")]))),_:1})])),_:1})])),_:1}),(0,r.bF)(h,{gutter:12,class:"button-row"},{default:(0,r.k6)((()=>[(0,r.bF)(u,{span:24},{default:(0,r.k6)((()=>[(0,r.bF)(v,{type:"primary",onClick:t[10]||(t[10]=e=>l.eth_sendTransaction())},{default:(0,r.k6)((()=>t[32]||(t[32]=[(0,r.eW)("eth_sendTransaction")]))),_:1})])),_:1})])),_:1}),(0,r.bF)(h,{gutter:12,class:"button-row"},{default:(0,r.k6)((()=>[(0,r.bF)(u,{span:24},{default:(0,r.k6)((()=>[(0,r.bF)(v,{type:"primary",onClick:t[11]||(t[11]=e=>l.wallet_watchAsset())},{default:(0,r.k6)((()=>t[33]||(t[33]=[(0,r.eW)("wallet_watchAsset")]))),_:1})])),_:1})])),_:1}),(0,r.bF)(h,{gutter:12,class:"button-row"},{default:(0,r.k6)((()=>[(0,r.bF)(u,{span:24},{default:(0,r.k6)((()=>[(0,r.bF)(v,{type:"primary",onClick:t[12]||(t[12]=e=>l.wallet_testRpc())},{default:(0,r.k6)((()=>t[34]||(t[34]=[(0,r.eW)("wallet_testRpc(check balance on eth)")]))),_:1})])),_:1})])),_:1}),(0,r.bF)(u,{xs:24,sm:12},{default:(0,r.k6)((()=>[t[35]||(t[35]=(0,r.Lk)("div",{class:"input-label"},"交易数据:",-1)),(0,r.bF)(f,{modelValue:e.testTransaction,"onUpdate:modelValue":t[13]||(t[13]=t=>e.testTransaction=t),placeholder:"sendTransactions"},null,8,["modelValue"])])),_:1}),(0,r.bF)(u,{xs:24,sm:12},{default:(0,r.k6)((()=>[t[36]||(t[36]=(0,r.Lk)("div",{class:"input-label"},"签名结果 :",-1)),(0,r.bF)(f,{modelValue:e.testboc,"onUpdate:modelValue":t[14]||(t[14]=t=>e.testboc=t),placeholder:"boc"},null,8,["modelValue"])])),_:1}),(0,r.bF)(h,{gutter:12,class:"button-row"},{default:(0,r.k6)((()=>[(0,r.bF)(u,{span:24},{default:(0,r.k6)((()=>[(0,r.bF)(v,{type:"primary",onClick:t[15]||(t[15]=e=>l.sendTransaction())},{default:(0,r.k6)((()=>[(0,r.eW)((0,s.v_)(e.testTransactionStr),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])}var l=n(9507),d=n(523),u=n(3325),h=n.n(u),g=n(9877),f=new l._y({metaData:{name:"OKX Connect Demo",icon:window.location.href+"favicon.ico"}});window.ton=f;var p={name:"App",components:{QrcodeVue:g.A},data:()=>({testTopic:"",testPublicKey:"",testProofPayload:"",pendingDeepLink:"-",logList:[],connectReady:!1,connectStatusStr:"连接钱包",disconnectStatusStr:"断开钱包",localPubKey:"",localSecKey:"",testTransaction:"",testTransactionStr:"发送交易",walletAddress:"",testboc:"",ProofPayloadVerify:"",showModal:!1,showVerifyRow:!1,qrValue:"https://www.okx.com/download",currentStatus:"",isChecked:"true"==localStorage.getItem("autoRefresh"),handleChange:e=>{localStorage.setItem("autoRefresh",`${e}`)}}),computed:{getWalletAddress:function(){return this.walletAddress}},methods:{async connectBtnClicked(){console.log(`encryptStoreMsg   connectBtnClicked  ${Date.now()}`),window.provider?this.testTonSdk():console.log("connectBtnClicked provider not finish init")},async disconnectAction(){try{console.log("get disconnect wallet btn clicked");var e=window.provider;await e.disconnect(),this.walletAddress="disconnected"}catch(t){console.log("Disconnect  error ==>> ",t.message),this.currentStatus=t.message}},async resotreConnectAction(){console.log("get restore wallet btn clicked"),f.restoreConnection()},async mockeRequestAccounts(){var e={method:"eth_requestAccounts"};this.testTransaction=JSON.stringify(e)},async eth_chainId(){var e={method:"eth_chainId"};this.testTransaction=JSON.stringify(e)},async wallet_switchEthereumChain(){var e={method:"wallet_switchEthereumChain",params:{chainId:"0x1"}};this.testTransaction=JSON.stringify(e)},async wallet_addEthereumChain(){var e={method:"wallet_addEthereumChain",params:{blockExplorerUrls:["https://explorer.fuse.io"],chainId:"0x7a",chainName:"Fuse",nativeCurrency:{name:"Fuse",symbol:"FUSE",decimals:18},rpcUrls:["https://rpc.fuse.io"]}};this.testTransaction=JSON.stringify(e)},async personal_sign(){var e={method:"personal_sign",params:{chainId:"eip:1",message:"0x48656c6c6f204170704b697421"}};this.testTransaction=JSON.stringify(e)},async eth_signTypedData_v4(){var e={method:"eth_signTypedData_v4",params:{chainId:"eip:1",typedDataJson:'{"domain":{"name":"Ether Mail","version":"1","chainId":1,"verifyingContract":"0xcccccccccccccccccccccccccccccccccccccccc"},"message":{"from":{"name":"Cow","wallet":"0xCD2a3d9F938E13CD947Ec05AbC7FE734Df8DD826"},"to":{"name":"Bob","wallet":"0xbBbBBBBbbBBBbbbBbbBbbbbBBbBbbbbBbBbbBBbB"},"contents":"Hello, Bob!"},"primaryType":"Mail","types":{"EIP712Domain":[{"name":"name","type":"string"},{"name":"version","type":"string"},{"name":"chainId","type":"uint256"},{"name":"verifyingContract","type":"address"}],"Person":[{"name":"name","type":"string"},{"name":"wallet","type":"address"}],"Mail":[{"name":"from","type":"Person"},{"name":"to","type":"Person"},{"name":"contents","type":"string"}]}}'}};this.testTransaction=JSON.stringify(e)},async eth_sendTransaction(){var e={method:"eth_sendTransaction",params:{chainId:"eip:1",gasPrice:"0x17003f6530",nonce:"0x0d30",data:"0x",value:"0x00",to:"0xf2f3e73be57031114dd1f4e75c1dd87658be7f0e",gasLimit:"0x5208",from:"0xf2f3e73be57031114dd1f4e75c1dd87658be7f0e"}};this.testTransaction=JSON.stringify(e)},async wallet_testRpc(){let e=window.provider;e.setDefaultChain("eip155:56","https://eth-mainnet.g.alchemy.com/v2/NxUfYJUr-TQtEpLmSXhhD5pXn70GwsyV");var t={method:"eth_getBalance",params:["0x8D97689C9818892B700e27F316cc3E41e17fBeb9","latest"]};this.testTransaction=JSON.stringify(t)},async wallet_watchAsset(){var e={method:"wallet_watchAsset",params:{type:"ERC20",options:{address:"0xCEe4E6F4d8e634e329c457a4F98c090aFAfB1C4b",symbol:"2024",image:"https://assets.coingecko.com/coins/images/33052/thumb/200x200_2024_logo.png?1700474858",decimals:18}},chainId:"eip155:1"};this.testTransaction=JSON.stringify(e)},async sendTransaction(){if(console.log("sendTransaction",window.provider),console.log("sendTransaction内容------",this.testTransaction),this.testTransaction&&window.provider){const n=JSON.parse(this.testTransaction);try{var e=await window.provider.request(n);console.log("sendTransaction callBack------",e),"string"==typeof e&&(this.testboc=e)}catch(t){t.code===d.OKX_CONNECT_ERROR_CODES.USER_REJECTS_ERROR?this.testboc="用户拒绝交易":this.testboc="签名错误！"}}else alert("交易数据为空，请选则或输入交易数据。")},async testTonSdk(){var e=window.provider;await e.connect({namespaces:{eip155:{methods:["eth_sendTransaction","eth_signTransaction","eth_sign","personal_sign","eth_signTypedData"],chains:["eip155:1","eip155:66"],events:["chainChanged","accountsChanged"],rpcMap:{1:"https://rpc.walletconnect.com?chainId=eip155:80001",66:""},defaultChain:"66"},pairingTopic:"<123...topic>",skipPairing:!1},optionalNamespaces:{eip155:{chains:["eip155:137"],rpcMap:{137:"https://rpc.walletconnect.com?chainId=eip155:80001&projectId"}},pairingTopic:"<123...topic>",skipPairing:!1},sessionConfig:{dappInfo:{name:"React App",url:"https://walletconnect.com/",icon:"https://avatars.githubusercontent.com/u/37784886"},openUniversalUrl:!0}}).then((()=>{this.walletAddress="connected"}))},closeModal(){this.showModal=!1},isPC(){const e=navigator.userAgent;console.log("current device ua is ===>",e);const t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"];let n=!0;for(let o=0;o<t.length;o++)if(e.indexOf(t[o])>0){n=!1;break}return n},isSafariOrChrome(){const e=navigator.userAgent,t=["Safari","Chrome"];let n=!1;for(let o=0;o<t.length;o++)if(e.indexOf(t[o])>0){n=!0;break}return n}},created(){for(const e of Object.values(l.EG))console.log(e),window.addEventListener(e,(t=>{console.log(e,t.detail),this.currentStatus=e}))},mounted(){this.connectReady=!0,h().init({projectId:"YOUR_PROJECT_ID",metadata:{name:"React App",description:"React App for WalletConnect",url:"https://walletconnect.com/",icon:"https://avatars.githubusercontent.com/u/37784886"},client:void 0}).then((e=>{window.provider=e,console.log(`init finished: ${e}`),e.on("connect",(e=>{console.log("get connect session",e),this.walletAddress="connected"})),e.on("reconnect",(e=>{console.log("get reconnect session",e),this.walletAddress="connected"})),e.on("disconnect",(()=>{console.log("get disconnect"),this.walletAddress="disconnected"}))})),f.onStatusChange((e=>{if(console.log("APP ---TON.onStatusChange>>----",e),e){if(this.walletAddress=e.account.address,this.testProofPayload){var t={address:this.walletAddress,network:e.account.chain,public_key:e.account.publicKey,proof:{...e.connectItems.tonProof.proof,state_init:e.account.walletStateInit}};console.log(`checkProof => ${JSON.stringify(t)}`)}else this.ProofPayloadVerify=": no proof";this.showModal=!1}else this.walletAddress="disconnected"}),(e=>{this.showModal=!1,e.code===d.OKX_CONNECT_ERROR_CODES.USER_REJECTS_ERROR?this.walletAddress=`用户拒绝链接: code(${e.code}) `:this.walletAddress=`链接报错: code(${e.code})  ${e.message}`})),this.isChecked&&f.restoreConnection()}},v=n(1241);const _=(0,v.A)(p,[["render",a],["__scopeId","data-v-4337654d"]]);var O=_;const E=(0,o.Ef)(O);E.use(i.A),E.mount("#app")},8730:function(){},8103:function(){},515:function(){}},t={};function n(o){var i=t[o];if(void 0!==i)return i.exports;var r=t[o]={id:o,loaded:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.loaded=!0,r.exports}n.m=e,function(){var e=[];n.O=function(t,o,i,r){if(!o){var s=1/0;for(d=0;d<e.length;d++){o=e[d][0],i=e[d][1],r=e[d][2];for(var c=!0,a=0;a<o.length;a++)(!1&r||s>=r)&&Object.keys(n.O).every((function(e){return n.O[e](o[a])}))?o.splice(a--,1):(c=!1,r<s&&(s=r));if(c){e.splice(d--,1);var l=i();void 0!==l&&(t=l)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[o,i,r]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){n.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){var e={524:0};n.O.j=function(t){return 0===e[t]};var t=function(t,o){var i,r,s=o[0],c=o[1],a=o[2],l=0;if(s.some((function(t){return 0!==e[t]}))){for(i in c)n.o(c,i)&&(n.m[i]=c[i]);if(a)var d=a(n)}for(t&&t(o);l<s.length;l++)r=s[l],n.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return n.O(d)},o=self["webpackChunkokxconnectdemo"]=self["webpackChunkokxconnectdemo"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=n.O(void 0,[504],(function(){return n(504)}));o=n.O(o)})();
//# sourceMappingURL=app.a4e505d8.js.map