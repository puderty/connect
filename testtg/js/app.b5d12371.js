(function(){var e={897:function(e,t,n){"use strict";n.r(t),n.d(t,{CONNECT_ITEM_ERROR_CODES:function(){return Wt},ConnectionManager:function(){return Ge},Engine:function(){return Lt},IEngine:function(){return xt},IEngineEvents:function(){return It},ISignClient:function(){return Ft},ISignClientEvents:function(){return At},NameSpaceKeyEip155:function(){return ht},NameSpaceKeySOL:function(){return ut},NameSpaceKeyTON:function(){return ft},OKXConnectError:function(){return et},OKXWalletConnector:function(){return ce},OKX_CONNECT_ERROR_CODES:function(){return Ze},Storage:function(){return Se},TONCHAIN:function(){return $t},WalletConnectionManager:function(){return Qe},base64decode:function(){return U},base64encode:function(){return W},callForSuccess:function(){return c},concatUint8Arrays:function(){return A},formatJsonRpcError:function(){return Et},formatJsonRpcRequest:function(){return Ot},getBigIntRpcId:function(){return wt},getUniversalLink:function(){return _},hexToByteArray:function(){return D},isBrowser:function(){return se},isHttpUrl:function(){return Kt},isIos:function(){return G},isJsonRpcError:function(){return vt},isJsonRpcResponse:function(){return gt},isMobileUserAgent:function(){return te},isOS:function(){return ie},isValidObject:function(){return V},logDebug:function(){return h},logError:function(){return u},logWarning:function(){return f},openDeeplinkWithFallback:function(){return ee},openLink:function(){return Q},openLinkBlank:function(){return Z},openOKXDeeplinkWithFallback:function(){return w},parseConnectionError:function(){return Dt},safeJsonParse:function(){return m},safeJsonStringify:function(){return v},splitToUint8Arrays:function(){return F},standardDeeplink:function(){return b},standardUniversalLink:function(){return y},toHexString:function(){return I},tonConnectSdkVersion:function(){return C}});n(4603),n(7566),n(8721);const i="wss://wsdex.okx.com/ws/v1/wallet-connect-relay",s=3e5,o="2.0",r={InitState:0,Connecting:1,Connected:2,Disconnected:3,OnError:4};var a=function(e,t,n,i){function s(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function r(e){try{c(i.next(e))}catch(t){o(t)}}function a(e){try{c(i["throw"](e))}catch(t){o(t)}}function c(e){e.done?n(e.value):s(e.value).then(r,a)}c((i=i.apply(e,t||[])).next())}))};function c(e,t){return a(this,void 0,void 0,(function*(){var n,i;const s=null!==(n=null===t||void 0===t?void 0:t.attempts)&&void 0!==n?n:3,o=null!==(i=null===t||void 0===t?void 0:t.delayMs)&&void 0!==i?i:800;if("function"!==typeof e)throw new Error("Expected a function, got "+typeof e);let r,a=0;while(a<s)try{return yield e()}catch(c){r=c,a++,a<s&&(yield d(o))}throw r}))}function d(e,t){return a(this,void 0,void 0,(function*(){return new Promise(((n,i)=>{var s,o;if(null===(s=null===t||void 0===t?void 0:t.signal)||void 0===s?void 0:s.aborted)return void i(new Error("Delay aborted"));const r=setTimeout((()=>n()),e);null===(o=null===t||void 0===t?void 0:t.signal)||void 0===o||o.addEventListener("abort",(()=>{clearTimeout(r),i(new Error("Delay aborted"))}))}))}))}const l=!0;function h(...e){if("undefined"!=typeof console)try{(l||(null===window||void 0===window?void 0:window.okxLogDebug))&&console.debug("[OKX_CONNECT_SDK]",...e)}catch(t){}}function u(...e){if("undefined"!=typeof console)try{(l||(null===window||void 0===window?void 0:window.okxLogDebug))&&console.error("[OKX_CONNECT_SDK]",...e)}catch(t){}}function f(...e){if("undefined"!=typeof console)try{(l||(null===window||void 0===window?void 0:window.okxLogDebug))&&console.warn("[OKX_CONNECT_SDK]",...e)}catch(t){}}const p=e=>JSON.stringify(e,((e,t)=>"bigint"===typeof t?t.toString()+"n":t)),g=e=>{const t=/:(\b\d{17,}|\b(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))(?=[,\}\]]|$)/g,n=e.replace(t,(e=>`"${e}n"`));return JSON.parse(n,((e,t)=>{const n="string"===typeof t&&t.match(/^\d+n$/);return n?BigInt(t.substring(0,t.length-1)):t}))};function m(e){if("string"!==typeof e)throw h(e),new Error("Cannot safe json parse value of type "+typeof e);try{return g(e)}catch(t){return console.error("safeJsonParse error:",t),e}}function v(e){return"string"===typeof e?e:p(e)||""}n(4979);const y="http://localhost:5173",b="http://localhost:5173",C="1";function _(e){const t=encodeURIComponent(e);return`${y}?deeplink=${t}`}function w(e,t=""){var n,i,s,o,r,a,c;const d=_(e),l=!!(null===(n=O())||void 0===n?void 0:n.TelegramWebviewProxy),h=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;console.log("openOKXDeeplinkWithFallback fullUrl:",d);let u=!1;const f=1500,p=(Date.now(),y);if(h)if(l){let e={okxconnect:t,extraparams:""},n=JSON.stringify(e);const i=(new TextEncoder).encode(n),s=btoa(String.fromCharCode(...i));let o=`https://t.me/Tttrettttbot/testwallet?startapp=${s}`;const d=o;null===(c=null===(a=null===(r=O())||void 0===r?void 0:r.Telegram)||void 0===a?void 0:a.WebApp)||void 0===c||c.openTelegramLink(d)}else window.open(`http://localhost:5173/?param=${t}`,"_blank");else{let e=null;var g=()=>{u||e||window.open(p,"_blank")};if(l){let e={okxconnect:t,extraparams:""},n=JSON.stringify(e);const r=(new TextEncoder).encode(n),a=btoa(String.fromCharCode(...r));let c=`https://t.me/Tttrettttbot/testwallet?startapp=${a}`;const d=c;null===(o=null===(s=null===(i=O())||void 0===i?void 0:i.Telegram)||void 0===s?void 0:s.WebApp)||void 0===o||o.openTelegramLink(d)}else window.open(`http://localhost:5173/?param=${t}`,"_blank");setTimeout(g,f),window.addEventListener("blur",(()=>{u=!0}),{once:!0}),document.addEventListener("visibilitychange",(()=>{"hidden"===document.visibilityState&&(u=!0)}))}}function O(){if("undefined"!==typeof window)return window}n(6573),n(8100),n(7936),n(7467),n(4732),n(9577);var E=n(998),k=n.n(E),R=n(7294),N=n.n(R),S=n(4972),T=n(9867),P=n(3351);const K="base16";function D(e){if(e.length%2!==0)throw new Error(`Cannot convert ${e} to bytesArray`);const t=new Uint8Array(e.length/2);for(let n=0;n<e.length;n+=2)t[n/2]=parseInt(e.slice(n,n+2),16);return t}function I(e){let t="";return e.forEach((e=>{t+=("0"+(255&e).toString(16)).slice(-2)})),t}function A(e,t){const n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}function F(e,t){if(t>=e.length)throw new Error("Index is out of buffer");const n=e.slice(0,t),i=e.slice(t);return[n,i]}function x(e,t){const n=N().encodeBase64(e);return t?encodeURIComponent(n):n}function $(e,t){return t&&(e=decodeURIComponent(e)),N().decodeBase64(e)}function W(e,t){let n;return e instanceof Uint8Array?n=e:("string"!==typeof e&&(e=v(e)),n=N().decodeUTF8(e)),x(n,t)}function U(e,t){const n=$(e,t);return{toString(){return N().encodeUTF8(n)},toObject(){try{return m(N().encodeUTF8(n))}catch(e){return null}},toUint8Array(){return n}}}function j(e){const t=e.match(new RegExp(/^\w+:/,"gi"));if(!t||!t.length)return!1;let n=t[0];return void 0!==n&&new RegExp("^wss?:").test(n)}const M=()=>"undefined"!==typeof WebSocket?WebSocket:"undefined"!==typeof n.g&&"undefined"!==typeof n.g.WebSocket?n.g.WebSocket:"undefined"!==typeof window&&"undefined"!==typeof window.WebSocket?window.WebSocket:"undefined"!==typeof self&&"undefined"!==typeof self.WebSocket?self.WebSocket:WebSocket,L=()=>"undefined"!==typeof WebSocket||"undefined"!==typeof n.g&&"undefined"!==typeof n.g.WebSocket||"undefined"!==typeof window&&"undefined"!==typeof window.WebSocket||"undefined"!==typeof self&&"undefined"!==typeof self.WebSocket,q=()=>"undefined"!==typeof n.g&&"undefined"!==typeof n.g.localStorage?n.g.localStorage:"undefined"!==typeof window&&"undefined"!==typeof window.localStorage?window.localStorage:localStorage,X=32;function J(e,t=K){h(`hash key called ${e}`);const n=(0,P.tW)((0,S.s)(e,t));return(0,T.d)(n,t)}function B(){return k().randomBytes(X)}function H(){let e=B();return h(`generate topic called ${e}`),J((0,T.d)(e,K))}const V=e=>Object.getPrototypeOf(e)===Object.prototype&&Object.keys(e).length;function G(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream}var z=n(6759),Y=n.n(z);function Q(e,t="_self"){h("openLink",e,t),window.open(e,t,"noopener noreferrer")}function Z(e){Q(e,"_blank")}function ee(e,t){const n=()=>{se("safari")||ie("android")&&se("firefox")||t()},i=setTimeout((()=>n()),500);window.addEventListener("blur",(()=>clearTimeout(i)),{once:!0}),Q(e,"_self")}function te(){let e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.slice(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e}function ne(){var e,t,n;const i=(new(Y())).getResult(),s=null===(e=i.os.name)||void 0===e?void 0:e.toLowerCase(),o=null===(t=i.device.model)||void 0===t?void 0:t.toLowerCase();let r;switch(!0){case"ipad"===o:r="ipad";break;case"ios"===s:r="ios";break;case"android"===s:r="android";break;case"mac os"===s:r="macos";break;case"linux"===s:r="linux";break;case null===s||void 0===s?void 0:s.includes("windows"):r="windows";break}const a=null===(n=i.browser.name)||void 0===n?void 0:n.toLowerCase();let c;switch(!0){case"chrome"===a:c="chrome";break;case"firefox"===a:c="firefox";break;case null===a||void 0===a?void 0:a.includes("safari"):c="safari";break;case null===a||void 0===a?void 0:a.includes("opera"):c="opera";break}return{os:r,browser:c}}function ie(...e){return e.includes(ne().os)}function se(...e){return e.includes(ne().browser)}var oe=n(321),re=function(e,t,n,i){function s(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function r(e){try{c(i.next(e))}catch(t){o(t)}}function a(e){try{c(i["throw"](e))}catch(t){o(t)}}function c(e){e.done?n(e.value):s(e.value).then(r,a)}c((i=i.apply(e,t||[])).next())}))};const ae=M();class ce{constructor(e){if(this.events=new oe.b,this.state=r.InitState,!j(e))throw new Error(`CONNECTOR: invalid url ${e}`);this.url=e,this.heartbeatTimer=null}get connecting(){return this.state==r.Connecting}onPayload(e){if("undefined"!==typeof e.data){if(h("get received data"),h(e),"string"===typeof e.data){let t=e.data;if("pong"===t)return void h(`CONNECT: receive pong ${Date.now().toString()}`)}this.events.emit("payload",e.data)}}onClose(e){this.socket=void 0,this.events.emit("close",e)}onError(e,t){const n={id:e,msg:t.toString()};this.events.emit("payload",n)}onopen(e){e.onmessage=e=>this.onPayload(e),e.onclose=e=>this.onClose(e),this.socket=e,this.state=r.Connected,this.events.emit("open")}emitError(e){this.events.emit("fail",e)}heartbeat(){return re(this,void 0,void 0,(function*(){if(this.heartbeatTimer&&clearTimeout(this.heartbeatTimer),this.state==r.Connected||this.state==r.OnError){if(this.socket){if(this.socket.readyState===WebSocket.OPEN)h(`send ping heart beat: ${Date.now().toString()}, ${this.socket}`),this.socket.send("ping"),this.heartbeatTimer=setTimeout(this.heartbeat.bind(this),5e3);else if(h("socket not ready"),this.state==r.Connected||this.state==r.OnError){h("socket reconnect by heartbeat");try{yield this.registOpen()}catch(e){u("regist open failed"),this.heartbeatTimer=setTimeout(this.heartbeat.bind(this),5e3)}}}else if(h("socket not exist"),this.state==r.Connected||this.state==r.OnError){h("socket reconnect by heartbeat");try{yield this.registOpen()}catch(e){u("regist open failed"),this.heartbeatTimer=setTimeout(this.heartbeat.bind(this),5e3)}}}else h("heart beat close")}))}registOpen(e=this.url){if(!j(e))throw new Error(`CONNECTOR: invalid url ${e}`);if(this.connecting)return new Promise(((e,t)=>{this.events.once("fail",(e=>{t(e)})),this.events.once("open",(()=>{if("undefined"==typeof this.socket)return t(new Error("Connect lost"));e(this.socket)}))}));this.url=e,this.state=r.Connecting;new URLSearchParams(e).get("origin");return new Promise(((t,n)=>{const i=new ae(e,[]);L()?i.onerror=e=>{const t=e;this.state=r.OnError,this.emitError(t.error),n(new Error(t.message))}:i.on("error",(e=>{this.state=r.OnError,this.emitError(e),n(new Error("socketError"))})),i.onopen=()=>{h("socket opened"),this.onopen(i),this.heartbeat(),t(i)}}))}onVisibleChanged(){return re(this,void 0,void 0,(function*(){if("visible"!==document.visibilityState||(h(`get changed ${this.state}, ${this.socket}`),this.state!=r.Connected||"undefined"!==typeof this.socket));else{h("CONNECTION need reopen");try{yield this.registOpen()}catch(e){u("regist open failed")}}}))}connect(){return re(this,void 0,void 0,(function*(){yield this.registOpen(this.url),document.removeEventListener("visibilitychange",this.onVisibleChanged.bind(this)),document.addEventListener("visibilitychange",this.onVisibleChanged.bind(this))}))}disconnect(){return re(this,void 0,void 0,(function*(){return this.state=r.Disconnected,new Promise(((e,t)=>{"undefined"!==typeof this.socket?(this.socket.onclose=t=>{this.onClose(t),e()},this.socket.close(),this.heartbeatTimer&&clearTimeout(this.heartbeatTimer)):e()}))}))}currentStatus(){return{state:this.state,url:this.url}}addListener(e,t,n,i){this.listenPayloadHandler&&this.events.removeListener("payload",this.listenPayloadHandler),this.listenPayloadHandler=s=>{var o;h(`<<< get payload ${s}`);let r=m(s);if(r.params&&r.params.data){let a=null===(o=r.params.data)||void 0===o?void 0:o.message;if(a)try{let s=t(a);void 0===s?(h("CONNECT: decrypt undefined"),i(e,"Decrypt undefined")):n(e,s)}catch(s){h(`CONNECT: decrypt failed: ${s}`),i(e,s.message)}}},this.events.on("payload",this.listenPayloadHandler),this.failHandler&&this.events.removeListener("fail",this.failHandler),this.failHandler=t=>{t?(h(`CONNECT failed: ${t}`),i(e,t.message)):i(e,"Unkonow error")},this.events.on("fail",this.failHandler)}addPackageParse(e){this.payloadHandler&&this.events.removeListener("payload",this.payloadHandler),this.payloadHandler=t=>re(this,void 0,void 0,(function*(){h(`CONNECTION @[${(new Date).toUTCString()}] <<<< received e:${t}`);let n=m(t);yield e(n)})),this.events.on("payload",this.payloadHandler)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}send(e,t){return re(this,void 0,void 0,(function*(){"undefined"===typeof this.socket&&(h(`>>> send payload undefined ${t}`),yield e());try{h(`CONNECTION @[${(new Date).toUTCString()}]>>> send payload ${v(t)}`),this.socket&&this.socket.send(v(t))}catch(n){this.onError(t.id,n)}}))}getMsgPayloadFromHistory(e){return re(this,void 0,void 0,(function*(){if("undefined"===typeof e)return;let t={params:{data:e}},n=v(e);h("get received data from history"),h(n),n=v(t),this.events.emit("payload",n)}))}onOpen(e){this.openHandler&&this.events.removeListener("open",this.openHandler),this.openHandler=()=>re(this,void 0,void 0,(function*(){h(`CONNECTION @[${(new Date).toUTCString()}] >>> ws opened: `),yield e()})),this.events.on("open",this.openHandler)}}const de="login",le="publish",he="subscribe",ue="unsubscribe",fe="receive",pe="fetchMessages",ge="ck",me="cck_k",ve="cspk_",ye="cjk_k",be="ct",Ce="csp",_e="scp",we="scs",Oe="scpc",Ee="wallet",ke="dapp",Re=864e5;var Ne=n(4473);class Se{constructor(e){const t=q();this.storeKey="",this.cipherIV="",this.subKey=e,h("--------get current local storage --------"),h(t);const n=t.getItem(Se.cacheKey+e);if("undefined"===typeof n||null===n)return h("with no cache"),void(this.cache={});if(h(n),(null===n||void 0===n?void 0:n.length)>0){var i=m(n);this.cache=i}h(`get cache obj: ${this.cache}`),"undefined"!==typeof this.cache&&null!=this.cache||(this.cache={})}saveContent(e,t,n="-"){let i={id:n,timestamp:Date.now().toString(),content:e};this.saveItem(i,t)}saveItem(e,t){let n=Se.cacheKey+this.subKey;const i=q();h(this.cache),h(`get cache obj: ${this.cache}, ${t}, ${e}`),this.cache[t]=e;let s=v(this.cache);h(`STORAGE: ${t} @ ${this.cache}`),i.setItem(n,s)}getItem(e){return h(`STORAGE >> getItem: ${e} @ ${this.cache}`),this.cache[e]}getCachedPBKDF2InfoKey(){var e,t,n,i;const s=32,o=24;if(this.storeKey.length>0&&(null===(e=this.cipherIV)||void 0===e?void 0:e.length)>0)return{pw:this.storeKey,iv:this.cipherIV};let r=null===(t=this.getItem(we))||void 0===t?void 0:t.content;r||(r=I(k().randomBytes(o)),this.saveContent(r,we));let a=null===(n=this.getItem(_e))||void 0===n?void 0:n.content;a||(a=I(k().randomBytes(s)),this.saveContent(a,_e));let c=null===(i=this.getItem(Oe))||void 0===i?void 0:i.content;if(!c){let e=k().randomBytes(16);c=I(e),this.saveContent(c,Oe)}return this.cipherIV=c,this.storeKey=(0,Ne.PBKDF2)(a,r,{iterations:10}).toString(),{pw:this.storeKey,iv:this.cipherIV}}encryptStoreMsg(e,t){h(`encryptStoreMsg  encryptStoreMsg start ${Date.now()}`);let n=this.getCachedPBKDF2InfoKey();h(`encryptStoreMsg  encryptStoreMsg mid ${Date.now()}`);var i=Ne.AES.encrypt(e,n.pw).toString();this.saveContent(i,t),h(`encryptStoreMsg  encryptStoreMsg end ${Date.now()}`)}getAndDecrypt(e){h(`encryptStoreMsg  getAndDecrypt start ${Date.now()}`);let t=this.getItem(e);if(t&&t.content){let e=this.getCachedPBKDF2InfoKey();h(`encryptStoreMsg  getAndDecrypt mid ${Date.now()}`);let n=Ne.AES.decrypt(t.content,e.pw).toString(Ne.enc.Utf8);return h(`encryptStoreMsg  getAndDecrypt end ${Date.now()}`),n}return null}clearCache(e=void 0){if(void 0===e){this.cache={};let e=Se.cacheKey+this.subKey;localStorage.setItem(e,"")}else{let t=Se.cacheKey+this.subKey;const n=q();h(this.cache),this.cache[e]=null;let i=v(this.cache);h(`STORAGE: clean key ${e} @ ${this.cache}`),n.setItem(t,i)}}}Se.cacheKey="OKXStorageKey";class Te{constructor(e=void 0){this.nonceLength=24,this.sessionKeyPair=e?this.createKeypairFromString(e):this.createKeypair(),console.log("create session keypair from keypair:",e,{publicKey:I(this.sessionKeyPair.publicKey),secretKey:I(this.sessionKeyPair.secretKey)})}createKeypair(){return k().box.keyPair()}createKeypairFromString(e){return{publicKey:D(e.publicKey),secretKey:D(e.secretKey)}}createNonce(){return k().randomBytes(this.nonceLength)}get keyPair(){return this.sessionKeyPair}encrypt(e,t){const n=(new TextEncoder).encode(e),i=this.createNonce(),s=k().box(n,i,D(t),this.keyPair.secretKey);console.log("use nonce: ",i,s);let o=A(i,s);console.log("before hex: ",o);var r=I(o);console.log("before encode: ",r);var a=(new TextEncoder).encode(r);return console.log("before base64: ",a),console.log("send encrypt:",`Decryption error: \n message: ${e.toString()} \n receiver pubkey: ${t.toString()} \n keypair pubkey: ${I(this.keyPair.publicKey)} \n keypair secretkey: ${I(this.keyPair.secretKey)}`),W(a,!1)}encryptWallet(e,t){const n=(new TextEncoder).encode(e),i=this.createNonce(),s=k().box(n,i,D(t),this.keyPair.secretKey);console.log("use nonce: ",i,s);let o=A(i,s);return console.log("before hex: ",o),W(o,!1)}decrypt(e,t){let n=U(e,!0),i=n.toUint8Array();console.log("after base64 decode uint8 array: ",i,this.nonceLength);const[s,o]=F(i,this.nonceLength);console.log("parse nonce: ",s);const r=k().box.open(o,s,D(t),this.keyPair.secretKey);if(!r)throw new Error(`Decryption error: \n message: ${e.toString()} \n sender pubkey: ${t.toString()} \n keypair pubkey: ${I(this.keyPair.publicKey)} \n keypair secretkey: ${I(this.keyPair.secretKey)}`);return(new TextDecoder).decode(r)}decryptWallet(e,t){let n=U(e,!0),i=D(n.toString());console.log("after base64 decode uint8 array: ",i,this.nonceLength);const[s,o]=F(i,this.nonceLength);console.log("parse nonce: ",s);const r=k().box.open(o,s,D(t),this.keyPair.secretKey);if(!r)throw new Error(`Decryption error: \n message: ${e.toString()} \n sender pubkey: ${t.toString()} \n keypair pubkey: ${I(this.keyPair.publicKey)} \n keypair secretkey: ${I(this.keyPair.secretKey)}`);return(new TextDecoder).decode(r)}stringifyKeypair(){return{publicKey:I(this.keyPair.publicKey),secretKey:I(this.keyPair.secretKey)}}}n(8091);var Pe=function(e,t,n,i){function s(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function r(e){try{c(i.next(e))}catch(t){o(t)}}function a(e){try{c(i["throw"](e))}catch(t){o(t)}}function c(e){e.done?n(e.value):s(e.value).then(r,a)}c((i=i.apply(e,t||[])).next())}))};const Ke="EdDSA",De="JWT",Ie=".",Ae="base64url",Fe="utf8",xe="utf8",$e=":",We="did",Ue="key",je="base58btc";function Me(){return k().sign.keyPair()}function Le(e){return(0,T.d)((0,S.s)(v(e),Fe),Ae)}function qe(e){h(`publicKey: ${I(e)}`);var t=(0,T.d)(e,je);return[We,Ue,t].join($e)}function Xe(e){return(0,T.d)(e,Ae)}function Je(e){return(0,S.s)([Le(e.header),Le(e.payload)].join(Ie),xe)}function Be(e){return[Le(e.header),Le(e.payload),Xe(e.signature)].join(Ie)}function He(e,t,n,i){return Pe(this,arguments,void 0,(function*(e,t,n,i,s=Math.floor(Date.now())){const o={alg:Ke,typ:De},r=qe(i.publicKey),a=s+n,c="authenticate user",d={iss:r,sub:e,aud:t,act:c,iat:s,exp:a},l=Je({header:o,payload:d});h(`get sec kp: ${i.secretKey} {${i.secretKey.length}}`);const u=k().sign.detached(l,i.secretKey);return Be({header:o,payload:d,signature:u})}))}var Ve=function(e,t,n,i){function s(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function r(e){try{c(i.next(e))}catch(t){o(t)}}function a(e){try{c(i["throw"](e))}catch(t){o(t)}}function c(e){e.done?n(e.value):s(e.value).then(r,a)}c((i=i.apply(e,t||[])).next())}))};class Ge{constructor(){this.events=new oe.b,this.connectStorage=new Se(ge),this.crypto=new Te,this.jwtKeyPair=this.getCachedJWTKeyPair(),this.saveJWTKeyPair(this.jwtKeyPair),this.connector=new ce(i),this.packageId=Date.now(),this.connectedWalletPK="",this.currentTopic="",h(`this.connectedWalletPK  constructor   ${this.connectedWalletPK}`)}refreshPackageId(){this.packageId=Date.now()}saveCryptoKeyPair(e){let t=v(e);this.connectStorage.encryptStoreMsg(t,me)}getCachedCryptoKeyPair(){const e=this.connectStorage.getAndDecrypt(me),t=e;if("string"==typeof t){h("get cached crypto key:"),h(t);let e=m(t);return e}return this.connectStorage.clearCache(),null}saveJWTKeyPair(e){var t={publicKey:I(e.publicKey),secretKey:I(e.secretKey)};h("save jwt kp");let n=v(t);h(n),this.connectStorage.encryptStoreMsg(n,ye)}getCachedJWTKeyPair(){const e=this.connectStorage.getAndDecrypt(ye),t=e;if("string"==typeof t){h("get cached jwt kp:"),h(t);let e=m(t);h("save jwt kp"),h(e);var n={publicKey:D(e.publicKey),secretKey:D(e.secretKey)};return n}return Me()}isWalletPKReady(){return h(`isWalletPKReady  ===> ${this.connectedWalletPK}`),this.connectedWalletPK.length>0}makeJWT(e){return Ve(this,void 0,void 0,(function*(){return yield He(e,Ee,Re,this.jwtKeyPair)}))}parsePackage(e){return Ve(this,arguments,void 0,(function*(e,t=!1){var n,i,s;if(this.events.emit(e.id,e),!t){yield this.sendACK(e.id,!0);let t=null===(n=this.connectStorage.getItem(be))||void 0===n?void 0:n.content;if(t){let n=e;(null===(s=null===(i=n.params)||void 0===i?void 0:i.data)||void 0===s?void 0:s.messageId)&&(this.refreshPackageId(),yield this.sendReceive(this.packageId.toString(),e.id,t))}}}))}restoreConnect(e){return Ve(this,void 0,void 0,(function*(){if(h(`connectionManager  restoreConenct   ${e}`),"string"!==typeof e||0===e.length)throw new Error("CONNECTION: invalid topic");h("connectionManager  restoreConenct   disconnect"),yield this.disconnect(!0),this.connectStorage.saveContent(e,be),h("connectionManager  restoreConenct   conect"),yield this.connect(!0)}))}getConnectInfo(){var e=H();h(`generate topic token: ${e}`),this.currentTopic=e;const t={channelId:e,clientId:this.crypto.stringifyKeypair().publicKey};return t}connect(){return Ve(this,arguments,void 0,(function*(e=!1){this.timeLog=(new Date).getTime(),h("ConnectTime---enter->",this.timeLog);let t=this.connectStorage.getItem(be);var n=this.currentTopic;if(h(`generate topic token: ${n}`),e){"undefined"!==typeof t&&null!==t&&(h(`read last connect id: ${t}`),n=t.content);var i=this.connectStorage.getItem(Ce);i&&(this.connectedWalletPK=i.content);const e=this.getCachedCryptoKeyPair();this.crypto=new Te(e)}h(`use crypto client id: ${this.crypto.stringifyKeypair().publicKey}`),this.connectStorage.saveContent(n,be);var s=yield this.makeJWT(n);return h(`generate jwt token: ${s}`),this.connectStorage.saveContent(s,"jwt"),new Promise(((e,t)=>{this.connector.onOpen((()=>Ve(this,void 0,void 0,(function*(){h("1. connector on open");const i=(new Date).getTime();h("ConnectTime---open->",i-this.timeLog),this.events.once(this.packageId.toString(),(i=>Ve(this,void 0,void 0,(function*(){if(i&&i.error){u("failed when login"),yield this.connector.disconnect();var s=new Error;s.message=i.error.message,s.name=i.error.code.toString(),t(s)}this.refreshPackageId(),this.events.once(this.packageId.toString(),(i=>Ve(this,void 0,void 0,(function*(){if(i&&i.error){u("failed when subscribe"),yield this.connector.disconnect();var s=new Error;s.message=i.error.message,s.name=i.error.code.toString(),t(s)}this.refreshPackageId(),h(`4. subscribe callback then send fetch: ${this.packageId}`);const o=(new Date).getTime();h("ConnectTime--subscribe callback->",o-this.timeLog),yield this.sendFetchAndConsumeMessages(this.packageId.toString(),n),e()})))),h(`3. login callback then send subscribe: ${this.packageId}`);const r=(new Date).getTime();h("ConnectTime---login callback->",r-this.timeLog),yield this.connector.send((()=>Ve(this,void 0,void 0,(function*(){h("CONNECT: reconnect before send"),yield this.connector.connect()}))),{id:this.packageId.toString(),jsonrpc:o,method:he,params:{topic:n}})})))),h("2. login called"),yield this.connector.send((()=>Ve(this,void 0,void 0,(function*(){h("CONNECT: reconnect before send"),yield this.connector.connect()}))),{id:this.packageId.toString(),jsonrpc:o,method:de,params:{token:s}}),this.connector.addPackageParse((e=>{var t;if(h("connect: parse package"),h(e),!("params"in e)||!("data"in e["params"]))return void this.parsePackage(e,!0);let n=null===(t=e.params.data)||void 0===t?void 0:t.message;if("undefined"!==typeof n){n=n.replace(/'/g,'"');let e=m(n);"string"!==typeof e&&"clientId"in e&&e.clientId&&e.clientId.length>0&&(this.connectedWalletPK=e.clientId,h(`this.connectedWalletPK  addPackageParse   ${this.connectedWalletPK}`),this.connectStorage.saveContent(this.connectedWalletPK,Ce),this.saveCryptoKeyPair(this.crypto.stringifyKeypair()))}this.parsePackage(e,e.method===fe)}))})))),this.connector.connect()}))}))}disconnect(){return Ve(this,arguments,void 0,(function*(e=!1){yield this.connector.disconnect(),this.connectStorage.clearCache(be),e||(this.connectStorage.clearCache(Ce),this.connectedWalletPK="")}))}addListener(e,t,n){this.connector.addListener(v(e),(e=>{if(e=e.replace(/'/g,'"'),h(`addListener ===> ${e}`),"undefined"!==typeof e){var t=m(e),n=t.message;t.clientId&&t.clientId.length>0&&(this.connectedWalletPK=t.clientId,this.connectStorage.saveContent(this.connectedWalletPK,Ce),h(`this.connectedWalletPK  addListener   ${this.connectedWalletPK}`),h(`this.cryptoKey  addListener   ${I(this.crypto.keyPair.publicKey)}`),this.saveCryptoKeyPair(this.crypto.stringifyKeypair()));var i=this.crypto.decrypt(n,this.connectedWalletPK);return h(`addListener ===> ${i}`),i}}),t,n)}send(e){return Ve(this,void 0,void 0,(function*(){if(h(`message send =====> ${e}`),!this.isWalletPKReady())throw new Error("connection not finish");let t=this.crypto.encrypt(e,this.connectedWalletPK),n=this.connectStorage.getItem(be);this.refreshPackageId();const i={id:this.packageId.toString(),method:le,jsonrpc:o,params:{message:{topic:null===n||void 0===n?void 0:n.content,message:t,ttl:s}}};return this.events.once(this.packageId.toString(),(e=>Ve(this,void 0,void 0,(function*(){e&&e.error?u(`@${(new Date).toUTCString()} >>> failed when send msg`):e&&!e.error&&h(`CONNECTION @[${(new Date).toUTCString()}] >>> send msg with id ${this.packageId} successed`)})))),yield this.connector.send((()=>Ve(this,void 0,void 0,(function*(){h("CONNECT: reconnect before send"),yield this.connector.connect()}))),i),this.packageId}))}sendACK(e,t){return Ve(this,arguments,void 0,(function*(e,t,n=void 0){if(!0===t){const t={id:e,jsonrpc:o,result:!0};yield this.connector.send((()=>Ve(this,void 0,void 0,(function*(){h("CONNECT: reconnect before send"),yield this.connector.connect()}))),t)}else if(n){const t={id:e,jsonrpc:o,error:{code:n.code,message:n.message}};yield this.connector.send((()=>Ve(this,void 0,void 0,(function*(){h("CONNECT: reconnect before send"),yield this.connector.connect()}))),t)}}))}sendReceive(e,t,n){return Ve(this,void 0,void 0,(function*(){const i={id:e,jsonrpc:o,method:fe,params:{data:{messageId:t,topic:n}}};yield this.connector.send((()=>Ve(this,void 0,void 0,(function*(){h("CONNECT: reconnect before send"),yield this.connector.connect()}))),i)}))}sendFetchAndConsumeMessages(e,t){return Ve(this,void 0,void 0,(function*(){this.events.once(e,(e=>Ve(this,void 0,void 0,(function*(){var n,i;if(e.result){var s=e.result.hasMore,o=e.result.data;if(o)for(let e=0;e<o.length;e++){let n=o[e];if(n&&n.topic==t){let e=n.messageId;yield this.connector.getMsgPayloadFromHistory(n),this.refreshPackageId(),yield this.sendReceive(this.packageId.toString(),e,t)}}s&&(this.refreshPackageId(),yield this.sendFetchAndConsumeMessages(this.packageId.toString(),t))}else h(`CONNECT: get error rsp ${null===(n=e.error)||void 0===n?void 0:n.code} : ${null===(i=e.error)||void 0===i?void 0:i.message}`)})))),h("5. send fetch more");const n=(new Date).getTime();h("ConnectTime---5->",n-this.timeLog);const i={id:e,jsonrpc:o,method:pe,params:{data:{topic:t}}};yield this.connector.send((()=>Ve(this,void 0,void 0,(function*(){h("CONNECT: reconnect before send"),yield this.connector.connect()}))),i)}))}cleanCache(){return Ve(this,void 0,void 0,(function*(){this.connectStorage.clearCache()}))}saveSessionContent(e,t){t||this.connectStorage.clearCache(ve+e);let n=v(t);this.connectStorage.encryptStoreMsg(n,ve+e)}getSessionContent(e){let t=this.connectStorage.getAndDecrypt(ve+e);if(t){let e=m(t);return e}}}const ze="wcmtic";var Ye=function(e,t,n,i){function s(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function r(e){try{c(i.next(e))}catch(t){o(t)}}function a(e){try{c(i["throw"](e))}catch(t){o(t)}}function c(e){e.done?n(e.value):s(e.value).then(r,a)}c((i=i.apply(e,t||[])).next())}))};class Qe{constructor(){this.events=new oe.b,this.communicateEvents=new oe.b,h("connect manager construct"),this.connectStorage=new Se(ge),this.jwtKeyPair=this.getCachedJWTKeyPair(),this.saveJWTKeyPair(this.jwtKeyPair),this.connector=new ce(i),this.packageId=Date.now(),this.sessionCryptoInfoMap=new Map,this.inLogin=!1,this.isLogined=!1}refreshPackageId(){this.packageId=Date.now()}saveCryptoKeyPair(e,t){let n=v(t);this.connectStorage.encryptStoreMsg(n,me+e)}getCachedCryptoKeyPair(e){const t=this.connectStorage.getAndDecrypt(me+e),n=t;if("string"==typeof n){h("get cached crypto key:"),h(n);let e=m(n);return e}return this.connectStorage.clearCache(),null}saveJWTKeyPair(e){var t={publicKey:I(e.publicKey),secretKey:I(e.secretKey)};h("save jwt kp");let n=v(t);h(n),this.connectStorage.encryptStoreMsg(n,ye),h("after save jwt kp")}getCachedJWTKeyPair(){const e=this.connectStorage.getAndDecrypt(ye),t=e;if("string"==typeof t){h("get cached jwt kp:"),h(t);let e=m(t);h("save jwt kp"),h(e);var n={publicKey:D(e.publicKey),secretKey:D(e.secretKey)};return n}return Me()}isTopicPublicKeyExist(e){return h(`isTopicPublicKeyExist  ===> ${e}`),this.sessionCryptoInfoMap.get(e)}makeJWT(e){return Ye(this,void 0,void 0,(function*(){return yield He(e,ke,Re,this.jwtKeyPair)}))}parsePackage(e,t){return Ye(this,arguments,void 0,(function*(e,t,n=!1){var i,s,o;this.events.emit(t.id,t);let r=this.sessionCryptoInfoMap.get(e);if(h("get sessionInfo for decrypt:",r),r&&t.params.data){var a=void 0;a=r.crypto.decryptWallet(null===(i=t.params.data)||void 0===i?void 0:i.message,r.dappPublicKey),h("<<< receive msg:",e,a),this.communicateEvents.emit(e,a)}if(!n&&(yield this.sendACK(t.id,!0),e)){let n=t;(null===(o=null===(s=n.params)||void 0===s?void 0:s.data)||void 0===o?void 0:o.messageId)&&(this.refreshPackageId(),yield this.sendReceive(this.packageId.toString(),t.id,e))}}))}recovrySessionInfoFromCache(){let e=this.connectStorage.getAndDecrypt(ze);if(h("get cached sessionInfos:",e),e){let t=m(e);for(let e in t){let n=t[e];h("make topicItem:",n);let i={topic:e,crypto:new Te({publicKey:n.cryptoKeyPair.publicKey,secretKey:n.cryptoKeyPair.secretKey}),dappPublicKey:n.dappPublicKey};this.sessionCryptoInfoMap.set(e,i)}}h("get cached sessionInfos map:",this.sessionCryptoInfoMap)}syncCacheSessionInfo(){let e={};for(let[n,i]of this.sessionCryptoInfoMap)h("for each Keys",n),i&&(e[n]={cryptoKeyPair:i.crypto.stringifyKeypair(),dappPublicKey:i.dappPublicKey});let t=v(e);h("sync cache sessionInfos:",t),this.connectStorage.encryptStoreMsg(t,ze)}cacheSessionInfo(e,t){this.sessionCryptoInfoMap.set(e,t),h("cache sessionInfo:",e,t,this.sessionCryptoInfoMap),this.syncCacheSessionInfo()}appendTopic(e,t){return Ye(this,void 0,void 0,(function*(){return h("4.1. get append Topic:",e),new Promise(((n,i)=>Ye(this,void 0,void 0,(function*(){if(!this.isLogined){var s=new Error;return s.message="connection is not logined",s.name="append error",void i(s)}yield this.subscribeTopics(Array.from([e]));let o={topic:e,crypto:new Te,dappPublicKey:t};this.cacheSessionInfo(e,o),n()}))))}))}connect(){return Ye(this,void 0,void 0,(function*(){this.timeLog=(new Date).getTime(),h("[Wallet] ConnectTime---enter->",this.timeLog);let e=Date.now().toString();var t=yield this.makeJWT(e);return h(`generate jwt token: ${t}`),this.connectStorage.saveContent(t,"jwt"),this.recovrySessionInfoFromCache(),new Promise(((e,n)=>{this.inLogin=!0,this.connector.onOpen((()=>Ye(this,void 0,void 0,(function*(){h("1. connector on open");const i=(new Date).getTime();h("ConnectTime---open->",i-this.timeLog),this.events.once(this.packageId.toString(),(t=>Ye(this,void 0,void 0,(function*(){if(t&&t.error){u("failed when login"),yield this.connector.disconnect();var i=new Error;i.message=t.error.message,i.name=t.error.code.toString(),n(i)}else this.isLogined=!0,e(),h("3. subscribe cached topics",this.sessionCryptoInfoMap),this.sessionCryptoInfoMap.size>0&&(yield this.subscribeTopics(Array.from(this.sessionCryptoInfoMap.keys())))})))),h("2. login called"),yield this.connector.send((()=>Ye(this,void 0,void 0,(function*(){h("CONNECT: reconnect before send"),yield this.connector.connect()}))),{id:this.packageId.toString(),jsonrpc:o,method:de,params:{token:t}})})))),this.connector.connect(),this.connector.addPackageParse((e=>{var t,n;h("connect: parse package"),h(e),"params"in e&&"data"in e["params"]?(null===(t=e.params.data)||void 0===t?void 0:t.topic)&&this.parsePackage(null===(n=e.params.data)||void 0===n?void 0:n.topic,e,e.method===fe):this.parsePackage("",e,!0)}))}))}))}getSessionPublicKey(e){if(this.isTopicPublicKeyExist(e)){let t=this.sessionCryptoInfoMap.get(e);if(t)return I(t.crypto.keyPair.publicKey)}}getCurrentCachedTopicIdList(){return Array.from(this.sessionCryptoInfoMap.keys())}disconnect(){return Ye(this,arguments,void 0,(function*(e=!1){yield this.connector.disconnect(),this.connectStorage.clearCache(be),e||this.connectStorage.clearCache(Ce)}))}send(e,t){return Ye(this,arguments,void 0,(function*(e,t,n=!1){var i,r;if(h(`message send =====> ${t}`),!this.isTopicPublicKeyExist(e))throw new Error("connection not finish");let a=null===(i=this.sessionCryptoInfoMap.get(e))||void 0===i?void 0:i.dappPublicKey,c=null===(r=this.sessionCryptoInfoMap.get(e))||void 0===r?void 0:r.crypto;if(c&&a){let i=c.encryptWallet(t,a),r={message:i};if(n){r.clientId=I(c.keyPair.publicKey);let e=I(c.keyPair.secretKey);h(`message send use dapp publicKey =====> ${a}`),h(`message send use publicKey =====> ${r.clientId}`),h(`message send use secretKey =====> ${e}`)}this.refreshPackageId();const d={id:this.packageId.toString(),method:le,jsonrpc:o,params:{message:{topic:e,message:v(r),ttl:s}}};return this.events.once(this.packageId.toString(),(e=>Ye(this,void 0,void 0,(function*(){e&&e.error?u(`@${(new Date).toUTCString()} >>> failed when send msg`):e&&!e.error&&h(`CONNECTION @[${(new Date).toUTCString()}] >>> send msg with id ${this.packageId} successed`)})))),yield this.connector.send((()=>Ye(this,void 0,void 0,(function*(){h("CONNECT: reconnect before send"),yield this.connector.connect()}))),d),this.packageId}}))}sendACK(e,t){return Ye(this,arguments,void 0,(function*(e,t,n=void 0){if(!0===t){const t={id:e,jsonrpc:o,result:!0};yield this.connector.send((()=>Ye(this,void 0,void 0,(function*(){h("CONNECT: reconnect before send"),yield this.connector.connect()}))),t)}else if(n){const t={id:e,jsonrpc:o,error:{code:n.code,message:n.message}};yield this.connector.send((()=>Ye(this,void 0,void 0,(function*(){h("CONNECT: reconnect before send"),yield this.connector.connect()}))),t)}}))}sendReceive(e,t,n){return Ye(this,void 0,void 0,(function*(){const i={id:e,jsonrpc:o,method:fe,params:{data:{messageId:t,topic:n}}};yield this.connector.send((()=>Ye(this,void 0,void 0,(function*(){h("CONNECT: reconnect before send"),yield this.connector.connect()}))),i)}))}sendUnsubscribe(e){return Ye(this,void 0,void 0,(function*(){yield this.connector.send((()=>Ye(this,void 0,void 0,(function*(){h("CONNECT: reconnect before send"),yield this.connector.connect()}))),{id:this.packageId.toString(),jsonrpc:o,method:ue,params:{topic:e}}),this.sessionCryptoInfoMap.delete(e),this.syncCacheSessionInfo()}))}sendFetchAndConsumeMessages(e,t){return Ye(this,void 0,void 0,(function*(){this.events.once(e,(e=>Ye(this,void 0,void 0,(function*(){var n,i;if(e.result){var s=e.result.hasMore,o=e.result.data;if(o)for(let e=0;e<o.length;e++){let n=o[e];if(n&&n.topic==t){let e=n.messageId;yield this.connector.getMsgPayloadFromHistory(n),this.refreshPackageId(),yield this.sendReceive(this.packageId.toString(),e,t)}}s&&(this.refreshPackageId(),yield this.sendFetchAndConsumeMessages(this.packageId.toString(),t))}else h(`CONNECT: get error rsp ${null===(n=e.error)||void 0===n?void 0:n.code} : ${null===(i=e.error)||void 0===i?void 0:i.message}`)})))),h("5. send fetch more");const n=(new Date).getTime();h("ConnectTime---5->",n-this.timeLog);const i={id:e,jsonrpc:o,method:pe,params:{data:{topic:t}}};yield this.connector.send((()=>Ye(this,void 0,void 0,(function*(){h("CONNECT: reconnect before send"),yield this.connector.connect()}))),i)}))}cleanCache(){return Ye(this,void 0,void 0,(function*(){this.connectStorage.clearCache()}))}saveSessionContent(e,t){t||this.connectStorage.clearCache(ve+e);let n=v(t);this.connectStorage.encryptStoreMsg(n,ve+e)}getSessionContent(e){let t=this.connectStorage.getAndDecrypt(ve+e);if(t){let e=m(t);return e}}subscribeTopics(e){return Ye(this,void 0,void 0,(function*(){return h("4.2 topicid list",e),new Promise(((t,n)=>Ye(this,void 0,void 0,(function*(){let n=0;for(let i=0;i<e.length;++i){let s=e[i];this.refreshPackageId(),this.events.once(this.packageId.toString(),(i=>Ye(this,void 0,void 0,(function*(){if(i&&i.error){u("failed when subscribe"),yield this.connector.disconnect();var o=new Error;o.message=i.error.message,o.name=i.error.code.toString(),n+=1,n==e.length&&t()}this.refreshPackageId(),h(`4. subscribe callback then send fetch: ${this.packageId}, ${s}`);const r=(new Date).getTime();h("ConnectTime--subscribe callback->",r-this.timeLog),yield this.sendFetchAndConsumeMessages(this.packageId.toString(),s),n+=1,n==e.length&&t()})))),h(`3. login callback then send subscribe: ${this.packageId}, ${s}`);const r=(new Date).getTime();h("ConnectTime---login callback->",r-this.timeLog),yield this.connector.send((()=>Ye(this,void 0,void 0,(function*(){h("CONNECT: reconnect before send"),yield this.connector.connect()}))),{id:this.packageId.toString(),jsonrpc:o,method:he,params:{topic:s}})}}))))}))}}var Ze;n(4114);class et extends Error{constructor(e,t){void 0==t&&(t=tt(e)),super(t),this.code=e,this.message=`${et.prefix} ${t?"\n"+t:""}`,Object.setPrototypeOf(this,et.prototype)}}function tt(e){return e==Ze.UNKNOWN_ERROR?"unknown error":e==Ze.BAD_REQUEST_ERROR?"bad request error":e==Ze.ALREADY_CONNECTED_ERROR?"already connected error":e==Ze.NOT_CONNECTED_ERROR?"not connected error":e==Ze.UNKNOWN_APP_ERROR?"unknown app error":e==Ze.USER_REJECTS_ERROR?"user rejects error":e==Ze.METHOD_NOT_SUPPORTED?"method not supported":"unknown error"}et.prefix="[OKX_CONNECT_SDK_ERROR]",function(e){e[e["UNKNOWN_ERROR"]=0]="UNKNOWN_ERROR",e[e["BAD_REQUEST_ERROR"]=1]="BAD_REQUEST_ERROR",e[e["ALREADY_CONNECTED_ERROR"]=11]="ALREADY_CONNECTED_ERROR",e[e["NOT_CONNECTED_ERROR"]=12]="NOT_CONNECTED_ERROR",e[e["UNKNOWN_APP_ERROR"]=100]="UNKNOWN_APP_ERROR",e[e["USER_REJECTS_ERROR"]=300]="USER_REJECTS_ERROR",e[e["METHOD_NOT_SUPPORTED"]=400]="METHOD_NOT_SUPPORTED",e[e["CHAIN_NOT_SUPPORTED"]=500]="CHAIN_NOT_SUPPORTED",e[e["WALLET_NOT_SUPPORTED"]=600]="WALLET_NOT_SUPPORTED"}(Ze||(Ze={}));const nt="PARSE_ERROR",it="INVALID_REQUEST",st="METHOD_NOT_FOUND",ot="INVALID_PARAMS",rt="INTERNAL_ERROR",at="SERVER_ERROR",ct=[-32700,-32600,-32601,-32602,-32603],dt={[nt]:{code:-32700,message:"Parse error"},[it]:{code:-32600,message:"Invalid Request"},[st]:{code:-32601,message:"Method not found"},[ot]:{code:-32602,message:"Invalid params"},[rt]:{code:-32603,message:"Internal error"},[at]:{code:-32e3,message:"Server error"}},lt=at,ht="eip155",ut="sol",ft="ton";function pt(e){return"object"===typeof e&&"id"in e&&"jsonrpc"in e&&"2.0"===e.jsonrpc}function gt(e){return pt(e)&&(mt(e)||vt(e))}function mt(e){return"result"in e}function vt(e){return"error"in e}class yt{constructor(e){this.i=1;const t=8===e?new Uint8Array(1):16===e?new Uint16Array(1):new Uint32Array(1);this.initialValue=crypto.getRandomValues(t)[0]}getNextValue(){return this.initialValue+this.i++}}const bt=new yt(8),Ct=new yt(16);function _t(){const e=1e3*Date.now(),t=bt.getNextValue();return e+t}function wt(){const e=BigInt(Date.now())*BigInt(1e6),t=BigInt(Ct.getNextValue());return e+t}function Ot(e,t,n){return{id:n||_t(),jsonrpc:"2.0",method:e,params:t}}function Et(e,t,n){return{id:e,jsonrpc:"2.0",error:St(t,n)}}function kt(e){return ct.includes(e)}function Rt(e){return Object.keys(dt).includes(e)?dt[e]:dt[lt]}function Nt(e){const t=Object.values(dt).find((t=>t.code===e));return t||dt[lt]}function St(e,t){return"undefined"===typeof e?Rt(rt):("string"===typeof e&&(e=Object.assign(Object.assign({},Rt(at)),{message:e})),"undefined"!==typeof t&&(e.data=t),kt(e.code)&&(e=Nt(e.code)),e)}function Tt(e){const t=e.match(new RegExp(/^\w+:/,"gi"));if(t&&t.length)return t[0]}function Pt(e,t){const n=Tt(e);return"undefined"!==typeof n&&new RegExp(t).test(n)}function Kt(e){return Pt(e,"^https?:")}function Dt(e,t,n){return e.message.includes("getaddrinfo ENOTFOUND")||e.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${n} RPC url at ${t}`):e}class It extends oe.A{constructor(){super()}}class At extends oe.A{constructor(){super()}}class Ft{constructor(e){this.data=e}}class xt{constructor(e){this.client=e}}var $t,Wt;function Ut(e){let t=jt(e);return t}function jt(e){let t={};console.log("buildRequestAccountNameSpacesByConnectResponse >>",JSON.stringify(e));const n=e.payload.responses.find((e=>"requestAccounts"===e.name));return n.accounts.forEach((e=>{var n=[],i=[];e.addresses.forEach((e=>{var t=e.split(":");3==t.length&&(n.push(`${t[0]}:${t[1]}`),i.push(e))})),t[e.namespace]={chains:n,accounts:i,methods:e.methods}})),t}(function(e){e["MAINNET"]="-239"})($t||($t={})),function(e){e[e["UNKNOWN_ERROR"]=0]="UNKNOWN_ERROR",e[e["METHOD_NOT_SUPPORTED"]=400]="METHOD_NOT_SUPPORTED"}(Wt||(Wt={}));var Mt=function(e,t,n,i){function s(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function r(e){try{c(i.next(e))}catch(t){o(t)}}function a(e){try{c(i["throw"](e))}catch(t){o(t)}}function c(e){e.done?n(e.value):s(e.value).then(r,a)}c((i=i.apply(e,t||[])).next())}))};class Lt{constructor(e){this.pendingRequests=new Map,this.disconnectListener=[],this.connectionManager=e,this.connectionManager.addListener("sdk_response",((e,t)=>{var n=m(t);h(`Engine ==>> addListener ==> success ==> ${n}`),this.handleResponse(e,n)}),(function(){}))}addDisconnectListener(e){this.disconnectListener.push(e)}disconnect(){h("Engine ==>> disconnect"),this.pendingRequests.clear()}getRequestId(){const e=Date.now().toString();return h("Engine ==>> getRequestId ==>",e),e}bindRequestForPromise(e,t){this.pendingRequests.set(e,t)}send(e,t,n){return Mt(this,void 0,void 0,(function*(){const i=this.getRequestId();let s=yield c((()=>this.connectionManager.send(JSON.stringify(Object.assign(Object.assign({},e),{requestId:i})))),n);this.connectionManager.events.once(s.toString(),(e=>{var n;h(`Engine ==> send => onAck => ${v(e)}`),e&&e.result&&(null===(n=t.onAck)||void 0===n||n.call(t))})),t.resolve&&this.bindRequestForPromise(i,t.resolve)}))}handleResponse(e,t){if(h(`Engine ==>> handleResponse_1  ======>response: ${v(t)}`,e),"requestId"in t){h("Engine ==>> handleResponse_2  ===> in response");let e=t.requestId;const n=this.pendingRequests.get(e);n?(h("Engine ==>> handleResponse_3  ===> find resolve:",n),n(t),this.pendingRequests.delete(e)):(h("Engine ==>> handleResponse_3  ===> not find resolve:"),"disconnect"===t.method&&(this.disconnectListener.forEach((e=>e())),this.disconnectListener=[],this.disconnect()))}}restoreconnect(e,t){return Mt(this,void 0,void 0,(function*(){var n;yield null===(n=this.connectionManager)||void 0===n?void 0:n.restoreConnect(e.topic),t(e)}))}conect(e,t,n){return Mt(this,void 0,void 0,(function*(){var i,s,o;const r=this.connectionManager.getConnectInfo(),a=this.getRequestId();let c=null!==(i=t.openUniversalUrl)&&void 0!==i&&i;const d={protocolVer:Number(C),topic:r.channelId,clientId:r.clientId,requestId:a,dAppInfo:t.dappInfo,requests:e,redirect:null!==(s=null===t||void 0===t?void 0:t.redirect)&&void 0!==s?s:"none"},l=JSON.stringify(d),u=(new TextEncoder).encode(l),f=btoa(String.fromCharCode(...u)),p=`${b}?param=${f}`;h("bridge-provider ==>> connect_2 ==>>fullUrl:",p);const g=G();return g&&c&&(h("bridge-provider ==>> connect_3"),w(p,f)),yield null===(o=this.connectionManager)||void 0===o?void 0:o.disconnect(!1),this.bindRequestForPromise(a,(e=>{let i=this.onConnect(e,t,r.channelId);n(i,e)})),yield this.connectionManager.connect(),!g&&c&&(h("bridge-provider ==>> connect_4"),w(p,f)),{connectInfo:r,deeplinkUrl:_(p)}}))}onConnect(e,t,n){if("connect"==e.method){let i=Ut(e);if(i){let e={topic:n,sessionConfig:t,namespaces:i};return e}}return null}}},8871:function(e,t,n){"use strict";n(7642),n(8004),n(3853),n(5876),n(2475),n(5024),n(1698);var i=this&&this.__awaiter||function(e,t,n,i){function s(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function r(e){try{c(i.next(e))}catch(t){o(t)}}function a(e){try{c(i["throw"](e))}catch(t){o(t)}}function c(e){e.done?n(e.value):s(e.value).then(r,a)}c((i=i.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OKXUniversalProvider=void 0;const o=n(169),r=s(n(8403)),a=n(4417),c=s(n(1571)),d=n(2776),l=n(897),h=n(3669);class u{static init(e){return i(this,void 0,void 0,(function*(){const t=new u(e);return yield t.initialize(),t}))}constructor(e){this.rpcProviders={},this.events=new c.default,this.providerOpts=e}request(e,t){return i(this,void 0,void 0,(function*(){(0,l.logDebug)("UniversalProvider request args >>>: ",JSON.stringify(e));const[n,i]=this.validateChain(t);if(!this.session)throw new l.OKXConnectError(l.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"Please call connect() before request()");let s=Object.keys(this.session.namespaces);if(!t&&s&&s.length>1)throw new l.OKXConnectError(l.OKX_CONNECT_ERROR_CODES.NOT_CONNECTED_ERROR,"Multiple chains have been linked, the request method requires chain");(0,l.logDebug)("UniversalProvider request >>args>>>: ",e);const o=Object.assign(Object.assign({},e),{chainId:`${n}:${i}`});return(0,l.logDebug)("UniversalProvider request >>requestParam>>>: ",JSON.stringify(o)),(0,l.logDebug)("UniversalProvider request >>namespace>>>: ",n,this.getProvider(n)),yield this.getProvider(n).request(o)}))}enable(){return i(this,void 0,void 0,(function*(){if(!this.client)throw new l.OKXConnectError(l.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"Sign Client not initialized");if(!this.session){if(!this.connectOpts)throw new l.OKXConnectError(l.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"Sign Client not initialized");yield this.connect(this.connectOpts)}const e=yield this.requestAccounts();return e}))}disconnect(){return i(this,void 0,void 0,(function*(){if(!this.session)throw new l.OKXConnectError(l.OKX_CONNECT_ERROR_CODES.NOT_CONNECTED_ERROR);return new Promise((e=>i(this,void 0,void 0,(function*(){let t=!1;const n=()=>{t||(t=!0,this.cleanup().then(e),this.client.engine.connectionManager.disconnect())};try{yield this.client.disconnect(),n()}catch(i){t||this.cleanup().then(e)}finally{n()}}))))}))}connect(e){return i(this,void 0,void 0,(function*(){if(!this.client)throw new l.OKXConnectError(l.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"Sign Client not initialized");void 0===e.sessionConfig&&(e.sessionConfig={}),void 0===e.sessionConfig.openUniversalUrl&&(e.sessionConfig.openUniversalUrl=!0),this.setNamespaces(e);let t=yield this.client.connect(e);if((0,l.logDebug)(`UniversalProvider connect success ====> ${JSON.stringify(t)}`),t)return this.session=t,this.onConnect(),t}))}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}setDefaultChain(e,t){try{if(!this.session)return;const[n,i]=this.validateChain(e),s=this.getProvider(n);s.setDefaultChain(i,t)}catch(n){if(!/Please call connect/.test(n.message))throw n}}checkStorage(){return i(this,void 0,void 0,(function*(){let e=yield this.getFromStore("connectSession");if((0,l.logDebug)(e),e){let t=e;this.session=t,this.client.session=this.session,this.sessionConfig=t.sessionConfig,this.client.sessionConfig=this.sessionConfig,(0,l.logDebug)("[evm u-provider] do reconnection",this.session),yield this.client.restoreconnect(t),this.createProviders(),setTimeout((()=>{this.events.emit("reconnect",{session:this.session})}),100)}}))}initialize(){return i(this,void 0,void 0,(function*(){const e=Object.assign({url:window.location.hostname},this.providerOpts.dappMetaData);this.client=new d.SignClient(e),yield this.checkStorage(),this.registerEventListeners()}))}createProviders(){if(!this.client)throw new l.OKXConnectError(l.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"Sign Client not initialized");if(!this.session)throw new l.OKXConnectError(l.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map((e=>(0,h.parseNamespaceKey)(e))))];(0,o.setGlobal)("client",this.client),(0,o.setGlobal)("events",this.events),e.forEach((e=>{if(!this.session)return;const t=this.session.namespaces,n=t[e];switch((0,l.logDebug)("init eip155 >> ",n),e){case"eip155":const t={namespace:n};this.rpcProviders[e]=new r.default(t);break;case"sol":break;case"ton":break}}))}registerEventListeners(){if("undefined"===typeof this.client)throw new l.OKXConnectError(l.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,"Sign Client is not initialized");this.client.engine.addDisconnectListener((()=>{this.cleanup(),this.client.engine.connectionManager.disconnect(),this.events.emit("disconnect")})),this.on(a.PROVIDER_EVENTS.DEFAULT_CHAIN_CHANGED,(e=>{this.onChainChanged(e)})),this.on(a.PROVIDER_EVENTS.UPDATE_NAMESPACES,(e=>{if(e){const t=Object.keys(e)[0];this.session&&(this.session.namespaces[t]=e[t],this.session&&this.persist("connectSession",this.session),(0,l.logDebug)("PROVIDER_EVENTS.UPDATE_NAMESPACES this.session ->>>",JSON.stringify(this.session)))}}))}getProvider(e){return(0,l.logDebug)("current get providers",this.rpcProviders),(0,l.logDebug)("query namespace: ",e),this.rpcProviders[e]}setNamespaces(e){this.connectOpts=e;const{namespaces:t,sessionConfig:n}=e,i={url:window.location.hostname,name:this.providerOpts.dappMetaData.name,icon:this.providerOpts.dappMetaData.icon};this.sessionConfig={dappInfo:i,openUniversalUrl:null===n||void 0===n?void 0:n.openUniversalUrl,redirect:null===n||void 0===n?void 0:n.redirect},(0,l.logDebug)("setNamespaces sessionConfig>>>",this.sessionConfig),this.client.sessionConfig=this.sessionConfig,this.persist("sessionConfig",n)}validateChain(e){var t;let[n,i]=(null===e||void 0===e?void 0:e.split(":"))||["",""];if(!this.session||!this.session.namespaces||!Object.keys(this.session.namespaces).length)return(0,l.logDebug)("get name & chain",n,i),[n,i];if(n){if(!Object.keys(this.session.namespaces||{}).map((e=>(0,h.parseNamespaceKey)(e))).includes(n))throw new l.OKXConnectError(l.OKX_CONNECT_ERROR_CODES.NOT_CONNECTED_ERROR,`Namespace '${n}' is not configured. Please call connect() first with namespace config.`);if(i&&e){(0,l.logDebug)("this.session.namespaces --\x3e> ",n,JSON.stringify(this.session.namespaces));const i=null===(t=this.session.namespaces[n])||void 0===t?void 0:t.chains;if((0,l.logDebug)("get chainsArr & chain",JSON.stringify(i),e),i&&!i.includes(e))throw new l.OKXConnectError(l.OKX_CONNECT_ERROR_CODES.NOT_CONNECTED_ERROR,`Namespace not include the chain '${e}'`)}}if(n&&i)return(0,l.logDebug)("get name & chain",n,i),[n,i];let s=(0,h.parseNamespaceKey)(Object.keys(this.session.namespaces)[0]);const o=this.rpcProviders[s].getDefaultChain();return(0,l.logDebug)("get default chain:",o),[s,o]}requestAccounts(){return i(this,void 0,void 0,(function*(){const[e]=this.validateChain();return yield this.getProvider(e).requestAccounts()}))}onChainChanged(e){var t;if(!(null===(t=this.session)||void 0===t?void 0:t.namespaces))return;const[n,i]=this.validateChain(e);i&&(this.session.namespaces[n]&&(this.session.namespaces[n].defaultChain=i,this.persist("connectSession",this.session)),this.events.emit("chainChanged",i))}onConnect(){this.createProviders(),this.session&&this.persist("connectSession",this.session),this.events.emit("connect",{session:this.session})}cleanup(){return i(this,void 0,void 0,(function*(){this.session=void 0,this.sessionProperties=void 0,this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),this.persist("connectSession",void 0)}))}persist(e,t){return(0,l.logDebug)("[evm u-provider] persisit data",e,t),this.client.engine.connectionManager.saveSessionContent(e,t)}getFromStore(e){return i(this,void 0,void 0,(function*(){return this.client.engine.connectionManager.getSessionContent(e)}))}}t.OKXUniversalProvider=u,t["default"]=u},3885:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,s)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),s=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.OKXUniversalProvider=void 0,s(n(3077),t);var o=n(8871);Object.defineProperty(t,"OKXUniversalProvider",{enumerable:!0,get:function(){return o.OKXUniversalProvider}})},2776:function(e,t,n){"use strict";n(4114);var i=this&&this.__awaiter||function(e,t,n,i){function s(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function r(e){try{c(i.next(e))}catch(t){o(t)}}function a(e){try{c(i["throw"](e))}catch(t){o(t)}}function c(e){e.done?n(e.value):s(e.value).then(r,a)}c((i=i.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SignClient=void 0;const o=s(n(1571)),r=n(897),a=n(3669);class c extends r.ISignClient{constructor(e){super(e),this.events=new o.default,this.engine=new r.Engine(new r.ConnectionManager),this.connect=e=>i(this,void 0,void 0,(function*(){return new Promise(((t,n)=>{var i=[],s={name:"requestAccounts",requiredNamespaces:(0,a.nameSpaceToConnectWalletNameSpace)(e.namespaces),optionalNamespaces:(0,a.nameSpaceToConnectWalletNameSpace)(e.optionalNamespaces)};i.push(s);try{this.engine.conect(i,Object.assign({dappInfo:this.metadata},e.sessionConfig),(n=>{n&&(0,a.fillParamsToSession)(n,e.namespaces,e.optionalNamespaces,this.sessionConfig),t(n)}))}catch(o){n(o)}}))})),this.restoreconnect=e=>i(this,void 0,void 0,(function*(){return new Promise(((t,n)=>{this.engine.restoreconnect(e,(e=>{t(e)}))}))})),this.reject=e=>i(this,void 0,void 0,(function*(){})),this.request=e=>i(this,void 0,void 0,(function*(){var t;return(0,r.logDebug)("clint request --params>>>> >",null===(t=this.sessionConfig)||void 0===t?void 0:t.openUniversalUrl,JSON.stringify(e)),new Promise(((t,n)=>i(this,void 0,void 0,(function*(){var i;try{(null===(i=this.sessionConfig)||void 0===i?void 0:i.openUniversalUrl)&&(0,r.isIos)()&&this.openOKXWallet(),yield this.engine.send(e,{resolve:e=>{if(delete e.requestId,(0,r.logDebug)("clint request --response >",JSON.stringify(e)),"error"in e&&e.error){let t=e.error;t.message=e.method+":"+t.message,n(t)}else t(e)},onAck:()=>{var e;!(0,r.isIos)()&&(null===(e=this.sessionConfig)||void 0===e?void 0:e.openUniversalUrl)&&this.openOKXWallet()}})}catch(s){n(s)}}))))})),this.disconnect=()=>i(this,void 0,void 0,(function*(){try{return new Promise((e=>{this.engine.send({method:"disconnect"},{onAck:()=>{e()}})}))}catch(e){throw e}})),this.metadata=e}on(e,t){return this.events.on(e,t),this}openOKXWallet(){(0,r.logDebug)("bridge-provider ==>> connect_5")}}t.SignClient=c},3669:function(e,t,n){"use strict";n(4114),Object.defineProperty(t,"__esModule",{value:!0}),t.getAccountsChains=s,t.nameSpaceToConnectWalletNameSpace=o,t.fillParamsToSession=r,t.isCaipNamespace=a,t.parseNamespaceKey=c;const i=n(897);function s(e){const t=[];return e.forEach((e=>{const[n,i]=e.split(":");t.push(`${n}:${i}`)})),t}function o(e){var t=[];return e?(Object.keys(e).forEach((n=>{n!==i.NameSpaceKeyEip155&&n!==i.NameSpaceKeySOL||e[n].chains&&t.push({namespace:n,chains:e[n].chains})})),t):t}function r(e,t,n,i){const s=(e,t)=>{Object.assign(e,t)},o=(e,t)=>{for(const n in t)t.hasOwnProperty(n)&&t[n].rpcMap&&(t[n].rpcMap&&(e[n].rpcMap||(e[n].rpcMap={}),s(e[n].rpcMap,t[n].rpcMap)),t[n].defaultChain&&void 0===e[n].defaultChain&&e[n].chains.some((e=>e.split(":")[1]===t[n].defaultChain))&&(e[n].defaultChain=t[n].defaultChain))};t&&o(e.namespaces,t),n&&o(e.namespaces,n),e.sessionConfig=i}function a(e){return e.includes(":")}function c(e){return a(e)?e.split(":")[0]:e}},3548:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PROVIDER_EVENTS=void 0,t.PROVIDER_EVENTS={DEFAULT_CHAIN_CHANGED:"default_chain_changed",UPDATE_NAMESPACES:"update_name_spaces"}},4417:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,s)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),s=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),s(n(9399),t),s(n(3548),t)},9399:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GENERIC_SUBPROVIDER_NAME=t.RPC_URL=t.STORAGE=t.CONTEXT=t.WC_VERSION=t.PROTOCOL=t.RELAY_URL=t.LOGGER=void 0,t.LOGGER="error",t.RELAY_URL="wss://relay.walletconnect.com",t.PROTOCOL="wc",t.WC_VERSION=2,t.CONTEXT="universal_provider",t.STORAGE=`${t.PROTOCOL}@${t.WC_VERSION}:${t.CONTEXT}:`,t.RPC_URL="https://rpc.walletconnect.com/v1/",t.GENERIC_SUBPROVIDER_NAME="generic"},8403:function(e,t,n){"use strict";n(4114),n(7642),n(8004),n(3853),n(5876),n(2475),n(5024),n(1698);var i=this&&this.__awaiter||function(e,t,n,i){function s(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function r(e){try{c(i.next(e))}catch(t){o(t)}}function a(e){try{c(i["throw"](e))}catch(t){o(t)}}function c(e){e.done?n(e.value):s(e.value).then(r,a)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=n(169),o=n(4417),r=n(897),a=n(9142),c=n(935);class d{constructor(e){this.name="eip155",this.namespace=e.namespace,this.events=(0,s.getGlobal)("events"),this.client=(0,s.getGlobal)("client"),this.chainId=parseInt(this.getDefaultChain()),this.httpProviders=this.createHttpProviders(),(0,r.logDebug)("eip155 constructor --opts.namespace--\x3e",e.namespace)}isRecord(e){return"object"===typeof e&&null!==e&&!Array.isArray(e)}isArray(e){return"object"===typeof e&&null!==e&&Array.isArray(e)}updateRequestParams(e){let t=e.params&&"object"===typeof e.params&&!Array.isArray(e.params);if("wallet_switchEthereumChain"===e.method){const n=e.chainId.split(":")[1],i=parseInt(n,10);if(isNaN(i))throw new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.NOT_CONNECTED_ERROR,`Invalid decimal number,  chainId: '${n}' `);if(e.params){if(!t)throw new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.NOT_CONNECTED_ERROR,`Request params error ,  method: '${e.method}' `);{let t=e.params;"chainId"in t||(t["chainId"]="0x"+i.toString(16),e.params=t)}}else e.params={chainId:"0x"+i.toString(16)}}else if("personal_sign"===e.method||"eth_signTypedData_v4"===e.method||"eth_sendTransaction"===e.method||"wallet_watchAsset"===e.method){if(!e.params)throw new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.NOT_CONNECTED_ERROR,`Request params is nil, method: '${e.method}'`);if(!this.isRecord(e.params))throw new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.NOT_CONNECTED_ERROR,`Invalid request params type, method: '${e.method}'`);{let t=e.params;if((0,r.logDebug)("eip155 updateRequestParams params>",JSON.stringify(t)),"chainId"in t){const n=e.chainId.split(":")[1],i=parseInt(n,10);let s,o=String(t.chainId);if(o.startsWith(this.name)&&e.chainId===o)s=i;else if(o.startsWith("0x"))s=parseInt(o,16);else{if(isNaN(Number(o)))throw new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.NOT_CONNECTED_ERROR,`Invalid params.chainId format, method: '${e.method}'`);s=parseInt(o,10)}if(i!==s)throw new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.NOT_CONNECTED_ERROR,`Request params.chainId not equal chain,  method: '${e.method}' `)}}}}adaptArray(e){if("wallet_switchEthereumChain"===e.method||"wallet_addEthereumChain"===e.method||"wallet_watchAsset"===e.method||"eth_sendTransaction"===e.method){if(this.isArray(e.params)){let t=e.params;if(t){if(1!==t.length)throw t.length>1?new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`Request params only Support one data,  method: '${e.method}' `):new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`Request params is nil,  method: '${e.method}' `);{let t=e.params[0];this.isRecord(t)&&(e.params=t)}}}}else if("eth_signTypedData_v4"===e.method){if(this.isArray(e.params)){let n=e.params;if(n&&n.length>2)throw new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`Request params only Support one data,  method: '${e.method}' `);if(n&&0===n.length)throw new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`Request params is nil,  method: '${e.method}' `);let i={};if(n&&2===n.length){let t=e.params[0];if(!t||"string"!==typeof t)throw new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`Request params address error , not string,  method: '${e.method}' `);{let n=!1;if(this.namespace.chains.forEach((e=>{let i=e.split(":")[2];i===t&&(n=!0)})),!n)throw new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`Request params address error, not equal,  method: '${e.method}' `);if(!this.isRecord(e.params[1]))throw new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`Request params message data error,  method: '${e.method}' `);i=e.params[1]}}else if(n&&1===n.length){if(!this.isRecord(e.params[0]))throw new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`Request params message data error,  method: '${e.method}' `);i=e.params[0]}try{let t=JSON.stringify(i);e.params={typedDataJson:t}}catch(t){throw new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`Request params call JSON.stringify() failed,  method: '${e.method}' `)}}}else if("personal_sign"===e.method&&this.isArray(e.params)){if(e.params&&e.params.length>2)throw new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`Request params error,  method: '${e.method}' `);if(e.params&&0===e.params.length)throw new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`Request params is nil,  method: '${e.method}' `);let t=e.params[0],n=e.params[1];if(n&&"string"===typeof n){let t=!1;if(this.namespace.chains.forEach((e=>{let i=e.split(":")[2];i===n&&(t=!0)})),!t)throw new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`Request params address error,  method: '${e.method}' `)}if(!t||"string"!==typeof t)throw new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`Request params is error,  method: '${e.method}' `);e.params={message:t}}}request(e){return i(this,void 0,void 0,(function*(){switch(this.adaptArray(e),(0,r.logDebug)("eip155 request --args--string>",JSON.stringify(e)),this.updateRequestParams(e),(0,r.logDebug)("eip155 request --params--string>",JSON.stringify(e)),e.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_switchEthereumChain":return yield this.handleSwitchChain(e);case"wallet_addEthereumChain":return this.addEthereumChain(e);default:break}return this.namespace.methods.includes(e.method)?yield this.client.request(e):((0,r.logDebug)("[RPC] request begin"),yield this.getHttpProvider().request(e))}))}addEthereumChain(e){return i(this,void 0,void 0,(function*(){let t=yield this.client.request(e);try{if("result"in t){let n=t.result;if(n){const t=n.split(":")[0],i=n.split(":")[1],s=t+":"+i;this.namespace;if(this.namespace.accounts.push(n),this.namespace.chains.push(s),this.isRecord(e.params)&&"rpcUrls"in e.params){let t=e.params.rpcUrls,n=t?t[0]:void 0;n&&(this.namespace.rpcMap?this.namespace.rpcMap[i]=n:this.namespace.rpcMap={[i]:n},this.setHttpProvider(i,n))}this.events.emit(o.PROVIDER_EVENTS.UPDATE_NAMESPACES,{eip155:this.namespace})}}else new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`the method ${e.method} request error`)}catch(n){throw new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`the method ${e.method} request  error`)}return t}))}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){if(this.chainId=parseInt(e),!this.httpProviders[e]){const n=t||(0,s.getRpcUrl)(`${this.name}:${e}`,this.namespace);n?this.setHttpProvider(e,n):(0,r.logError)(`No RPC url provided for chainId: ${e}`)}this.events.emit(o.PROVIDER_EVENTS.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return(0,r.logDebug)("eip155 getAccounts ",e,this.chainId),e?[...new Set(e.filter((e=>e.split(":")[1]===this.chainId.toString())).map((e=>e.split(":")[2])))]:[]}handleSwitchChain(e){return i(this,void 0,void 0,(function*(){let t=e.params,n="0x0";t&&"chainId"in t&&(n=t.chainId),n=n.startsWith("0x")?n:`0x${n}`,(0,r.logDebug)("handleSwitchChain --\x3eargs ",e),(0,r.logDebug)("handleSwitchChain --\x3ehexChainId ",n);const i=parseInt(n,16);if((0,r.logDebug)("handleSwitchChain --\x3eparsedChainId ",i),this.isChainApproved(i))return this.setDefaultChain(`${i}`),{method:"wallet_switchEthereumChain",result:`${this.name}:${i}`};{const t=yield this.client.request({method:"wallet_switchEthereumChain",chainId:e.chainId,params:{chainId:n}});try{if("result"in t){let e=t.result;if(e){const n=e.split(":")[0],s=e.split(":")[1],a=n+":"+s;this.namespace;return this.namespace.accounts.push(e),this.namespace.chains.push(a),(0,r.logDebug)("handleSwitchChain --\x3ewallet_switchEthereumChain ",t),this.setDefaultChain(`${i}`),this.events.emit(o.PROVIDER_EVENTS.UPDATE_NAMESPACES,{eip155:this.namespace}),{method:"wallet_switchEthereumChain",result:`${this.name}:${s}`}}}else new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`the method ${e.method} request error`)}catch(s){throw new r.OKXConnectError(r.OKX_CONNECT_ERROR_CODES.UNKNOWN_ERROR,`the method ${e.method} request  error`)}return t}}))}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}createHttpProvider(e,t){const n=t;if(n){const e=new a.JsonRpcProvider(new c.JsonRpcConnection(n,(0,s.getGlobal)("disableProviderPing")));return e}(0,r.logError)(`No RPC url provided for chainId: ${e}`)}createHttpProviders(){const e={};return this.namespace.chains.forEach((t=>{const n=(0,s.getChainId)(t),i=(0,s.getRpcUrl)(t,this.namespace);(0,r.logDebug)("get parsed chain and rpc:",n,i);let o=this.createHttpProvider(n,i);o&&(e[n]=o)})),(0,r.logDebug)("get http providermap:",e),e}setHttpProvider(e,t){const n=this.createHttpProvider(e,t);n&&(this.httpProviders[e]=n)}getHttpProvider(){const e=`${this.chainId}`,t=this.httpProviders[e];if((0,r.logDebug)("[RPC] get http provider:",e,t),"undefined"===typeof t)throw new Error(`JSON-RPC provider for ${e} not found`);return t}}t["default"]=d},935:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){function s(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function r(e){try{c(i.next(e))}catch(t){o(t)}}function a(e){try{c(i["throw"](e))}catch(t){o(t)}}function c(e){e.done?n(e.value):s(e.value).then(r,a)}c((i=i.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.JsonRpcConnection=void 0;const o=n(1571),r=s(n(4830)),a=n(897),c=n(897),d={Accept:"application/json","Content-Type":"application/json"},l="POST",h={headers:d,method:l};class u{constructor(e,t=!1){if(this.url=e,this.disableProviderPing=t,this.events=new o.EventEmitter,this.isAvailable=!1,this.registering=!1,!(0,c.isHttpUrl)(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e,this.disableProviderPing=t}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}open(){return i(this,arguments,void 0,(function*(e=this.url){yield this.register(e)}))}close(){return i(this,void 0,void 0,(function*(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}))}send(e){return i(this,void 0,void 0,(function*(){this.isAvailable||(yield this.register());try{const t=(0,a.safeJsonStringify)(e),n=yield(0,r.default)(this.url,Object.assign(Object.assign({},h),{body:t})),i=yield n.json();this.onPayload({data:i})}catch(t){this.onError(e.id,t)}}))}register(){return i(this,arguments,void 0,(function*(e=this.url){if(!(0,c.isHttpUrl)(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering)return new Promise(((e,t)=>{this.events.once("register_error",(e=>{t(e)})),this.events.once("open",(()=>{if("undefined"===typeof this.isAvailable)return t(new Error("HTTP connection is missing or invalid"));e()}))}));this.url=e,this.registering=!0;try{if(!this.disableProviderPing){const t=(0,a.safeJsonStringify)({id:1,jsonrpc:"2.0",method:"test",params:[]});yield(0,r.default)(e,Object.assign(Object.assign({},h),{body:t}))}this.onOpen()}catch(t){const e=this.parseError(t);throw this.events.emit("register_error",e),this.onClose(),e}}))}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if("undefined"===typeof e.data)return;const t="string"===typeof e.data?(0,a.safeJsonParse)(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const n=this.parseError(t),i=n.message||n.toString(),s=(0,c.formatJsonRpcError)(e,i);this.events.emit("payload",s)}parseError(e,t=this.url){return(0,c.parseConnectionError)(e,t,"HTTP")}}t.JsonRpcConnection=u},9142:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){function s(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function r(e){try{c(i.next(e))}catch(t){o(t)}}function a(e){try{c(i["throw"](e))}catch(t){o(t)}}function c(e){e.done?n(e.value):s(e.value).then(r,a)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.JsonRpcProvider=void 0;const s=n(1571),o=n(3077),r=n(897),a=n(897);class c extends o.IJSONRpcProvider{constructor(e){super(e),this.events=new s.EventEmitter,this.connected=!1,this.connecting=!1,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}connect(){return i(this,arguments,void 0,(function*(e=this.connection){yield this.open(e)}))}disconnect(){return i(this,void 0,void 0,(function*(){yield this.close()}))}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}request(e,t){return i(this,void 0,void 0,(function*(){return this.requestStrict((0,r.formatJsonRpcRequest)(e.method,e.params||[],(0,r.getBigIntRpcId)().toString()),t)}))}requestStrict(e,t){return i(this,void 0,void 0,(function*(){return new Promise(((n,s)=>i(this,void 0,void 0,(function*(){if(!this.connection.connected)try{yield this.open()}catch(i){s(i)}this.events.on(`${e.id}`,(e=>{(0,r.isJsonRpcError)(e)?s(e.error):n(e.result)}));try{(0,a.logDebug)("[RPC] >>> send request",e,t),yield this.connection.send(e,t)}catch(i){s(i)}}))))}))}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),(0,r.isJsonRpcResponse)(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&3e3===e.code&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}open(){return i(this,arguments,void 0,(function*(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),"string"===typeof e&&(yield this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),yield this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}))}close(){return i(this,void 0,void 0,(function*(){yield this.connection.close()}))}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",(e=>this.onPayload(e))),this.connection.on("close",(e=>this.onClose(e))),this.connection.on("error",(e=>this.events.emit("error",e))),this.connection.on("register_error",(e=>this.onClose())),this.hasRegisteredEventListeners=!0)}}t.JsonRpcProvider=c},3077:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,s)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),s=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),s(n(3919),t),s(n(6097),t)},6097:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},3919:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IJSONRpcProvider=t.IJSONRpcConnection=void 0;class n{}t.IJSONRpcConnection=n;class i{constructor(e){}}t.IJSONRpcProvider=i},7501:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setGlobal=t.getGlobal=void 0;const n={},i=e=>n[e];t.getGlobal=i;const s=(e,t)=>{n[e]=t};t.setGlobal=s},169:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,s)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),s=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),s(n(2173),t),s(n(7501),t)},2173:function(e,t,n){"use strict";n(4114),n(7642),n(8004),n(3853),n(5876),n(2475),n(5024),n(1698);var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getRpcUrl=a,t.getChainId=c,t.validateChainApproval=d,t.getChainsFromApprovedSession=l,t.getAccountsFromSession=h,t.mergeRequiredOptionalNamespaces=u,t.normalizeNamespaces=f,t.parseCaip10Account=p,t.convertChainIdToNumber=g,t.parseChainId=v,t.mergeArrays=y;const s=n(897),o=n(3669),r=i(n(8626));function a(e,t,n){var i;const s=v(e);return(null===(i=t.rpcMap)||void 0===i?void 0:i[s.reference])||""}function c(e){return e.includes(":")?e.split(":")[1]:e}function d(e,t){if(!t.includes(e))throw new Error(`Chain '${e}' not approved. Please use one of the following: ${t.toString()}`)}function l(e){return e.map((e=>`${e.split(":")[0]}:${e.split(":")[1]}`))}function h(e,t){const n=Object.keys(t.namespaces).filter((t=>t.includes(e)));if(!n.length)return[];const i=[];return n.forEach((e=>{const n=t.namespaces[e].accounts;i.push(...n)})),i}function u(e={},t={}){const n=f(e),i=f(t);return r.default.merge(n,i)}function f(e){var t,n;const i={};if(!(0,s.isValidObject)(e))return i;for(const[s,r]of Object.entries(e)){const e=(0,o.isCaipNamespace)(s)?[s]:r.chains,a=r.rpcMap||{},c=(0,o.parseNamespaceKey)(s);i[c]=Object.assign(Object.assign(Object.assign({},i[c]),r),{chains:y(e,null===(t=i[c])||void 0===t?void 0:t.chains),rpcMap:Object.assign(Object.assign({},a),null===(n=i[c])||void 0===n?void 0:n.rpcMap)})}return i}function p(e){return e.includes(":")?e.split(":")[2]:e}function g(e){return"number"===typeof e?e:e.includes("0x")?parseInt(e,16):(e=e.includes(":")?e.split(":")[1]:e,isNaN(Number(e))?e:Number(e))}const m=":";function v(e){const[t,n]=e.split(m);return{namespace:t,reference:n}}function y(e=[],t=[]){return[...new Set([...e,...t])]}},1074:function(e,t,n){"use strict";var i=n(5130),s=n(6517),o=(n(4188),n(6768)),r=n(4232);const a={id:"app"};function c(e,t,n,i,s,c){const d=(0,o.g2)("el-header"),l=(0,o.g2)("el-col"),h=(0,o.g2)("el-row"),u=(0,o.g2)("el-card"),f=(0,o.g2)("el-checkbox"),p=(0,o.g2)("el-button"),g=(0,o.g2)("el-tab-pane"),m=(0,o.g2)("el-tabs"),v=(0,o.g2)("el-input"),y=(0,o.g2)("el-main"),b=(0,o.g2)("el-container");return(0,o.uX)(),(0,o.CE)("div",a,[(0,o.bF)(b,null,{default:(0,o.k6)((()=>[(0,o.bF)(d,null,{default:(0,o.k6)((()=>t[32]||(t[32]=[(0,o.eW)("OKX Connect Evm")]))),_:1}),(0,o.bF)(y,null,{default:(0,o.k6)((()=>[(0,o.bF)(u,{class:"wallet-info"},{header:(0,o.k6)((()=>t[33]||(t[33]=[(0,o.Lk)("div",null,"钱包信息",-1)]))),default:(0,o.k6)((()=>[(0,o.bF)(h,{class:"info-row"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24},{default:(0,o.k6)((()=>[t[34]||(t[34]=(0,o.Lk)("strong",null,"Wallet Address:",-1)),(0,o.eW)(" "+(0,r.v_)(c.getWalletAddress),1)])),_:1})])),_:1}),(0,o.bF)(h,{class:"info-row"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24},{default:(0,o.k6)((()=>[t[35]||(t[35]=(0,o.Lk)("strong",null,"当前状态 :",-1)),(0,o.eW)(" "+(0,r.v_)(e.currentStatus),1)])),_:1})])),_:1})])),_:1}),(0,o.bF)(u,{class:"wallet-actions"},{header:(0,o.k6)((()=>t[36]||(t[36]=[(0,o.Lk)("div",null,"钱包操作",-1)]))),default:(0,o.k6)((()=>[(0,o.bF)(h,{gutter:12,align:"middle"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:4},{default:(0,o.k6)((()=>t[37]||(t[37]=[(0,o.Lk)("div",null,"req",-1)]))),_:1}),(0,o.bF)(l,{span:5},{default:(0,o.k6)((()=>[(0,o.bF)(f,{checked:e.isChecked(1),onChange:t[0]||(t[0]=()=>e.handleChange(1))},{default:(0,o.k6)((()=>t[38]||(t[38]=[(0,o.eW)(" eth")]))),_:1},8,["checked"])])),_:1}),(0,o.bF)(l,{span:5},{default:(0,o.k6)((()=>[(0,o.bF)(f,{checked:e.isChecked(56),onChange:t[1]||(t[1]=()=>e.handleChange(56))},{default:(0,o.k6)((()=>t[39]||(t[39]=[(0,o.eW)(" BNB")]))),_:1},8,["checked"])])),_:1}),(0,o.bF)(l,{span:5},{default:(0,o.k6)((()=>[(0,o.bF)(f,{checked:e.isChecked(137),onChange:t[2]||(t[2]=()=>e.handleChange(137))},{default:(0,o.k6)((()=>t[40]||(t[40]=[(0,o.eW)("Polygon")]))),_:1},8,["checked"])])),_:1}),(0,o.bF)(l,{span:5},{default:(0,o.k6)((()=>[(0,o.bF)(f,{checked:e.isChecked(997865),onChange:t[3]||(t[3]=()=>e.handleChange(997865))},{default:(0,o.k6)((()=>t[41]||(t[41]=[(0,o.eW)("不存在的链")]))),_:1},8,["checked"])])),_:1})])),_:1}),(0,o.bF)(h,{gutter:12,align:"middle"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:4},{default:(0,o.k6)((()=>t[42]||(t[42]=[(0,o.Lk)("div",null,"opt",-1)]))),_:1}),(0,o.bF)(l,{span:5},{default:(0,o.k6)((()=>[(0,o.bF)(f,{checked:e.isOptionalChecked(43114),onChange:t[4]||(t[4]=()=>e.handleOptionChange(43114))},{default:(0,o.k6)((()=>t[43]||(t[43]=[(0,o.eW)(" avax")]))),_:1},8,["checked"])])),_:1}),(0,o.bF)(l,{span:5},{default:(0,o.k6)((()=>[(0,o.bF)(f,{checked:e.isOptionalChecked(10),onChange:t[5]||(t[5]=()=>e.handleOptionChange(10))},{default:(0,o.k6)((()=>t[44]||(t[44]=[(0,o.eW)("op")]))),_:1},8,["checked"])])),_:1}),(0,o.bF)(l,{span:5},{default:(0,o.k6)((()=>[(0,o.bF)(f,{checked:e.isOptionalChecked(8453),onChange:t[6]||(t[6]=()=>e.handleOptionChange(8453))},{default:(0,o.k6)((()=>t[45]||(t[45]=[(0,o.eW)(" BASE")]))),_:1},8,["checked"])])),_:1}),(0,o.bF)(l,{span:5},{default:(0,o.k6)((()=>[(0,o.bF)(f,{checked:e.isOptionalChecked(99781165),onChange:t[7]||(t[7]=()=>e.handleOptionChange(99781165))},{default:(0,o.k6)((()=>t[46]||(t[46]=[(0,o.eW)("不存在的链")]))),_:1},8,["checked"])])),_:1})])),_:1}),(0,o.bF)(h,{gutter:12,class:"button-row"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24},{default:(0,o.k6)((()=>[(0,o.bF)(p,{type:"primary",onClick:c.connectBtnClicked,icon:"el-icon-connection"},{default:(0,o.k6)((()=>[(0,o.eW)((0,r.v_)(e.connectStatusStr),1)])),_:1},8,["onClick"])])),_:1})])),_:1}),(0,o.bF)(h,{gutter:12,class:"button-row"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24},{default:(0,o.k6)((()=>[(0,o.bF)(p,{type:"danger",onClick:c.disconnectAction,icon:"el-icon-switch-button",disabled:0==e.walletAddress.length},{default:(0,o.k6)((()=>[(0,o.eW)((0,r.v_)(e.disconnectStatusStr),1)])),_:1},8,["onClick","disabled"])])),_:1})])),_:1})])),_:1}),(0,o.bF)(u,{class:"wallet-actions"},{header:(0,o.k6)((()=>t[47]||(t[47]=[(0,o.Lk)("div",null,"交易",-1)]))),default:(0,o.k6)((()=>[(0,o.bF)(m,{modelValue:e.activeTab,"onUpdate:modelValue":t[28]||(t[28]=t=>e.activeTab=t),type:"border-card",onTabClick:c.clickActiveTab},{default:(0,o.k6)((()=>[(0,o.bF)(g,{label:"ETH交易",name:"eip155:1"},{default:(0,o.k6)((()=>[(0,o.bF)(h,{gutter:12,class:"button-row"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24},{default:(0,o.k6)((()=>[(0,o.bF)(p,{type:"primary",onClick:c.eth_requestAccounts},{default:(0,o.k6)((()=>t[48]||(t[48]=[(0,o.eW)("eth_requestAccounts(ETH)")]))),_:1},8,["onClick"])])),_:1})])),_:1}),(0,o.bF)(h,{gutter:12,class:"button-row"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24},{default:(0,o.k6)((()=>[(0,o.bF)(p,{type:"primary",onClick:t[8]||(t[8]=e=>c.eth_chainId())},{default:(0,o.k6)((()=>t[49]||(t[49]=[(0,o.eW)("eth_chainId(ETH)")]))),_:1})])),_:1})])),_:1}),(0,o.bF)(h,{gutter:12,class:"button-row"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24},{default:(0,o.k6)((()=>[(0,o.bF)(p,{type:"primary",onClick:t[9]||(t[9]=e=>c.wallet_switchEthereumChain())},{default:(0,o.k6)((()=>t[50]||(t[50]=[(0,o.eW)("wallet_switchEthereumChain(切换到ETH)")]))),_:1})])),_:1})])),_:1}),(0,o.bF)(h,{gutter:12,class:"button-row"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24},{default:(0,o.k6)((()=>[(0,o.bF)(p,{type:"primary",onClick:t[10]||(t[10]=e=>c.wallet_addEthereumChain())},{default:(0,o.k6)((()=>t[51]||(t[51]=[(0,o.eW)("wallet_addEthereumChain")]))),_:1})])),_:1})])),_:1}),(0,o.bF)(h,{gutter:12,class:"button-row"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24},{default:(0,o.k6)((()=>[(0,o.bF)(p,{type:"primary",onClick:t[11]||(t[11]=e=>c.personal_sign())},{default:(0,o.k6)((()=>t[52]||(t[52]=[(0,o.eW)("personal_sign")]))),_:1})])),_:1})])),_:1}),(0,o.bF)(h,{gutter:12,class:"button-row"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24},{default:(0,o.k6)((()=>[(0,o.bF)(p,{type:"primary",onClick:t[12]||(t[12]=e=>c.eth_signTypedData_v4())},{default:(0,o.k6)((()=>t[53]||(t[53]=[(0,o.eW)("eth_signTypedData_v4")]))),_:1})])),_:1})])),_:1}),(0,o.bF)(h,{gutter:12,class:"button-row"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24},{default:(0,o.k6)((()=>[(0,o.bF)(p,{type:"primary",onClick:c.eth_sendTransaction_transfer},{default:(0,o.k6)((()=>t[54]||(t[54]=[(0,o.eW)("eth_sendTransaction(转账ETH)")]))),_:1},8,["onClick"])])),_:1})])),_:1}),(0,o.bF)(h,{gutter:12,class:"button-row"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24},{default:(0,o.k6)((()=>[(0,o.bF)(p,{type:"primary",onClick:c.eth_sendTransaction_approve},{default:(0,o.k6)((()=>t[55]||(t[55]=[(0,o.eW)("eth_sendTransaction(币种授权TONCoin)")]))),_:1},8,["onClick"])])),_:1})])),_:1}),(0,o.bF)(h,{gutter:12,class:"button-row"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24},{default:(0,o.k6)((()=>[(0,o.bF)(p,{type:"primary",onClick:c.eth_sendTransaction_mint},{default:(0,o.k6)((()=>t[56]||(t[56]=[(0,o.eW)("eth_sendTransaction(eth mint nft)")]))),_:1},8,["onClick"])])),_:1})])),_:1}),(0,o.bF)(h,{gutter:12,class:"button-row"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24},{default:(0,o.k6)((()=>[(0,o.bF)(p,{type:"primary",onClick:t[13]||(t[13]=e=>c.wallet_watchAsset())},{default:(0,o.k6)((()=>t[57]||(t[57]=[(0,o.eW)("wallet_watchAsset(添加代币SPX6900) ")]))),_:1})])),_:1})])),_:1})])),_:1}),(0,o.bF)(g,{label:"Polygon交易",name:"eip155:137"},{default:(0,o.k6)((()=>[(0,o.bF)(h,{gutter:12,class:"button-row"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24},{default:(0,o.k6)((()=>[(0,o.bF)(p,{type:"primary",onClick:c.eth_requestAccounts},{default:(0,o.k6)((()=>t[58]||(t[58]=[(0,o.eW)("eth_requestAccounts")]))),_:1},8,["onClick"])])),_:1})])),_:1}),(0,o.bF)(h,{gutter:12,class:"button-row"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24},{default:(0,o.k6)((()=>[(0,o.bF)(p,{type:"primary",onClick:t[14]||(t[14]=e=>c.eth_chainId())},{default:(0,o.k6)((()=>t[59]||(t[59]=[(0,o.eW)("eth_chainId")]))),_:1})])),_:1})])),_:1}),(0,o.bF)(h,{gutter:12,class:"button-row"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24},{default:(0,o.k6)((()=>[(0,o.bF)(p,{type:"primary",onClick:t[15]||(t[15]=e=>c.wallet_switchEthereumChain())},{default:(0,o.k6)((()=>t[60]||(t[60]=[(0,o.eW)("wallet_switchEthereumChain")]))),_:1})])),_:1})])),_:1}),(0,o.bF)(h,{gutter:12,class:"button-row"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24},{default:(0,o.k6)((()=>[(0,o.bF)(p,{type:"primary",onClick:t[16]||(t[16]=e=>c.wallet_addEthereumChain())},{default:(0,o.k6)((()=>t[61]||(t[61]=[(0,o.eW)("wallet_addEthereumChain")]))),_:1})])),_:1})])),_:1}),(0,o.bF)(h,{gutter:12,class:"button-row"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24},{default:(0,o.k6)((()=>[(0,o.bF)(p,{type:"primary",onClick:t[17]||(t[17]=e=>c.personal_sign())},{default:(0,o.k6)((()=>t[62]||(t[62]=[(0,o.eW)("personal_sign")]))),_:1})])),_:1})])),_:1}),(0,o.bF)(h,{gutter:12,class:"button-row"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24},{default:(0,o.k6)((()=>[(0,o.bF)(p,{type:"primary",onClick:t[18]||(t[18]=e=>c.eth_signTypedData_v4())},{default:(0,o.k6)((()=>t[63]||(t[63]=[(0,o.eW)("eth_signTypedData_v4")]))),_:1})])),_:1})])),_:1}),(0,o.bF)(h,{gutter:12,class:"button-row"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24},{default:(0,o.k6)((()=>[(0,o.bF)(p,{type:"primary",onClick:c.eth_sendTransaction_transfer},{default:(0,o.k6)((()=>t[64]||(t[64]=[(0,o.eW)("eth_sendTransaction(转账POL)")]))),_:1},8,["onClick"])])),_:1})])),_:1}),(0,o.bF)(h,{gutter:12,class:"button-row"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24},{default:(0,o.k6)((()=>[(0,o.bF)(p,{type:"primary",onClick:c.eth_sendTransaction_approve},{default:(0,o.k6)((()=>t[65]||(t[65]=[(0,o.eW)("eth_sendTransaction(sushi 币种授权)")]))),_:1},8,["onClick"])])),_:1})])),_:1}),(0,o.bF)(h,{gutter:12,class:"button-row"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24},{default:(0,o.k6)((()=>[(0,o.bF)(p,{type:"primary",onClick:c.eth_sendTransaction_mint},{default:(0,o.k6)((()=>t[66]||(t[66]=[(0,o.eW)("eth_sendTransaction(polygon mint nft)")]))),_:1},8,["onClick"])])),_:1})])),_:1}),(0,o.bF)(h,{gutter:12,class:"button-row"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24},{default:(0,o.k6)((()=>[(0,o.bF)(p,{type:"primary",onClick:t[19]||(t[19]=e=>c.wallet_watchAsset())},{default:(0,o.k6)((()=>t[67]||(t[67]=[(0,o.eW)("wallet_watchAsset(添加代币LGNS) ")]))),_:1})])),_:1})])),_:1}),(0,o.bF)(h,{gutter:12,class:"button-row"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24},{default:(0,o.k6)((()=>[(0,o.bF)(p,{type:"primary",onClick:t[20]||(t[20]=e=>c.wallet_testRpc())},{default:(0,o.k6)((()=>t[68]||(t[68]=[(0,o.eW)("wallet_testRpc(Polygon)")]))),_:1})])),_:1})])),_:1})])),_:1}),(0,o.bF)(g,{label:"BNB交易",name:"eip155:56"},{default:(0,o.k6)((()=>[(0,o.bF)(h,{gutter:12,class:"button-row"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24},{default:(0,o.k6)((()=>[(0,o.bF)(p,{type:"primary",onClick:c.eth_requestAccounts},{default:(0,o.k6)((()=>t[69]||(t[69]=[(0,o.eW)("eth_requestAccounts(BNB)")]))),_:1},8,["onClick"])])),_:1})])),_:1}),(0,o.bF)(h,{gutter:12,class:"button-row"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24},{default:(0,o.k6)((()=>[(0,o.bF)(p,{type:"primary",onClick:t[21]||(t[21]=e=>c.eth_chainId())},{default:(0,o.k6)((()=>t[70]||(t[70]=[(0,o.eW)("eth_chainId(BNB)")]))),_:1})])),_:1})])),_:1}),(0,o.bF)(h,{gutter:12,class:"button-row"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24},{default:(0,o.k6)((()=>[(0,o.bF)(p,{type:"primary",onClick:t[22]||(t[22]=e=>c.wallet_switchEthereumChain())},{default:(0,o.k6)((()=>t[71]||(t[71]=[(0,o.eW)("wallet_switchEthereumChain(切换到BNB)")]))),_:1})])),_:1})])),_:1}),(0,o.bF)(h,{gutter:12,class:"button-row"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24},{default:(0,o.k6)((()=>[(0,o.bF)(p,{type:"primary",onClick:t[23]||(t[23]=e=>c.wallet_addEthereumChain())},{default:(0,o.k6)((()=>t[72]||(t[72]=[(0,o.eW)("wallet_addEthereumChain")]))),_:1})])),_:1})])),_:1}),(0,o.bF)(h,{gutter:12,class:"button-row"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24},{default:(0,o.k6)((()=>[(0,o.bF)(p,{type:"primary",onClick:t[24]||(t[24]=e=>c.personal_sign())},{default:(0,o.k6)((()=>t[73]||(t[73]=[(0,o.eW)("personal_sign")]))),_:1})])),_:1})])),_:1}),(0,o.bF)(h,{gutter:12,class:"button-row"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24},{default:(0,o.k6)((()=>[(0,o.bF)(p,{type:"primary",onClick:t[25]||(t[25]=e=>c.eth_signTypedData_v4())},{default:(0,o.k6)((()=>t[74]||(t[74]=[(0,o.eW)("eth_signTypedData_v4")]))),_:1})])),_:1})])),_:1}),(0,o.bF)(h,{gutter:12,class:"button-row"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24},{default:(0,o.k6)((()=>[(0,o.bF)(p,{type:"primary",onClick:c.eth_sendTransaction_transfer},{default:(0,o.k6)((()=>t[75]||(t[75]=[(0,o.eW)("eth_sendTransaction(转账BNB)")]))),_:1},8,["onClick"])])),_:1})])),_:1}),(0,o.bF)(h,{gutter:12,class:"button-row"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24},{default:(0,o.k6)((()=>[(0,o.bF)(p,{type:"primary",onClick:c.eth_sendTransaction_approve},{default:(0,o.k6)((()=>t[76]||(t[76]=[(0,o.eW)("eth_sendTransaction(币种授权POSI)")]))),_:1},8,["onClick"])])),_:1})])),_:1}),(0,o.bF)(h,{gutter:12,class:"button-row"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24},{default:(0,o.k6)((()=>[(0,o.bF)(p,{type:"primary",onClick:t[26]||(t[26]=e=>c.wallet_watchAsset())},{default:(0,o.k6)((()=>t[77]||(t[77]=[(0,o.eW)("wallet_watchAsset(添加代币FET) ")]))),_:1})])),_:1})])),_:1}),(0,o.bF)(h,{gutter:12,class:"button-row"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24},{default:(0,o.k6)((()=>[(0,o.bF)(p,{type:"primary",onClick:t[27]||(t[27]=e=>c.wallet_testRpc())},{default:(0,o.k6)((()=>t[78]||(t[78]=[(0,o.eW)("wallet_testRpc(check balance on eth)")]))),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue","onTabClick"]),(0,o.bF)(l,{xs:24,sm:12},{default:(0,o.k6)((()=>[t[79]||(t[79]=(0,o.Lk)("div",{class:"input-label"},"交易数据:",-1)),(0,o.bF)(v,{modelValue:e.testTransaction,"onUpdate:modelValue":t[29]||(t[29]=t=>e.testTransaction=t),type:"textarea",rows:5,placeholder:"sendTransactions"},null,8,["modelValue"])])),_:1}),(0,o.bF)(l,{xs:24,sm:12},{default:(0,o.k6)((()=>[t[80]||(t[80]=(0,o.Lk)("div",{class:"input-label"},"签名结果 :",-1)),(0,o.bF)(v,{modelValue:e.testboc,"onUpdate:modelValue":t[30]||(t[30]=t=>e.testboc=t),type:"textarea",rows:5,placeholder:"boc"},null,8,["modelValue"])])),_:1}),(0,o.bF)(h,{gutter:12,class:"button-row"},{default:(0,o.k6)((()=>[(0,o.bF)(l,{span:24},{default:(0,o.k6)((()=>[(0,o.bF)(p,{type:"primary",onClick:t[31]||(t[31]=e=>c.sendTransaction())},{default:(0,o.k6)((()=>[(0,o.eW)((0,r.v_)(e.testTransactionStr),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])}n(4114),n(7642),n(8004),n(3853),n(5876),n(2475),n(5024),n(1698);var d=n(897),l=n(3885),h=n(4413),u=n.n(h);new(u());var f=new Set([1]),p=new Set([]),g={name:"App",data:()=>({activeTab:"eip155:1",testTopic:"",testPublicKey:"",testProofPayload:"",pendingDeepLink:"-",logList:[],connectReady:!1,connectStatusStr:"连接钱包",disconnectStatusStr:"断开钱包",localPubKey:"",localSecKey:"",testTransaction:"",selectedChain:"eip155:1",testTransactionStr:"发送交易",walletAddress:"",testboc:"",ProofPayloadVerify:"",showModal:!1,showVerifyRow:!1,qrValue:"https://www.okx.com/download",currentStatus:"",isChecked:e=>f.has(e),isOptionalChecked:e=>p.has(e),handleChange:e=>{f.has(e)?f.delete(e):f.add(e)},handleOptionChange:e=>{p.has(e)?p.delete(e):p.add(e)}}),computed:{getWalletAddress:function(){return this.walletAddress}},methods:{async clickActiveTab(e){const t=e.props?e.props.name:e.name;this.selectedChain=t,console.log("已切换到链 :",t),window.provider||console.error("钱包 未初始化完成"),window.provider.setDefaultChain(this.selectedChain)},async connectBtnClicked(){console.log(`encryptStoreMsg   connectBtnClicked  ${Date.now()}`),window.provider?this.testTonSdk():console.log("connectBtnClicked provider not finish init")},async disconnectAction(){try{console.log("get disconnect wallet btn clicked");var e=window.provider;await e.disconnect(),this.walletAddress="disconnected"}catch(t){console.log("Disconnect  error ==>> ",t.message),this.currentStatus=t.message}},async eth_requestAccounts(){var e={method:"eth_requestAccounts"};this.testTransaction=JSON.stringify(e)},async eth_chainId(){var e={method:"eth_chainId"};this.testTransaction=JSON.stringify(e)},async wallet_switchEthereumChain(){var e={method:"wallet_switchEthereumChain"};this.testTransaction=JSON.stringify(e)},async wallet_addEthereumChain(){var e={method:"wallet_addEthereumChain",params:[{blockExplorerUrls:["https://explorer.fuse.io"],chainId:"0x7a",chainName:"Fuse",nativeCurrency:{name:"Fuse",symbol:"FUSE",decimals:18},rpcUrls:["https://rpc.fuse.io"]}]};this.testTransaction=JSON.stringify(e)},async personal_sign(){if("eip155:1"===this.selectedChain){var e={method:"personal_sign",params:["0x4d7920656d61696c206973206a6f686e40646f652e636f6d202d2031373237353937343537313336"]};this.testTransaction=JSON.stringify(e)}else if("eip155:137"===this.selectedChain){var t={method:"personal_sign",params:{message:"0x4d7920656d61696c206973206a6f686e40646f652e636f6d202d2031373237353937353831303437"}};this.testTransaction=JSON.stringify(t)}else if("eip155:56"===this.selectedChain){var n={method:"personal_sign",params:{message:"0x4d7920656d61696c206973206a6f686e40646f652e636f6d202d2031373237353937353831303437"}};this.testTransaction=JSON.stringify(n)}},async eth_signTypedData_v4(){var e={method:"eth_signTypedData_v4",params:[{types:{EIP712Domain:[{name:"name",type:"string"},{name:"version",type:"string"},{name:"chainId",type:"uint256"},{name:"verifyingContract",type:"address"}],Person:[{name:"name",type:"string"},{name:"wallet",type:"address"}],Mail:[{name:"from",type:"Person"},{name:"to",type:"Person"},{name:"contents",type:"string"}]},primaryType:"Mail",domain:{name:"Ether Mail",version:"1",chainId:1,verifyingContract:"0xCcCCccccCCCCcCCCCCCcCcCccCcCCCcCcccccccC"},message:{from:{name:"Cow",wallet:"0xCD2a3d9F938E13CD947Ec05AbC7FE734Df8DD826"},to:{name:"Bob",wallet:"0xbBbBBBBbbBBBbbbBbbBbbbbBBbBbbbbBbBbbBBbB"},contents:"Hello, Bob!"}}]};this.testTransaction=JSON.stringify(e)},async eth_sendTransaction_transfer(){var e={};"eip155:1"===this.selectedChain?e={method:"eth_sendTransaction",params:{from:"0x0cecb15396825a895ff8da8fc2d2c77a234dccee",chainId:"0x1",to:"0x0cecb15396825a895ff8da8fc2d2c77a234dccee",value:"0x5af3107a4000",maxPriorityFeePerGas:"0x3b9aca00",gas:"0x5e56",maxFeePerGas:"0x2643b9db8"}}:"eip155:137"===this.selectedChain?e={method:"eth_sendTransaction",params:{gasPrice:"0x17003f6530",nonce:"0x0d30",data:"0x",value:"0x00",to:"0xf2f3e73be57031114dd1f4e75c1dd87658be7f0e",gasLimit:"0x5208",from:"0xf2f3e73be57031114dd1f4e75c1dd87658be7f0e"}}:"eip155:56"===this.selectedChain&&(e={method:"eth_sendTransaction",params:{gas:"0x5e56",value:"0x5af3107a4000",from:"0xf2f3e73be57031114dd1f4e75c1dd87658be7f0e",gasPrice:"0x3b9aca00",to:"0xf2f3e73be57031114dd1f4e75c1dd87658be7f0e",chainId:"0x38"}});var t=await window.provider.request({method:"eth_requestAccounts"},"eip155"),n=t[0];console.log("当前钱包地址------",n),e.params["to"]=n,e.params["from"]=n,this.testTransaction=JSON.stringify(e)},async eth_sendTransaction_approve(){var e={};"eip155:1"===this.selectedChain?e={method:"eth_sendTransaction",params:{from:"0xf2F3e73be57031114dd1f4E75c1DD87658be7F0E",data:"0x095ea7b3000000000000000000000000000000000022d473030f116ddee9f6b43ac78ba3ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",to:"0x582d872a1b094fc48f5de31d3b73f2d9be47def1"}}:"eip155:137"===this.selectedChain?e={method:"eth_sendTransaction",params:{from:"0xf2F3e73be57031114dd1f4E75c1DD87658be7F0E",data:"0x095ea7b3000000000000000000000000f2614a233c7c3e7f08b1f887ba133a13f1eb2c5500000000000000000000000000000000000000000000000000f6f8096ac575b0",to:"0x0b3F868E0BE5597D5DB7fEB59E1CADBb0fdDa50a"}}:"eip155:56"===this.selectedChain&&(e={method:"eth_sendTransaction",params:{from:"0x0cecb15396825A895FF8DA8fC2D2C77A234dcCee",value:"0x0",gas:"0xe117",gasPrice:"0xb2d05e00",data:"0x095ea7b300000000000000000000000031c2f6fcff4f8759b3bd5bf0e1084a055615c768ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",to:"0x5CA42204cDaa70d5c773946e69dE942b85CA6706"}});var t=await window.provider.request({method:"eth_requestAccounts"},"eip155"),n=t[0];console.log("当前钱包地址------",n),e.params["from"]=n,this.testTransaction=JSON.stringify(e)},async eth_sendTransaction_mint(){var e={};"eip155:1"===this.selectedChain?e={method:"eth_sendTransaction",params:{gas:"0x4cacb",data:"0xa64dfa75000000000000000000000000ed688002f3797599db8b4feacfe8b1dda0df1c8d000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000002a000000000000000000000000000000000000000000000000000000000000002e0000000000000000000000000000000000000000000000000000000000000032000000000000000000000000000000000000000000000000000000000000003a000000000000000000000000000000000000000000000000000000000000003c000000000000000000000000000000000000000000000000000000000000003e00000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000042000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000052000000000000000000000000000000000000000000000000000000000000005400000000000000000000000000000000000000000000000000000000000000560000000000000000000000000000000000000000000000000000000000000058000000000000000000000000000000000000000000000000000000000000005a000000000000000000000000000000000000000000000000000000000000005c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000cecb15396825a895ff8da8fc2d2c77a234dccee00000000000000000000000000000000000000000000000000000000000005e0000000000000000000000000000000000000000000000000000000000000062000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000047697066733a2f2f6261667962656968643737366b6177706e71336f6f6a6635693274787a76617737737164656b34616a776472637472703261366f626b70723773792f7b69647d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002a3078303030303030303030303030303030303030303030303030303030303030303030303030303030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001",to:"0x864baa13e01d8f9e26549dc91b458cd15e34eb7c",value:"0x0",from:"0x0cecb15396825a895ff8da8fc2d2c77a234dccee"}}:"eip155:137"===this.selectedChain&&(e={method:"eth_sendTransaction",params:{gas:"0x30795",data:"0xa64dfa75000000000000000000000000341b3687f0309778f08f29336b2c4b9c38b9f110000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000002a000000000000000000000000000000000000000000000000000000000000002e0000000000000000000000000000000000000000000000000000000000000032000000000000000000000000000000000000000000000000000000000000003a000000000000000000000000000000000000000000000000000000000000003c000000000000000000000000000000000000000000000000000000000000003e00000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000042000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000052000000000000000000000000000000000000000000000000000000000000005400000000000000000000000000000000000000000000000000000000000000560000000000000000000000000000000000000000000000000000000000000058000000000000000000000000000000000000000000000000000000000000005a000000000000000000000000000000000000000000000000000000000000005c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f2f3e73be57031114dd1f4e75c1dd87658be7f0e00000000000000000000000000000000000000000000000000000000000005e0000000000000000000000000000000000000000000000000000000000000062000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000047697066733a2f2f62616679626569686a6279676b68747a71376b68377434336266686e676e793236337668766f6578716a6d6e377161716166366e717a64743777712f7b69647d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002a3078303030303030303030303030303030303030303030303030303030303030303030303030303030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001",to:"0x864baa13e01d8f9e26549dc91b458cd15e34eb7c",value:"0x0",from:"0xf2f3e73be57031114dd1f4e75c1dd87658be7f0e"}});let t=JSON.stringify(e);console.log("-----长度---\x3e",t.length);var n=await window.provider.request({method:"eth_requestAccounts"},"eip155"),i=n[0];console.log("当前钱包地址------",i),e.params["from"]=i,this.testTransaction=JSON.stringify(e)},async wallet_testRpc(){let e=window.provider;e.setDefaultChain("eip155:56","https://eth-mainnet.g.alchemy.com/v2/NxUfYJUr-TQtEpLmSXhhD5pXn70GwsyV");var t={method:"eth_getBalance",params:["0x8D97689C9818892B700e27F316cc3E41e17fBeb9","latest"]};this.testTransaction=JSON.stringify(t)},async wallet_watchAsset(){var e={};"eip155:1"===this.selectedChain?e={method:"wallet_watchAsset",params:{type:"ERC20",options:{address:"0xe0f63a424a4439cbe457d80e4f4b51ad25b2c56c",symbol:"SPX6900",image:"https://assets.coingecko.com/coins/images/31401/standard/sticker_%281%29.jpg?1702371083",decimals:8}}}:"eip155:137"===this.selectedChain?e={method:"wallet_watchAsset",params:{type:"ERC20",options:{address:"0xeB51D9A39AD5EEF215dC0Bf39a8821ff804A0F01",symbol:"LGNS",image:"https://polygonscan.com/token/images/originlgns_32.png",decimals:9}}}:"eip155:56"===this.selectedChain&&(e={method:"wallet_watchAsset",params:{type:"ERC20",options:{address:"0x031b41e504677879370e9dbcf937283a8691fa7f",symbol:"FET",image:"https://bscscan.com/token/images/fetch_32.png",decimals:18}}}),this.testTransaction=JSON.stringify(e)},async sendTransaction(){if(console.log("sendTransaction",window.provider),console.log("sendTransaction内容11------",this.testTransaction),window.provider||console.error("钱包 未初始化完成"),this.testTransaction&&window.provider){const n=JSON.parse(this.testTransaction);try{console.log("sendTransaction-----22method>>",n.method);let t="eip155:1";this.selectedChain&&(t=this.selectedChain,console.log("sendTransaction-----this.selectedChain>>",this.selectedChain)),console.log(`请求数据发送 sendTransaction -----\x3e> ${JSON.stringify(n)}`);var e=await window.provider.request(n,t);console.log(`请求数据回调 sendTransaction -----\x3e> ${JSON.stringify(e)}`),this.testboc="string"==typeof e?e:JSON.stringify(e),console.log("方法数据回调 --this.testboc--",this.testboc)}catch(t){console.error("方法数据回调失败 --Error--",t.message),t.code===d.OKX_CONNECT_ERROR_CODES.USER_REJECTS_ERROR?this.testboc="用户拒绝交易":this.testboc="签名错误！"}}else alert("交易数据为空，请选则或输入交易数据。")},async testTonSdk(){let e=[],t=[];f.forEach((t=>e.push(`eip155:${t}`))),p.forEach((e=>t.push(`eip155:${e}`))),console.log(`namespaceChains  ===> ${JSON.stringify(e)}`);var n=window.provider,i={};if(e&&e.length>0){var s={eip155:{chains:e,defaultChain:e[0]}};i["namespaces"]=s}if(t&&t.length>0){var o={eip155:{chains:t,defaultChain:t[0]}};i["optionalNamespaces"]=o}0!==e.length||0!==t.length?await n.connect(i).then((()=>{this.walletAddress="connected"})):alert("请选择一条链")},closeModal(){this.showModal=!1},isPC(){const e=navigator.userAgent;console.log("current device ua is ===>",e);const t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"];let n=!0;for(let i=0;i<t.length;i++)if(e.indexOf(t[i])>0){n=!1;break}return n},isSafariOrChrome(){const e=navigator.userAgent,t=["Safari","Chrome"];let n=!1;for(let i=0;i<t.length;i++)if(e.indexOf(t[i])>0){n=!0;break}return n}},created(){},mounted(){if(!document.getElementById("tgsdk")){var e=document.createElement("script");e.src="https://telegram.org/js/telegram-web-app.js",e.id="tgsdk",document.getElementsByTagName("head")[0].appendChild(e),this.connectReady=!0,document.title="OKX Connect Evm",l.OKXUniversalProvider.init({dappMetaData:{name:"univer test dapp",icon:"https://avatars.githubusercontent.com/u/37784886"}}).then((e=>{window.provider=e,console.log(`init finished: ${e}`),console.log(`init finished session: ${JSON.stringify(e.session)}`),e.on("connect",(e=>{console.log("get connect session",e),this.walletAddress="connected"})),e.on("reconnect",(e=>{console.log("get reconnect session",e),this.walletAddress="connected"})),e.on("disconnect",(()=>{console.log("get disconnect"),this.walletAddress="disconnected"}))}))}}},m=n(1241);const v=(0,m.A)(g,[["render",c],["__scopeId","data-v-0941c6b9"]]);var y=v;const b=(0,i.Ef)(y);b.use(s.A),b.mount("#app")},8730:function(){},8103:function(){},515:function(){}},t={};function n(i){var s=t[i];if(void 0!==s)return s.exports;var o=t[i]={id:i,loaded:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}n.m=e,function(){n.amdO={}}(),function(){var e=[];n.O=function(t,i,s,o){if(!i){var r=1/0;for(l=0;l<e.length;l++){i=e[l][0],s=e[l][1],o=e[l][2];for(var a=!0,c=0;c<i.length;c++)(!1&o||r>=o)&&Object.keys(n.O).every((function(e){return n.O[e](i[c])}))?i.splice(c--,1):(a=!1,o<r&&(r=o));if(a){e.splice(l--,1);var d=s();void 0!==d&&(t=d)}}return t}o=o||0;for(var l=e.length;l>0&&e[l-1][2]>o;l--)e[l]=e[l-1];e[l]=[i,s,o]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){n.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){var e={524:0};n.O.j=function(t){return 0===e[t]};var t=function(t,i){var s,o,r=i[0],a=i[1],c=i[2],d=0;if(r.some((function(t){return 0!==e[t]}))){for(s in a)n.o(a,s)&&(n.m[s]=a[s]);if(c)var l=c(n)}for(t&&t(i);d<r.length;d++)o=r[d],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return n.O(l)},i=self["webpackChunkokxconnectdemo"]=self["webpackChunkokxconnectdemo"]||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}();var i=n.O(void 0,[504],(function(){return n(1074)}));i=n.O(i)})();
//# sourceMappingURL=app.b5d12371.js.map